(()=>{var ca=Object.defineProperty,o=(t,e)=>ca(t,"name",{value:e,configurable:!0}),da=(()=>{for(var t=new Uint8Array(128),e=0;e<64;e++)t[e<26?e+65:e<52?e+71:e<62?e-4:e*4-205]=e;return s=>{for(var n=s.length,r=new Uint8Array((n-(s[n-1]=="=")-(s[n-2]=="="))*3/4|0),h=0,u=0;h<n;){var p=t[s.charCodeAt(h++)],d=t[s.charCodeAt(h++)],c=t[s.charCodeAt(h++)],P=t[s.charCodeAt(h++)];r[u++]=p<<2|d>>4,r[u++]=d<<4|c>>2,r[u++]=c<<6|P}return r}})();function ke(t){return t*Math.PI/180}o(ke,"deg2rad");function St(t){return t*180/Math.PI}o(St,"rad2deg");function ht(t,e,s){return e>s?ht(t,s,e):Math.min(Math.max(t,e),s)}o(ht,"clamp");function nt(t,e,s){if(typeof t=="number"&&typeof e=="number")return t+(e-t)*s;if(t instanceof I&&e instanceof I||t instanceof pe&&e instanceof pe)return t.lerp(e,s);throw new Error(`Bad value for lerp(): ${t}, ${e}. Only number, Vec2 and Color is supported.`)}o(nt,"lerp");function ut(t,e,s,n,r){return n+(t-e)/(s-e)*(r-n)}o(ut,"map");function or(t,e,s,n,r){return ht(ut(t,e,s,n,r),n,r)}o(or,"mapc");var I=class ze{static{o(this,"Vec2")}x=0;y=0;constructor(e=0,s=e){this.x=e,this.y=s}static fromAngle(e){let s=ke(e);return new ze(Math.cos(s),Math.sin(s))}static LEFT=new ze(-1,0);static RIGHT=new ze(1,0);static UP=new ze(0,-1);static DOWN=new ze(0,1);clone(){return new ze(this.x,this.y)}add(...e){let s=E(...e);return new ze(this.x+s.x,this.y+s.y)}sub(...e){let s=E(...e);return new ze(this.x-s.x,this.y-s.y)}scale(...e){let s=E(...e);return new ze(this.x*s.x,this.y*s.y)}dist(...e){let s=E(...e);return this.sub(s).len()}sdist(...e){let s=E(...e);return this.sub(s).slen()}len(){return Math.sqrt(this.dot(this))}slen(){return this.dot(this)}unit(){let e=this.len();return e===0?new ze(0):this.scale(1/e)}normal(){return new ze(this.y,-this.x)}reflect(e){return this.sub(e.scale(2*this.dot(e)))}project(e){return e.scale(e.dot(this)/e.len())}reject(e){return this.sub(this.project(e))}dot(e){return this.x*e.x+this.y*e.y}cross(e){return this.x*e.y-this.y*e.x}angle(...e){let s=E(...e);return St(Math.atan2(this.y-s.y,this.x-s.x))}angleBetween(...e){let s=E(...e);return St(Math.atan2(this.cross(s),this.dot(s)))}lerp(e,s){return new ze(nt(this.x,e.x,s),nt(this.y,e.y,s))}slerp(e,s){let n=this.dot(e),r=this.cross(e),h=Math.atan2(r,n);return this.scale(Math.sin((1-s)*h)).add(e.scale(Math.sin(s*h))).scale(1/r)}isZero(){return this.x===0&&this.y===0}toFixed(e){return new ze(Number(this.x.toFixed(e)),Number(this.y.toFixed(e)))}transform(e){return e.multVec2(this)}eq(e){return this.x===e.x&&this.y===e.y}bbox(){return new Fe(this,0,0)}toString(){return`vec2(${this.x.toFixed(2)}, ${this.y.toFixed(2)})`}};function E(...t){if(t.length===1){if(t[0]instanceof I)return new I(t[0].x,t[0].y);if(Array.isArray(t[0])&&t[0].length===2)return new I(...t[0])}return new I(...t)}o(E,"vec2");var pe=class Te{static{o(this,"Color")}r=255;g=255;b=255;constructor(e,s,n){this.r=ht(e,0,255),this.g=ht(s,0,255),this.b=ht(n,0,255)}static fromArray(e){return new Te(e[0],e[1],e[2])}static fromHex(e){if(typeof e=="number")return new Te(e>>16&255,e>>8&255,e>>0&255);if(typeof e=="string"){let s=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(e);return new Te(parseInt(s[1],16),parseInt(s[2],16),parseInt(s[3],16))}else throw new Error("Invalid hex color format")}static fromHSL(e,s,n){if(s==0)return new Te(255*n,255*n,255*n);let r=o((P,y,C)=>(C<0&&(C+=1),C>1&&(C-=1),C<1/6?P+(y-P)*6*C:C<1/2?y:C<2/3?P+(y-P)*(2/3-C)*6:P),"hue2rgb"),h=n<.5?n*(1+s):n+s-n*s,u=2*n-h,p=r(u,h,e+1/3),d=r(u,h,e),c=r(u,h,e-1/3);return new Te(Math.round(p*255),Math.round(d*255),Math.round(c*255))}static RED=new Te(255,0,0);static GREEN=new Te(0,255,0);static BLUE=new Te(0,0,255);static YELLOW=new Te(255,255,0);static MAGENTA=new Te(255,0,255);static CYAN=new Te(0,255,255);static WHITE=new Te(255,255,255);static BLACK=new Te(0,0,0);clone(){return new Te(this.r,this.g,this.b)}lighten(e){return new Te(this.r+e,this.g+e,this.b+e)}darken(e){return this.lighten(-e)}invert(){return new Te(255-this.r,255-this.g,255-this.b)}mult(e){return new Te(this.r*e.r/255,this.g*e.g/255,this.b*e.b/255)}lerp(e,s){return new Te(nt(this.r,e.r,s),nt(this.g,e.g,s),nt(this.b,e.b,s))}toHSL(){let e=this.r/255,s=this.g/255,n=this.b/255,r=Math.max(e,s,n),h=Math.min(e,s,n),u=(r+h)/2,p=u,d=u;if(r==h)u=p=0;else{let c=r-h;switch(p=d>.5?c/(2-r-h):c/(r+h),r){case e:u=(s-n)/c+(s<n?6:0);break;case s:u=(n-e)/c+2;break;case n:u=(e-s)/c+4;break}u/=6}return[u,p,d]}eq(e){return this.r===e.r&&this.g===e.g&&this.b===e.b}toString(){return`rgb(${this.r}, ${this.g}, ${this.b})`}toHex(){return"#"+((1<<24)+(this.r<<16)+(this.g<<8)+this.b).toString(16).slice(1)}toArray(){return[this.r,this.g,this.b]}};function we(...t){if(t.length===0)return new pe(255,255,255);if(t.length===1){if(t[0]instanceof pe)return t[0].clone();if(typeof t[0]=="string")return pe.fromHex(t[0]);if(Array.isArray(t[0])&&t[0].length===3)return pe.fromArray(t[0])}return new pe(...t)}o(we,"rgb");var pa=o((t,e,s)=>pe.fromHSL(t,e,s),"hsl2rgb"),Ie=class Mi{static{o(this,"Quad")}x=0;y=0;w=1;h=1;constructor(e,s,n,r){this.x=e,this.y=s,this.w=n,this.h=r}scale(e){return new Mi(this.x+this.w*e.x,this.y+this.h*e.y,this.w*e.w,this.h*e.h)}pos(){return new I(this.x,this.y)}clone(){return new Mi(this.x,this.y,this.w,this.h)}eq(e){return this.x===e.x&&this.y===e.y&&this.w===e.w&&this.h===e.h}toString(){return`quad(${this.x}, ${this.y}, ${this.w}, ${this.h})`}};function Pe(t,e,s,n){return new Ie(t,e,s,n)}o(Pe,"quad");var Hs=class jt{static{o(this,"Mat2")}a;b;c;d;constructor(e,s,n,r){this.a=e,this.b=s,this.c=n,this.d=r}mul(e){return new jt(this.a*e.a+this.b*e.c,this.a*e.b+this.b*e.d,this.c*e.a+this.d*e.c,this.c*e.b+this.d*e.d)}transform(e){return E(this.a*e.x+this.b*e.y,this.c*e.x+this.d*e.y)}get inverse(){let e=this.det;return new jt(this.d/e,-this.b/e,-this.c/e,this.a/e)}get transpose(){return new jt(this.a,this.c,this.b,this.d)}get eigenvalues(){let e=this.trace/2,s=this.det,n=e+Math.sqrt(e*e-s),r=e-Math.sqrt(e*e-s);return[n,r]}eigenvectors(e,s){return this.c!=0?[[e-this.d,this.c],[s-this.d,this.c]]:this.b!=0?[[this.b,e-this.a],[this.b,s-this.a]]:Math.abs(this.transform(E(1,0)).x-e)<Number.EPSILON?[[1,0],[0,1]]:[[0,1],[1,0]]}get det(){return this.a*this.d-this.b*this.c}get trace(){return this.a+this.d}static rotation(e){let s=Math.cos(e),n=Math.sin(e);return new jt(s,n,-n,s)}static scale(e,s){return new jt(e,0,0,s)}},us=class cs{static{o(this,"Mat3")}m11;m12;m13;m21;m22;m23;m31;m32;m33;constructor(e,s,n,r,h,u,p,d,c){this.m11=e,this.m12=s,this.m13=n,this.m21=r,this.m22=h,this.m23=u,this.m31=p,this.m32=d,this.m33=c}static fromMat2(e){return new cs(e.a,e.b,0,e.c,e.d,0,0,0,1)}toMat2(){return new Hs(this.m11,this.m12,this.m21,this.m22)}mul(e){return new cs(this.m11*e.m11+this.m12*e.m21+this.m13*e.m31,this.m11*e.m12+this.m12*e.m22+this.m13*e.m32,this.m11*e.m13+this.m12*e.m23+this.m13*e.m33,this.m21*e.m11+this.m22*e.m21+this.m23*e.m31,this.m21*e.m12+this.m22*e.m22+this.m23*e.m32,this.m21*e.m13+this.m22*e.m23+this.m23*e.m33,this.m31*e.m11+this.m32*e.m21+this.m33*e.m31,this.m31*e.m12+this.m32*e.m22+this.m33*e.m32,this.m31*e.m13+this.m32*e.m23+this.m33*e.m33)}get det(){return this.m11*this.m22*this.m33+this.m12*this.m23*this.m31+this.m13*this.m21*this.m32-this.m13*this.m22*this.m31-this.m12*this.m21*this.m33-this.m11*this.m23*this.m32}rotate(e){let s=Math.cos(e),n=Math.sin(e),r=this.m11,h=this.m12;return this.m11=s*this.m11+n*this.m21,this.m12=s*this.m12+n*this.m22,this.m21=s*this.m21-n*r,this.m22=s*this.m22-n*h,this}scale(e,s){return this.m11*=e,this.m12*=e,this.m21*=s,this.m22*=s,this}get inverse(){let e=this.det;return new cs((this.m22*this.m33-this.m23*this.m32)/e,(this.m13*this.m32-this.m12*this.m33)/e,(this.m12*this.m23-this.m13*this.m22)/e,(this.m23*this.m31-this.m21*this.m33)/e,(this.m11*this.m33-this.m13*this.m31)/e,(this.m13*this.m21-this.m11*this.m23)/e,(this.m21*this.m32-this.m22*this.m31)/e,(this.m12*this.m31-this.m11*this.m32)/e,(this.m11*this.m22-this.m12*this.m21)/e)}get transpose(){return new cs(this.m11,this.m21,this.m31,this.m12,this.m22,this.m32,this.m13,this.m23,this.m33)}},lt=class wt{static{o(this,"Mat4")}m=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1];constructor(e){e&&(this.m=e)}static translate(e){return new wt([1,0,0,0,0,1,0,0,0,0,1,0,e.x,e.y,0,1])}static scale(e){return new wt([e.x,0,0,0,0,e.y,0,0,0,0,1,0,0,0,0,1])}static rotateX(e){e=ke(-e);let s=Math.cos(e),n=Math.sin(e);return new wt([1,0,0,0,0,s,-n,0,0,n,s,0,0,0,0,1])}static rotateY(e){e=ke(-e);let s=Math.cos(e),n=Math.sin(e);return new wt([s,0,n,0,0,1,0,0,-n,0,s,0,0,0,0,1])}static rotateZ(e){e=ke(-e);let s=Math.cos(e),n=Math.sin(e);return new wt([s,-n,0,0,n,s,0,0,0,0,1,0,0,0,0,1])}translate(e){return this.m[12]+=this.m[0]*e.x+this.m[4]*e.y,this.m[13]+=this.m[1]*e.x+this.m[5]*e.y,this.m[14]+=this.m[2]*e.x+this.m[6]*e.y,this.m[15]+=this.m[3]*e.x+this.m[7]*e.y,this}scale(e){return this.m[0]*=e.x,this.m[4]*=e.y,this.m[1]*=e.x,this.m[5]*=e.y,this.m[2]*=e.x,this.m[6]*=e.y,this.m[3]*=e.x,this.m[7]*=e.y,this}rotate(e){e=ke(-e);let s=Math.cos(e),n=Math.sin(e),r=this.m[0],h=this.m[1],u=this.m[4],p=this.m[5];return this.m[0]=r*s+h*n,this.m[1]=-r*n+h*s,this.m[4]=u*s+p*n,this.m[5]=-u*n+p*s,this}mult(e){let s=[];for(let n=0;n<4;n++)for(let r=0;r<4;r++)s[n*4+r]=this.m[0*4+r]*e.m[n*4+0]+this.m[1*4+r]*e.m[n*4+1]+this.m[2*4+r]*e.m[n*4+2]+this.m[3*4+r]*e.m[n*4+3];return new wt(s)}multVec2(e){return new I(e.x*this.m[0]+e.y*this.m[4]+this.m[12],e.x*this.m[1]+e.y*this.m[5]+this.m[13])}getTranslation(){return new I(this.m[12],this.m[13])}getScale(){if(this.m[0]!=0||this.m[1]!=0){let e=this.m[0]*this.m[5]-this.m[1]*this.m[4],s=Math.sqrt(this.m[0]*this.m[0]+this.m[1]*this.m[1]);return new I(s,e/s)}else if(this.m[4]!=0||this.m[5]!=0){let e=this.m[0]*this.m[5]-this.m[1]*this.m[4],s=Math.sqrt(this.m[4]*this.m[4]+this.m[5]*this.m[5]);return new I(e/s,s)}else return new I(0,0)}getRotation(){if(this.m[0]!=0||this.m[1]!=0){let e=Math.sqrt(this.m[0]*this.m[0]+this.m[1]*this.m[1]);return St(this.m[1]>0?Math.acos(this.m[0]/e):-Math.acos(this.m[0]/e))}else if(this.m[4]!=0||this.m[5]!=0){let e=Math.sqrt(this.m[4]*this.m[4]+this.m[5]*this.m[5]);return St(Math.PI/2-(this.m[5]>0?Math.acos(-this.m[4]/e):-Math.acos(this.m[4]/e)))}else return 0}getSkew(){if(this.m[0]!=0||this.m[1]!=0){let e=Math.sqrt(this.m[0]*this.m[0]+this.m[1]*this.m[1]);return new I(Math.atan(this.m[0]*this.m[4]+this.m[1]*this.m[5])/(e*e),0)}else if(this.m[4]!=0||this.m[5]!=0){let e=Math.sqrt(this.m[4]*this.m[4]+this.m[5]*this.m[5]);return new I(0,Math.atan(this.m[0]*this.m[4]+this.m[1]*this.m[5])/(e*e))}else return new I(0,0)}invert(){let e=[],s=this.m[10]*this.m[15]-this.m[14]*this.m[11],n=this.m[9]*this.m[15]-this.m[13]*this.m[11],r=this.m[9]*this.m[14]-this.m[13]*this.m[10],h=this.m[8]*this.m[15]-this.m[12]*this.m[11],u=this.m[8]*this.m[14]-this.m[12]*this.m[10],p=this.m[8]*this.m[13]-this.m[12]*this.m[9],d=this.m[6]*this.m[15]-this.m[14]*this.m[7],c=this.m[5]*this.m[15]-this.m[13]*this.m[7],P=this.m[5]*this.m[14]-this.m[13]*this.m[6],y=this.m[4]*this.m[15]-this.m[12]*this.m[7],C=this.m[4]*this.m[14]-this.m[12]*this.m[6],x=this.m[5]*this.m[15]-this.m[13]*this.m[7],W=this.m[4]*this.m[13]-this.m[12]*this.m[5],Y=this.m[6]*this.m[11]-this.m[10]*this.m[7],Q=this.m[5]*this.m[11]-this.m[9]*this.m[7],j=this.m[5]*this.m[10]-this.m[9]*this.m[6],Z=this.m[4]*this.m[11]-this.m[8]*this.m[7],M=this.m[4]*this.m[10]-this.m[8]*this.m[6],ne=this.m[4]*this.m[9]-this.m[8]*this.m[5];e[0]=this.m[5]*s-this.m[6]*n+this.m[7]*r,e[4]=-(this.m[4]*s-this.m[6]*h+this.m[7]*u),e[8]=this.m[4]*n-this.m[5]*h+this.m[7]*p,e[12]=-(this.m[4]*r-this.m[5]*u+this.m[6]*p),e[1]=-(this.m[1]*s-this.m[2]*n+this.m[3]*r),e[5]=this.m[0]*s-this.m[2]*h+this.m[3]*u,e[9]=-(this.m[0]*n-this.m[1]*h+this.m[3]*p),e[13]=this.m[0]*r-this.m[1]*u+this.m[2]*p,e[2]=this.m[1]*d-this.m[2]*c+this.m[3]*P,e[6]=-(this.m[0]*d-this.m[2]*y+this.m[3]*C),e[10]=this.m[0]*x-this.m[1]*y+this.m[3]*W,e[14]=-(this.m[0]*P-this.m[1]*C+this.m[2]*W),e[3]=-(this.m[1]*Y-this.m[2]*Q+this.m[3]*j),e[7]=this.m[0]*Y-this.m[2]*Z+this.m[3]*M,e[11]=-(this.m[0]*Q-this.m[1]*Z+this.m[3]*ne),e[15]=this.m[0]*j-this.m[1]*M+this.m[2]*ne;let K=this.m[0]*e[0]+this.m[1]*e[4]+this.m[2]*e[8]+this.m[3]*e[12];for(let re=0;re<4;re++)for(let N=0;N<4;N++)e[re*4+N]*=1/K;return new wt(e)}clone(){return new wt([...this.m])}toString(){return this.m.toString()}};function Ri(t,e,s,n=r=>-Math.cos(r)){return t+(n(s)+1)/2*(e-t)}o(Ri,"wave");var fa=1103515245,ga=12345,Zn=2147483648,ar=class{static{o(this,"RNG")}seed;constructor(t){this.seed=t}gen(){return this.seed=(fa*this.seed+ga)%Zn,this.seed/Zn}genNumber(t,e){return t+this.gen()*(e-t)}genVec2(t,e){return new I(this.genNumber(t.x,e.x),this.genNumber(t.y,e.y))}genColor(t,e){return new pe(this.genNumber(t.r,e.r),this.genNumber(t.g,e.g),this.genNumber(t.b,e.b))}genAny(...t){if(t.length===0)return this.gen();if(t.length===1){if(typeof t[0]=="number")return this.genNumber(0,t[0]);if(t[0]instanceof I)return this.genVec2(E(0,0),t[0]);if(t[0]instanceof pe)return this.genColor(we(0,0,0),t[0])}else if(t.length===2){if(typeof t[0]=="number"&&typeof t[1]=="number")return this.genNumber(t[0],t[1]);if(t[0]instanceof I&&t[1]instanceof I)return this.genVec2(t[0],t[1]);if(t[0]instanceof pe&&t[1]instanceof pe)return this.genColor(t[0],t[1])}}},Pi=new ar(Date.now());function lr(t){return t!=null&&(Pi.seed=t),Pi.seed}o(lr,"randSeed");function ct(...t){return Pi.genAny(...t)}o(ct,"rand");function Hi(...t){return Math.floor(ct(...t))}o(Hi,"randi");function hr(t){return ct()<=t}o(hr,"chance");function Yi(t){for(let e=t.length-1;e>0;e--){let s=Math.floor(Math.random()*(e+1));[t[e],t[s]]=[t[s],t[e]]}return t}o(Yi,"shuffle");function ur(t,e){return t.length<=e?t.slice():Yi(t.slice()).slice(0,e)}o(ur,"chooseMultiple");function cr(t){return t[Hi(t.length)]}o(cr,"choose");function Ki(t,e){return t.pos.x+t.width>e.pos.x&&t.pos.x<e.pos.x+e.width&&t.pos.y+t.height>e.pos.y&&t.pos.y<e.pos.y+e.height}o(Ki,"testRectRect");function dr(t,e){if(t.p1.x===t.p2.x&&t.p1.y===t.p2.y||e.p1.x===e.p2.x&&e.p1.y===e.p2.y)return null;let s=(e.p2.y-e.p1.y)*(t.p2.x-t.p1.x)-(e.p2.x-e.p1.x)*(t.p2.y-t.p1.y);if(s===0)return null;let n=((e.p2.x-e.p1.x)*(t.p1.y-e.p1.y)-(e.p2.y-e.p1.y)*(t.p1.x-e.p1.x))/s,r=((t.p2.x-t.p1.x)*(t.p1.y-e.p1.y)-(t.p2.y-t.p1.y)*(t.p1.x-e.p1.x))/s;return n<0||n>1||r<0||r>1?null:n}o(dr,"testLineLineT");function Ks(t,e){let s=dr(t,e);return s?E(t.p1.x+s*(t.p2.x-t.p1.x),t.p1.y+s*(t.p2.y-t.p1.y)):null}o(Ks,"testLineLine");function Qs(t,e){let s=e.p2.sub(e.p1),n=Number.NEGATIVE_INFINITY,r=Number.POSITIVE_INFINITY;if(s.x!=0){let h=(t.pos.x-e.p1.x)/s.x,u=(t.pos.x+t.width-e.p1.x)/s.x;n=Math.max(n,Math.min(h,u)),r=Math.min(r,Math.max(h,u))}if(s.y!=0){let h=(t.pos.y-e.p1.y)/s.y,u=(t.pos.y+t.height-e.p1.y)/s.y;n=Math.max(n,Math.min(h,u)),r=Math.min(r,Math.max(h,u))}return r>=n&&r>=0&&n<=1}o(Qs,"testRectLine");function zs(t,e){return e.x>t.pos.x&&e.x<t.pos.x+t.width&&e.y>t.pos.y&&e.y<t.pos.y+t.height}o(zs,"testRectPoint");function Qi(t,e){let s=Math.max(t.pos.x,Math.min(e.center.x,t.pos.x+t.width)),n=Math.max(t.pos.y,Math.min(e.center.y,t.pos.y+t.height));return E(s,n).sdist(e.center)<=e.radius*e.radius}o(Qi,"testRectCircle");function zi(t,e){return Xi(e,new et(t.points()))}o(zi,"testRectPolygon");function Xs(t,e){let s=e.sub(t.p1),n=t.p2.sub(t.p1);if(Math.abs(s.cross(n))>Number.EPSILON)return!1;let r=s.dot(n)/n.dot(n);return r>=0&&r<=1}o(Xs,"testLinePoint");function Qt(t,e){let s=t.p2.sub(t.p1),n=s.dot(s),r=t.p1.sub(e.center),h=2*s.dot(r),u=r.dot(r)-e.radius*e.radius,p=h*h-4*n*u;if(n<=Number.EPSILON||p<0)return!1;if(p==0){let d=-h/(2*n);if(d>=0&&d<=1)return!0}else{let d=(-h+Math.sqrt(p))/(2*n),c=(-h-Math.sqrt(p))/(2*n);if(d>=0&&d<=1||c>=0&&c<=1)return!0}return xs(e,t.p1)}o(Qt,"testLineCircle");function Js(t,e){if(yt(e,t.p1)||yt(e,t.p2))return!0;for(let s=0;s<e.pts.length;s++){let n=e.pts[s],r=e.pts[(s+1)%e.pts.length];if(Ks(t,new $e(n,r)))return!0}return!1}o(Js,"testLinePolygon");function xs(t,e){return t.center.sdist(e)<t.radius*t.radius}o(xs,"testCirclePoint");function pr(t,e){return t.center.sdist(e.center)<(t.radius+e.radius)*(t.radius+e.radius)}o(pr,"testCircleCircle");function vs(t,e){let s=e.pts[e.pts.length-1];for(let n of e.pts){if(Qt(new $e(s,n),t))return!0;s=n}return xs(t,e.pts[0])?!0:yt(e,t.center)}o(vs,"testCirclePolygon");function Xi(t,e){for(let s=0;s<t.pts.length;s++)if(Js(new $e(t.pts[s],t.pts[(s+1)%t.pts.length]),e))return!0;return!!(t.pts.some(s=>yt(e,s))||e.pts.some(s=>yt(t,s)))}o(Xi,"testPolygonPolygon");function yt(t,e){let s=!1,n=t.pts;for(let r=0,h=n.length-1;r<n.length;h=r++)n[r].y>e.y!=n[h].y>e.y&&e.x<(n[h].x-n[r].x)*(e.y-n[r].y)/(n[h].y-n[r].y)+n[r].x&&(s=!s);return s}o(yt,"testPolygonPoint");function _s(t,e){e=e.sub(t.center);let s=ke(t.angle),n=Math.cos(s),r=Math.sin(s),h=e.x*n+e.y*r,u=-e.x*r+e.y*n;return h*h/(t.radiusX*t.radiusX)+u*u/(t.radiusY*t.radiusY)<1}o(_s,"testEllipsePoint");function As(t,e){let s=e.center.sub(t.center),n=ke(t.angle),r=Math.cos(n),h=Math.sin(n),u=s.x*r+s.y*h,p=-s.x*h+s.y*r;return _s(new At(E(),t.radiusX+e.radius,t.radiusY+e.radius,0),E(u,p))}o(As,"testEllipseCircle");function Ji(t,e){let s=t.toMat2().inverse;return e=new $e(s.transform(e.p1.sub(t.center)),s.transform(e.p2.sub(t.center))),Qt(e,new Ze(E(),1))}o(Ji,"testEllipseLine");function fr(t,e){if(t.radiusX===t.radiusY)return As(e,new Ze(t.center,t.radiusX));if(e.radiusX===e.radiusY)return As(t,new Ze(e.center,e.radiusX));let s=new us(1/t.radiusX**2,0,0,0,1/t.radiusY**2,0,0,0,-1),n=new us(1/e.radiusX**2,0,0,0,1/e.radiusY**2,0,0,0,-1),r=t.center.x,h=t.center.y,u=e.center.x,p=e.center.y,d=ke(t.angle),c=ke(e.angle),P=new us(Math.cos(d),-Math.sin(d),r,Math.sin(d),Math.cos(d),h,0,0,1),y=new us(Math.cos(c),-Math.sin(c),u,Math.sin(c),Math.cos(c),p,0,0,1),C=P.inverse,x=y.inverse,W=C.transpose.mul(s).mul(C),Y=x.transpose.mul(n).mul(x),Q=W.m11,j=W.m12,Z=W.m13,M=W.m21,ne=W.m22,K=W.m23,re=W.m31,N=W.m32,G=W.m33,he=Y.m11,ge=Y.m12,ae=Y.m13,ye=Y.m21,ce=Y.m22,De=Y.m23,ue=Y.m31,Oe=Y.m32,le=Y.m33,fe=Q*ne*G-Q*K*N-j*M*G+j*K*re+Z*M*N-Z*ne*re,Ae=(Q*ne*le-Q*K*Oe-Q*N*De+Q*G*ce-j*M*le+j*K*ue+j*re*De-j*G*ye+Z*M*Oe-Z*ne*ue-Z*re*ce+Z*N*ye+M*N*ae-M*G*ge-ne*re*ae+ne*G*he+K*re*ge-K*N*he)/fe,ve=(Q*ce*le-Q*De*Oe-j*ye*le+j*De*ue+Z*ye*Oe-Z*ce*ue-M*ge*le+M*ae*Oe+ne*he*le-ne*ae*ue-K*he*Oe+K*ge*ue+re*ge*De-re*ae*ce-N*he*De+N*ae*ye+G*he*ce-G*ge*ye)/fe,be=(he*ce*le-he*De*Oe-ge*ye*le+ge*De*ue+ae*ye*Oe-ae*ce*ue)/fe;if(Ae>=0){let qe=-3*ve+Ae**2,J=3*Ae*be+ve*Ae**2-4*ve**2,xt=-27*be**2+18*be*Ae*ve+Ae**2*ve**2-4*Ae**3*be-4*ve**3;return!(qe>0&&J<0&&xt>0)}else{let qe=-3*ve+Ae**2,J=-27*be**2+18*be*Ae*ve+Ae**2*ve**2-4*Ae**3*be-4*ve**3;return!(qe>0&&J>0)}}o(fr,"testEllipseEllipse");function _i(t,e){return Zs(t,new et(e.points()))}o(_i,"testEllipseRect");function Zs(t,e){let s=t.toMat2().inverse;return e=new et(e.pts.map(n=>s.transform(n.sub(t.center)))),vs(new Ze(E(),1),e)}o(Zs,"testEllipsePolygon");function gr(t,e){return t.x===e.x&&t.y===e.y}o(gr,"testPointPoint");function mr(t,e){return e instanceof I?gr(e,t.pt):e instanceof Ze?xs(e,t.pt):e instanceof $e?Xs(e,t.pt):e instanceof Fe?zs(e,t.pt):e instanceof et?yt(e,t.pt):e instanceof At?_s(e,t.pt):!1}o(mr,"testPointShape");function wr(t,e){return e instanceof I?Xs(t,e):e instanceof Ze?Qt(t,e):e instanceof $e?Ks(t,e)!=null:e instanceof Fe?Qs(e,t):e instanceof et?Js(t,e):e instanceof At?Ji(e,t):!1}o(wr,"testLineShape");function yr(t,e){return e instanceof I?xs(t,e):e instanceof Ze?pr(t,e):e instanceof $e?Qt(e,t):e instanceof Fe?Qi(e,t):e instanceof et?vs(t,e):e instanceof At?As(e,t):!1}o(yr,"testCircleShape");function Ar(t,e){return e instanceof I?zs(t,e):e instanceof Ze?Qi(t,e):e instanceof $e?Qs(t,e):e instanceof Fe?Ki(t,e):e instanceof et?zi(t,e):e instanceof At?_i(e,t):!1}o(Ar,"testRectShape");function xr(t,e){return e instanceof I?yt(t,e):e instanceof Ze?vs(e,t):e instanceof $e?Js(e,t):e instanceof Fe?zi(e,t):e instanceof et?Xi(e,t):e instanceof At?Zs(e,t):!1}o(xr,"testPolygonShape");function vr(t,e){return e instanceof I?_s(t,e):e instanceof Ze?As(t,e):e instanceof $e?Ji(t,e):e instanceof Fe?_i(t,e):e instanceof et?Zs(t,e):e instanceof At?fr(e,t):!1}o(vr,"testEllipseShape");function Zi(t,e,s){let n=t,r=s.p1,h=s.p2,u=e,p=h.sub(r),d=u.cross(p);if(Math.abs(d)<Number.EPSILON)return null;let c=r.sub(n),P=c.cross(p)/d;if(P<=0||P>=1)return null;let y=c.cross(u)/d;if(y<=0||y>=1)return null;let C=p.normal().unit();return e.dot(C)>0&&(C.x*=-1,C.y*=-1),{point:n.add(u.scale(P)),normal:C,fraction:P}}o(Zi,"raycastLine");function br(t,e,s){let n=Number.NEGATIVE_INFINITY,r=Number.POSITIVE_INFINITY,h;if(t.x!=0){let u=(s.pos.x-t.x)/e.x,p=(s.pos.x+s.width-t.x)/e.x;h=E(-Math.sign(e.x),0),n=Math.max(n,Math.min(u,p)),r=Math.min(r,Math.max(u,p))}if(t.y!=0){let u=(s.pos.y-t.y)/e.y,p=(s.pos.y+s.height-t.y)/e.y;Math.min(u,p)>n&&(h=E(0,-Math.sign(e.y))),n=Math.max(n,Math.min(u,p)),r=Math.min(r,Math.max(u,p))}return r>=n&&n>=0&&n<=1?{point:t.add(e.scale(n)),normal:h,fraction:n}:null}o(br,"raycastRect");function $i(t,e,s){let n=t,r=s.center,h=e,u=h.dot(h),p=n.sub(r),d=2*h.dot(p),c=p.dot(p)-s.radius*s.radius,P=d*d-4*u*c;if(u<=Number.EPSILON||P<0)return null;if(P==0){let y=-d/(2*u);if(y>=0&&y<=1){let C=n.add(h.scale(y));return{point:C,normal:C.sub(r),fraction:y}}}else{let y=(-d+Math.sqrt(P))/(2*u),C=(-d-Math.sqrt(P))/(2*u),x=null;if(y>=0&&y<=1&&(x=y),C>=0&&C<=1&&(x=Math.min(C,x??C)),x!=null){let W=n.add(h.scale(x));return{point:W,normal:W.sub(r).unit(),fraction:x}}}return null}o($i,"raycastCircle");function Vr(t,e,s){let n=s.pts,r=null,h=n[n.length-1];for(let u=0;u<n.length;u++){let p=n[u],d=Zi(t,e,new $e(h,p));d&&(!r||r.fraction>d.fraction)&&(r=d),h=p}return r}o(Vr,"raycastPolygon");function Er(t,e,s){let n=s.toMat2(),r=n.inverse,h=r.transform(t.sub(s.center)),u=r.transform(e),p=$i(h,u,new Ze(E(),1));if(p){let d=Hs.rotation(ke(-s.angle)),c=Hs.scale(s.radiusX,s.radiusY).transform(p.point),P=n.transform(p.point).add(s.center),y=P.dist(t)/e.len();return{point:P,normal:d.transform(E(s.radiusY**2*c.x,s.radiusX**2*c.y)),fraction:y}}return p}o(Er,"raycastEllipse");function Sr(t,e,s,n=64){let r=t,h=e.len(),u=e.scale(1/h),p=0,d=E(Math.floor(t.x),Math.floor(t.y)),c=E(u.x>0?1:-1,u.y>0?1:-1),P=E(Math.abs(1/u.x),Math.abs(1/u.y)),y=E(c.x>0?d.x+1-t.x:t.x-d.x,c.y>0?d.y+1-t.y:t.y-d.y),C=E(P.x<1/0?P.x*y.x:1/0,P.y<1/0?P.y*y.y:1/0),x=-1;for(;p<=n;){let W=s(d);if(W===!0)return{point:r.add(u.scale(p)),normal:E(x===0?-c.x:0,x===1?-c.y:0),fraction:p/h,gridPos:d};if(W)return W;C.x<C.y?(d.x+=c.x,p=C.x,C.x+=P.x,x=0):(d.y+=c.y,p=C.y,C.y+=P.y,x=1)}return null}o(Sr,"raycastGrid");var ma=class ki{static{o(this,"Point")}pt;constructor(e){this.pt=e.clone()}transform(e){return new ki(e.multVec2(this.pt))}bbox(){return new Fe(this.pt,0,0)}area(){return 0}clone(){return new ki(this.pt)}collides(e){return mr(this,e)}contains(e){return this.pt.eq(e)}raycast(e,s){return null}random(){return this.pt.clone()}},$e=class Ci{static{o(this,"Line")}p1;p2;constructor(e,s){this.p1=e.clone(),this.p2=s.clone()}transform(e){return new Ci(e.multVec2(this.p1),e.multVec2(this.p2))}bbox(){return Fe.fromPoints(this.p1,this.p2)}area(){return this.p1.dist(this.p2)}clone(){return new Ci(this.p1,this.p2)}collides(e){return wr(this,e)}contains(e){return this.collides(e)}raycast(e,s){return Zi(e,s,this)}random(){return this.p1.add(this.p2.sub(this.p1).scale(ct(1)))}},Fe=class Ti{static{o(this,"Rect")}pos;width;height;constructor(e,s,n){this.pos=e.clone(),this.width=s,this.height=n}static fromPoints(e,s){return new Ti(e.clone(),s.x-e.x,s.y-e.y)}center(){return new I(this.pos.x+this.width/2,this.pos.y+this.height/2)}points(){return[this.pos,this.pos.add(this.width,0),this.pos.add(this.width,this.height),this.pos.add(0,this.height)]}transform(e){return new et(this.points().map(s=>e.multVec2(s)))}bbox(){return this.clone()}area(){return this.width*this.height}clone(){return new Ti(this.pos.clone(),this.width,this.height)}distToPoint(e){return Math.sqrt(this.sdistToPoint(e))}sdistToPoint(e){let s=this.pos,n=this.pos.add(this.width,this.height),r=Math.max(s.x-e.x,0,e.x-n.x),h=Math.max(s.y-e.y,0,e.y-n.y);return r*r+h*h}collides(e){return Ar(this,e)}contains(e){return this.collides(e)}raycast(e,s){return br(e,s,this)}random(){return this.pos.add(ct(this.width),ct(this.height))}},Ze=class Mr{static{o(this,"Circle")}center;radius;constructor(e,s){this.center=e.clone(),this.radius=s}transform(e){return new At(this.center,this.radius,this.radius).transform(e)}bbox(){return Fe.fromPoints(this.center.sub(E(this.radius)),this.center.add(E(this.radius)))}area(){return this.radius*this.radius*Math.PI}clone(){return new Mr(this.center,this.radius)}collides(e){return yr(this,e)}contains(e){return this.collides(e)}raycast(e,s){return $i(e,s,this)}random(){return this.center.add(I.fromAngle(ct(360).scale(ct(this.radius))))}},At=class Gt{static{o(this,"Ellipse")}center;radiusX;radiusY;angle;constructor(e,s,n,r=0){this.center=e.clone(),this.radiusX=s,this.radiusY=n,this.angle=r}static fromMat2(e){let s=e.inverse,n=s.transpose.mul(s),[r,h]=n.eigenvalues,[u,p]=n.eigenvectors(r,h),[d,c]=[1/Math.sqrt(r),1/Math.sqrt(h)];return d>c?new Gt(E(),d,c,St(Math.atan2(-u[1],u[0]))):new Gt(E(),c,d,St(Math.atan2(-p[1],p[0])))}toMat2(){let e=ke(this.angle),s=Math.cos(e),n=Math.sin(e);return new Hs(s*this.radiusX,n*this.radiusY,-n*this.radiusX,s*this.radiusY)}transform(e){if(this.angle==0&&e.getRotation()==0)return new Gt(e.multVec2(this.center),e.m[0]*this.radiusX,e.m[5]*this.radiusY);{let s=this.toMat2(),n=e.getRotation(),r=e.getScale();s=us.fromMat2(s).scale(r.x,r.y).rotate(n).toMat2();let h=Gt.fromMat2(s);return h.center=e.multVec2(this.center),h}}bbox(){if(this.angle==0)return Fe.fromPoints(this.center.sub(E(this.radiusX,this.radiusY)),this.center.add(E(this.radiusX,this.radiusY)));{let e=ke(this.angle),s=Math.cos(e),n=Math.sin(e),r=this.radiusX*s,h=this.radiusX*n,u=this.radiusY*n,p=this.radiusY*s,d=Math.sqrt(r*r+u*u),c=Math.sqrt(h*h+p*p);return Fe.fromPoints(this.center.sub(E(d,c)),this.center.add(E(d,c)))}}area(){return this.radiusX*this.radiusY*Math.PI}clone(){return new Gt(this.center,this.radiusX,this.radiusY,this.angle)}collides(e){return vr(this,e)}contains(e){e=e.sub(this.center);let s=ke(this.angle),n=Math.cos(s),r=Math.sin(s),h=e.x*n+e.y*r,u=-e.x*r+e.y*n;return h*h/(this.radiusX*this.radiusX)+u*u/(this.radiusY*this.radiusY)<1}raycast(e,s){return Er(e,s,this)}random(){return this.center}},et=class Ii{static{o(this,"Polygon")}pts;constructor(e){if(e.length<3)throw new Error("Polygons should have at least 3 vertices");this.pts=e}transform(e){return new Ii(this.pts.map(s=>e.multVec2(s)))}bbox(){let e=E(Number.MAX_VALUE),s=E(-Number.MAX_VALUE);for(let n of this.pts)e.x=Math.min(e.x,n.x),s.x=Math.max(s.x,n.x),e.y=Math.min(e.y,n.y),s.y=Math.max(s.y,n.y);return Fe.fromPoints(e,s)}area(){let e=0,s=this.pts.length;for(let n=0;n<s;n++){let r=this.pts[n],h=this.pts[(n+1)%s];e+=r.x*h.y*.5,e-=h.x*r.y*.5}return Math.abs(e)}clone(){return new Ii(this.pts.map(e=>e.clone()))}collides(e){return xr(this,e)}contains(e){return this.collides(e)}raycast(e,s){return Vr(e,s,this)}random(){return E()}};function Rr(t,e,s,n){let r=n*n,h=1-n,u=h*h;return t.scale(u).add(e.scale(2*h*n)).add(s.scale(r))}o(Rr,"evaluateQuadratic");function Pr(t,e,s,n){let r=1-n;return e.sub(t).scale(2*r).add(s.sub(e).scale(2*n))}o(Pr,"evaluateQuadraticFirstDerivative");function kr(t,e,s,n){return s.sub(e.scale(2)).add(t).scale(2)}o(kr,"evaluateQuadraticSecondDerivative");function Ys(t,e,s,n,r){let h=r*r,u=h*r,p=1-r,d=p*p,c=d*p;return t.scale(c).add(e.scale(3*d*r)).add(s.scale(3*p*h)).add(n.scale(u))}o(Ys,"evaluateBezier");function Cr(t,e,s,n,r){let h=r*r,u=1-r,p=u*u;return e.sub(t).scale(3*p).add(s.sub(e).scale(6*u*r)).add(n.sub(s).scale(3*h))}o(Cr,"evaluateBezierFirstDerivative");function Tr(t,e,s,n,r){let h=1-r;return s.sub(e.scale(2)).add(t).scale(6*h).add(n.sub(s.scale(2)).add(e).scale(6*r))}o(Tr,"evaluateBezierSecondDerivative");function Ir(t,e,s,n,r){let h=.5*(((-r+2)*r-1)*r),u=.5*((3*r-5)*r*r+2),p=.5*(((-3*r+4)*r+1)*r),d=.5*((r-1)*r*r);return t.scale(h).add(e.scale(u)).add(s.scale(p)).add(n.scale(d))}o(Ir,"evaluateCatmullRom");function Br(t,e,s,n,r){let h=.5*((-3*r+4)*r-1),u=.5*((9*r-10)*r),p=.5*((-9*r+8)*r+1),d=.5*((3*r-2)*r);return t.scale(h).add(e.scale(u)).add(s.scale(p)).add(n.scale(d))}o(Br,"evaluateCatmullRomFirstDerivative");function Fr(t){let e=en(t),s=e(1);return n=>{let r=n*s,h=e(r,!0);return t(h)}}o(Fr,"normalizedCurve");function en(t,e=10,s=10){let n=[0],r=[0],h=1/(e-1)/s,u=0,p=t(0),d=0;for(let c=1;c<e;c++){for(let P=0;P<s;P++){d+=h;let y=t(d),C=y.dist(p);u+=C,p=y}n[c]=u,r[c]=d}return r[e-1]=1,(c,P=!1)=>{if(P){let y=c;if(y<=0)return 0;if(y>=u)return 1;let C=0;for(;n[C+1]<y;)C++;let x=r[C],W=r[C+1],Y=n[C],Q=n[C+1],j=(y-Y)/(Q-Y);return x+(W-x)*j}else{if(c<=0)return 0;if(c>=1)return n[e-1];let y=0;for(;r[y+1]<c;)y++;let C=r[y],x=r[y+1],W=n[y],Y=n[y+1],Q=(c-C)/(x-C);return W+(Y-W)*Q}}}o(en,"curveLengthApproximation");function Ht(t){return 0<=t&&t<=1}o(Ht,"inZeroOneDomain");function Us(t,e){return Math.abs(t-e)<=Number.EPSILON}o(Us,"approximately");function Yt(t){return t<0?-Math.pow(-t,1/3):Math.pow(t,1/3)}o(Yt,"cubeRoot");function Dr(t,e,s,n){let r=3*t-6*e+3*s,h=-3*t+3*e,u=t,p=-t+3*e-3*s+n;if(Us(p,0)){if(Us(r,0))return Us(h,0)?[]:[-u/h].filter(Ht);let Q=Math.sqrt(h*h-4*r*u),j=2*r;return[(Q-h)/j,(-h-Q)/j].filter(Ht)}r/=p,h/=p,u/=p;let d=(3*h-r*r)/3,c=d/3,P=(2*r*r*r-9*r*h+27*u)/27,y=P/2,C=y*y+c*c*c;if(C<0){let Q=-d/3,j=Q*Q*Q,Z=Math.sqrt(j),M=-P/(2*Z),ne=M<-1?-1:M>1?1:M,K=Math.acos(ne),re=2*Yt(Z),N=re*Math.cos(K/3)-r/3,G=re*Math.cos((K+2*Math.PI)/3)-r/3,he=re*Math.cos((K+4*Math.PI)/3)-r/3;return[N,G,he].filter(Ht)}if(C===0){let Q=y<0?Yt(-y):-Yt(y),j=2*Q-r/3,Z=-Q-r/3;return[j,Z].filter(Ht)}let x=Math.sqrt(C),W=Yt(x-y),Y=Yt(x+y);return[W-Y-r/3].filter(Ht)}o(Dr,"getCubicRoots");function Or(t,e,s,n,r){let h=Dr(t.x-r,e.x-r,s.x-r,n.x-r);return h.length>0?Ys(t,e,s,n,h[0]).y:NaN}o(Or,"cubicBezierYforX");function Ur(t){if(!t||t.length==0)throw new Error("Need at least one point for easingLinear.");let e=t.length;return s=>{if(s<=0||t.length==1||s<=t[0].x)return t[0].y;for(let n=0;n<e;n++)if(t[n].x>=s)return ut(s,t[n-1].x,t[n].x,t[n-1].y,t[n].y);return t[t.length-1].y}}o(Ur,"easingLinear");function Lr(t,e){return s=>Or(E(0,0),t,e,E(1,1),s)}o(Lr,"easingCubicBezier");function Wr(t,e="jump-end"){let s=1/t,n=e=="jump-start"||e=="jump-both",r=e=="jump-end"||e=="jump-both",h=1/(t+(r?1:0)),u=n?h:0;return p=>{let d=Math.floor(p/s);return u+d*h}}o(Wr,"easingSteps");function Nr(t,e){let s=Number.MAX_VALUE,n=E(0);for(let r of[t,e])for(let h=0;h<r.pts.length;h++){let u=r.pts[h],p=r.pts[(h+1)%r.pts.length].sub(u).normal().unit(),d=Number.MAX_VALUE,c=-Number.MAX_VALUE;for(let x=0;x<t.pts.length;x++){let W=t.pts[x].dot(p);d=Math.min(d,W),c=Math.max(c,W)}let P=Number.MAX_VALUE,y=-Number.MAX_VALUE;for(let x=0;x<e.pts.length;x++){let W=e.pts[x].dot(p);P=Math.min(P,W),y=Math.max(y,W)}let C=Math.min(c,y)-Math.max(d,P);if(C<0)return null;if(C<Math.abs(s)){let x=y-d,W=P-c;s=Math.abs(x)<Math.abs(W)?x:W,n=p.scale(s)}}return n}o(Nr,"sat");function tn(t,e,s){return(e.x-t.x)*(s.y-t.y)-(e.y-t.y)*(s.x-t.x)>=0}o(tn,"isOrientedCcw");function qr(t){let e=0,s=t[t.length-1];for(let n=0;n<t.length;n++)e+=(t[n].x-s.x)*(t[n].y+s.y),s=t[n];return e<0}o(qr,"isOrientedCcwPolygon");function Ls(t,e,s,n){let r=n.x-s.x,h=n.y-s.y,u=r*(t.y-s.y)-h*(t.x-s.x),p=r*(e.y-s.y)-h*(e.x-s.x);return u*p>=0}o(Ls,"onSameSide");function jr(t,e,s,n){return Ls(t,e,s,n)&&Ls(t,s,e,n)&&Ls(t,n,e,s)}o(jr,"pointInTriangle");function Gr(t,e,s,n){for(let r of t)if(r!==e&&r!==s&&r!==n&&jr(r,e,s,n))return!0;return!1}o(Gr,"someInTriangle");function Hr(t,e,s,n){return tn(t,e,s)&&!Gr(n,t,e,s)}o(Hr,"isEar");function Bi(t){if(t.length<3)return[];if(t.length==3)return[t];let e=[],s=[],n=0;for(let y=0;y<t.length;y++){let C=t[n],x=t[y];(x.x<C.x||x.x==C.x&&x.y<C.y)&&(n=n),e[y]=y+1,s[y]=y-1}e[e.length-1]=0,s[0]=s.length-1,qr(t)||([e,s]=[s,e]);let r=[];for(let y=0;y<t.length;++y)tn(t[s[y]],t[y],t[e[y]])||r.push(t[y]);let h=[],u=t.length,p=1,d=0,c,P;for(;u>3;){c=e[p],P=s[p];let y=t[P],C=t[p],x=t[c];if(Hr(y,C,x,r))h.push([y,C,x]),e[P]=c,s[c]=P,r.splice(r.indexOf(C),1),--u,d=0;else if(++d>u)return[];p=c}return c=e[p],P=s[p],h.push([t[P],t[p],t[c]]),h}o(Bi,"triangulate");function Yr(t){if(t.length<3)return!1;let e=t.length-2,s=t.length-1,n=0,r=t[s].sub(t[e]),h=t[n].sub(t[s]),u=r.cross(h);for(;n+1<t.length;)if(e=s,s=n,n++,r=t[s].sub(t[e]),h=t[n].sub(t[s]),r.cross(h)*u<0)return!1;return!0}o(Yr,"isConvex");var Kr=class extends Map{static{o(this,"Registry")}lastID=0;push(t){let e=this.lastID;return this.set(e,t),this.lastID++,e}pushd(t){let e=this.push(t);return()=>this.delete(e)}},Kt=class Qr{static{o(this,"KEventController")}paused=!1;cancel;constructor(e){this.cancel=e}static join(e){let s=new Qr(()=>e.forEach(n=>n.cancel()));return Object.defineProperty(s,"paused",{get:o(()=>e[0].paused,"get"),set:o(n=>e.forEach(r=>r.paused=n),"set")}),s.paused=!1,s}},Xe=class{static{o(this,"KEvent")}handlers=new Kr;add(t){let e=this.handlers.pushd((...n)=>{s.paused||t(...n)}),s=new Kt(e);return s}addOnce(t){let e=this.add((...s)=>{e.cancel(),t(...s)});return e}next(){return new Promise(t=>this.addOnce(t))}trigger(...t){this.handlers.forEach(e=>e(...t))}numListeners(){return this.handlers.size}clear(){this.handlers.clear()}},ds=class{static{o(this,"KEventHandler")}handlers={};on(t,e){return this.handlers[t]||(this.handlers[t]=new Xe),this.handlers[t].add(e)}onOnce(t,e){let s=this.on(t,(...n)=>{s.cancel(),e(...n)});return s}next(t){return new Promise(e=>{this.onOnce(t,(...s)=>e(s[0]))})}trigger(t,...e){this.handlers[t]&&this.handlers[t].trigger(...e)}remove(t){delete this.handlers[t]}clear(){this.handlers={}}numListeners(t){return this.handlers[t]?.numListeners()??0}};function $s(t,e){if(t===e)return!0;let s=typeof t,n=typeof e;if(s!==n)return!1;if(s==="object"&&n==="object"&&t!==null&&e!==null){if(Array.isArray(t)!==Array.isArray(e))return!1;let r=Object.keys(t),h=Object.keys(e);if(r.length!==h.length)return!1;for(let u of r){let p=t[u],d=e[u];if(!$s(p,d))return!1}return!0}return!1}o($s,"deepEq");function zr(t){let e=window.atob(t),s=e.length,n=new Uint8Array(s);for(let r=0;r<s;r++)n[r]=e.charCodeAt(r);return n.buffer}o(zr,"base64ToArrayBuffer");function Xr(t){return zr(t.split(",")[1])}o(Xr,"dataURLToArrayBuffer");function ei(t,e){let s=document.createElement("a");s.href=e,s.download=t,s.click()}o(ei,"download");function sn(t,e){ei(t,"data:text/plain;charset=utf-8,"+e)}o(sn,"downloadText");function Jr(t,e){sn(t,JSON.stringify(e))}o(Jr,"downloadJSON");function Fi(t,e){let s=URL.createObjectURL(e);ei(t,s),URL.revokeObjectURL(s)}o(Fi,"downloadBlob");var $n=o(t=>t.match(/^data:\w+\/\w+;base64,.+/),"isDataURL"),wa=o(t=>t.split(".").slice(0,-1).join("."),"getFileName");function Be(t,e){return(...s)=>{let n=s.length;if(n===t.length)return t(...s);if(n===e.length)return e(...s)}}o(Be,"overload2");var ya=(()=>{let t=0;return()=>t++})(),Aa=o(t=>t instanceof Error?t.message:String(t),"getErrorMessage"),_r=class{static{o(this,"BinaryHeap")}_items;_compareFn;constructor(t=(e,s)=>e<s){this._compareFn=t,this._items=[]}insert(t){this._items.push(t),this.moveUp(this._items.length-1)}remove(){if(this._items.length===0)return null;let t=this._items[0],e=this._items.pop();return this._items.length!==0&&(this._items[0]=e,this.moveDown(0)),t}clear(){this._items.splice(0,this._items.length)}moveUp(t){for(;t>0;){let e=Math.floor((t-1)/2);if(!this._compareFn(this._items[t],this._items[e])&&this._items[t]>=this._items[e])break;this.swap(t,e),t=e}}moveDown(t){for(;t<Math.floor(this._items.length/2);){let e=2*t+1;if(e<this._items.length-1&&!this._compareFn(this._items[e],this._items[e+1])&&++e,this._compareFn(this._items[t],this._items[e]))break;this.swap(t,e),t=e}}swap(t,e){[this._items[t],this._items[e]]=[this._items[e],this._items[t]]}get length(){return this._items.length}},xa=Object.freeze([776,2359,2367,2984,3007,3021,3633,3635,3648,3657,4352,4449,4520]);function Zr(t){if(typeof t!="string")throw new TypeError("string cannot be undefined or null");let e=[],s=0,n=0;for(;s<t.length;){if(n+=$r(s+n,t),oo(t[s+n])&&n++,io(t[s+n])&&n++,no(t[s+n])&&n++,ao(t[s+n])){n++;continue}e.push(t.substring(s,s+n)),s+=n,n=0}return e}o(Zr,"runes");function $r(t,e){let s=e[t];if(!eo(s)||t===e.length-1)return 1;let n=s+e[t+1],r=e.substring(t+2,t+5);return Di(n)&&Di(r)?4:to(n)&&ro(r)?e.slice(t).indexOf(String.fromCodePoint(917631))+2:so(r)?4:2}o($r,"nextUnits");function eo(t){return t&&Mt(t[0].charCodeAt(0),55296,56319)}o(eo,"isFirstOfSurrogatePair");function Di(t){return Mt(ti(t),127462,127487)}o(Di,"isRegionalIndicator");function to(t){return Mt(ti(t),127988,127988)}o(to,"isSubdivisionFlag");function so(t){return Mt(ti(t),127995,127999)}o(so,"isFitzpatrickModifier");function io(t){return typeof t=="string"&&Mt(t.charCodeAt(0),65024,65039)}o(io,"isVariationSelector");function no(t){return typeof t=="string"&&Mt(t.charCodeAt(0),8400,8447)}o(no,"isDiacriticalMark");function ro(t){let e=t.codePointAt(0);return typeof t=="string"&&typeof e=="number"&&Mt(e,917504,917631)}o(ro,"isSupplementarySpecialpurposePlane");function oo(t){return typeof t=="string"&&xa.includes(t.charCodeAt(0))}o(oo,"isGrapheme");function ao(t){return typeof t=="string"&&t.charCodeAt(0)===8205}o(ao,"isZeroWidthJoiner");function ti(t){let e=t.charCodeAt(0)-55296,s=t.charCodeAt(1)-56320;return(e<<10)+s+65536}o(ti,"codePointFromSurrogatePair");function Mt(t,e,s){return t>=e&&t<=s}o(Mt,"betweenInclusive");function lo(t){return t?.prototype&&Object.getOwnPropertyDescriptor(t.prototype,"constructor")!==void 0}o(lo,"isClass");var Je=o((t,e)=>Array.isArray(t)?t?.includes(e):t===e,"isEqOrIncludes"),at=o((t,e)=>Array.isArray(e)?e.some(s=>t.has(s)):t.has(e),"setHasOrIncludes"),er={"Joy-Con L+R (STANDARD GAMEPAD Vendor: 057e Product: 200e)":{buttons:{0:"south",1:"east",2:"west",3:"north",4:"lshoulder",5:"rshoulder",6:"ltrigger",7:"rtrigger",8:"select",9:"start",10:"lstick",11:"rstick",12:"dpad-up",13:"dpad-down",14:"dpad-left",15:"dpad-right",16:"home",17:"capture"},sticks:{left:{x:0,y:1},right:{x:2,y:3}}},"Joy-Con (L) (STANDARD GAMEPAD Vendor: 057e Product: 2006)":{buttons:{0:"south",1:"east",2:"west",3:"north",4:"lshoulder",5:"rshoulder",9:"select",10:"lstick",16:"start"},sticks:{left:{x:0,y:1}}},"Joy-Con (R) (STANDARD GAMEPAD Vendor: 057e Product: 2007)":{buttons:{0:"south",1:"east",2:"west",3:"north",4:"lshoulder",5:"rshoulder",9:"start",10:"lstick",16:"select"},sticks:{left:{x:0,y:1}}},"Pro Controller (STANDARD GAMEPAD Vendor: 057e Product: 2009)":{buttons:{0:"south",1:"east",2:"west",3:"north",4:"lshoulder",5:"rshoulder",6:"ltrigger",7:"rtrigger",8:"select",9:"start",10:"lstick",11:"rstick",12:"dpad-up",13:"dpad-down",14:"dpad-left",15:"dpad-right",16:"home",17:"capture"},sticks:{left:{x:0,y:1},right:{x:2,y:3}}},default:{buttons:{0:"south",1:"east",2:"west",3:"north",4:"lshoulder",5:"rshoulder",6:"ltrigger",7:"rtrigger",8:"select",9:"start",10:"lstick",11:"rstick",12:"dpad-up",13:"dpad-down",14:"dpad-left",15:"dpad-right",16:"home"},sticks:{left:{x:0,y:1},right:{x:2,y:3}}}},ps=class{static{o(this,"ButtonState")}pressed=new Set([]);pressedRepeat=new Set([]);released=new Set([]);down=new Set([]);update(){this.pressed.clear(),this.released.clear(),this.pressedRepeat.clear()}press(t){this.pressed.add(t),this.pressedRepeat.add(t),this.down.add(t)}pressRepeat(t){this.pressedRepeat.add(t)}release(t){this.down.delete(t),this.pressed.delete(t),this.released.add(t)}},va=class{static{o(this,"GamepadState")}buttonState=new ps;stickState=new Map},ba=class{static{o(this,"FPSCounter")}dts=[];timer=0;fps=0;tick(t){this.dts.push(t),this.timer+=t,this.timer>=1&&(this.timer=0,this.fps=Math.round(1/(this.dts.reduce((e,s)=>e+s)/this.dts.length)),this.dts=[])}},Va=o(t=>{if(!t.canvas)throw new Error("Please provide a canvas");let e={canvas:t.canvas,buttons:t.buttons??{},loopID:null,stopped:!1,dt:0,time:0,realTime:0,fpsCounter:new ba,timeScale:1,skipTime:!1,isHidden:!1,numFrames:0,mousePos:new I(0),mouseDeltaPos:new I(0),keyState:new ps,mouseState:new ps,mergedGamepadState:new va,gamepadStates:new Map,buttonState:new ps,gamepads:[],charInputted:[],isMouseMoved:!1,lastWidth:t.canvas.offsetWidth,lastHeight:t.canvas.offsetHeight,events:new ds};function s(){return e.dt*e.timeScale}o(s,"dt");function n(){return e.isHidden}o(n,"isHidden");function r(){return e.time}o(r,"time");function h(){return e.fpsCounter.fps}o(h,"fps");function u(){return e.numFrames}o(u,"numFrames");function p(){return e.canvas.toDataURL()}o(p,"screenshot");function d(g){e.canvas.style.cursor=g}o(d,"setCursor");function c(){return e.canvas.style.cursor}o(c,"getCursor");function P(g){if(g)try{let b=e.canvas.requestPointerLock();b.catch&&b.catch(B=>console.error(B))}catch(b){console.error(b)}else document.exitPointerLock()}o(P,"setCursorLocked");function y(){return!!document.pointerLockElement}o(y,"isCursorLocked");function C(g){g.requestFullscreen?g.requestFullscreen():g.webkitRequestFullscreen&&g.webkitRequestFullscreen()}o(C,"enterFullscreen");function x(){document.exitFullscreen?document.exitFullscreen():document.webkitExitFullScreen&&document.webkitExitFullScreen()}o(x,"exitFullscreen");function W(g=!0){g?C(e.canvas):x()}o(W,"setFullscreen");function Y(){return document.fullscreenElement===e.canvas||document.webkitFullscreenElement===e.canvas}o(Y,"isFullscreen");function Q(){e.stopped=!0;for(let g in Ue)e.canvas.removeEventListener(g,Ue[g]);for(let g in bt)document.removeEventListener(g,bt[g]);for(let g in st)window.removeEventListener(g,st[g]);Wt.disconnect()}o(Q,"quit");function j(g){e.loopID!==null&&cancelAnimationFrame(e.loopID);let b=0,B=o($=>{if(e.stopped)return;if(document.visibilityState!=="visible"){e.loopID=requestAnimationFrame(B);return}let Me=$/1e3,de=Me-e.realTime,He=t.maxFPS?1/t.maxFPS:0;e.realTime=Me,b+=de,b>He&&(e.skipTime||(e.dt=b,e.time+=s(),e.fpsCounter.tick(e.dt)),b=0,e.skipTime=!1,e.numFrames++,ss(),g(),pt()),e.loopID=requestAnimationFrame(B)},"frame");B(0)}o(j,"run");function Z(){return"ontouchstart"in window||navigator.maxTouchPoints>0}o(Z,"isTouchscreen");function M(){return e.mousePos.clone()}o(M,"mousePos");function ne(){return e.mouseDeltaPos.clone()}o(ne,"mouseDeltaPos");function K(g="left"){return e.mouseState.pressed.has(g)}o(K,"isMousePressed");function re(g="left"){return e.mouseState.down.has(g)}o(re,"isMouseDown");function N(g="left"){return e.mouseState.released.has(g)}o(N,"isMouseReleased");function G(){return e.isMouseMoved}o(G,"isMouseMoved");function he(g){return g===void 0?e.keyState.pressed.size>0:at(e.keyState.pressed,g)}o(he,"isKeyPressed");function ge(g){return g===void 0?e.keyState.pressedRepeat.size>0:at(e.keyState.pressedRepeat,g)}o(ge,"isKeyPressedRepeat");function ae(g){return g===void 0?e.keyState.down.size>0:at(e.keyState.down,g)}o(ae,"isKeyDown");function ye(g){return g===void 0?e.keyState.released.size>0:at(e.keyState.released,g)}o(ye,"isKeyReleased");function ce(g){return g===void 0?e.mergedGamepadState.buttonState.pressed.size>0:at(e.mergedGamepadState.buttonState.pressed,g)}o(ce,"isGamepadButtonPressed");function De(g){return g===void 0?e.mergedGamepadState.buttonState.down.size>0:at(e.mergedGamepadState.buttonState.down,g)}o(De,"isGamepadButtonDown");function ue(g){return g===void 0?e.mergedGamepadState.buttonState.released.size>0:at(e.mergedGamepadState.buttonState.released,g)}o(ue,"isGamepadButtonReleased");function Oe(g){return g===void 0?e.buttonState.pressed.size>0:at(e.buttonState.pressed,g)}o(Oe,"isButtonPressed");function le(g){return g===void 0?e.buttonState.down.size>0:at(e.buttonState.down,g)}o(le,"isButtonDown");function fe(g){return g===void 0?e.buttonState.released.size>0:at(e.buttonState.released,g)}o(fe,"isButtonReleased");function Ae(g){return e.buttons?.[g]}o(Ae,"getButton");function ve(g,b){e.buttons[g]={...e.buttons[g],...b}}o(ve,"setButton");function be(g){for(let b in e.buttons)if((e.buttons[b].keyboard?.length?e.buttons[b].keyboard:[b]).includes(g))return Object.keys(e.buttons).find(B=>e.buttons[B]===e.buttons[b])}o(be,"getButtonNameByKey");function qe(g){for(let b in e.buttons)if((e.buttons[b].gamepad?.length?e.buttons[b].gamepad:[b]).includes(g))return Object.keys(e.buttons).find(B=>e.buttons[B]===e.buttons[b])}o(qe,"getButtonByGamepadButton");function J(g){for(let b in e.buttons)if((e.buttons[b].mouse?.length?e.buttons[b].mouse:[b]).includes(g))return Object.keys(e.buttons).find(B=>e.buttons[B]===e.buttons[b])}o(J,"getButtonByMouseButton");function xt(g){return e.events.on("resize",g)}o(xt,"onResize");let zt=Be(g=>e.events.on("keyDown",g),(g,b)=>e.events.on("keyDown",B=>Je(g,B)&&b(B))),Es=Be(g=>e.events.on("keyPress",b=>g(b)),(g,b)=>e.events.on("keyPress",B=>Je(g,B)&&b(B))),Xt=Be(g=>e.events.on("keyPressRepeat",g),(g,b)=>e.events.on("keyPressRepeat",B=>Je(g,B)&&b(B))),Ss=Be(g=>e.events.on("keyRelease",g),(g,b)=>e.events.on("keyRelease",B=>Je(g,B)&&b(B))),Ms=Be(g=>e.events.on("mouseDown",b=>g(b)),(g,b)=>e.events.on("mouseDown",B=>Je(g,B)&&b(B))),Jt=Be(g=>e.events.on("mousePress",b=>g(b)),(g,b)=>e.events.on("mousePress",B=>Je(g,B)&&b(B))),Rs=Be(g=>e.events.on("mouseRelease",b=>g(b)),(g,b)=>e.events.on("mouseRelease",B=>B===g&&b(B)));function _t(g){return e.events.on("mouseMove",()=>g(M(),ne()))}o(_t,"onMouseMove");function Bt(g){return e.events.on("charInput",g)}o(Bt,"onCharInput");function Ft(g){return e.events.on("touchStart",g)}o(Ft,"onTouchStart");function Zt(g){return e.events.on("touchMove",g)}o(Zt,"onTouchMove");function Rt(g){return e.events.on("touchEnd",g)}o(Rt,"onTouchEnd");function $t(g){return e.events.on("scroll",g)}o($t,"onScroll");function tt(g){return e.events.on("hide",g)}o(tt,"onHide");function Le(g){return e.events.on("show",g)}o(Le,"onShow");let Dt=Be(g=>e.events.on("gamepadButtonPress",b=>g(b)),(g,b)=>e.events.on("gamepadButtonPress",B=>Je(g,B)&&b(B))),Ps=Be(g=>e.events.on("gamepadButtonDown",b=>g(b)),(g,b)=>e.events.on("gamepadButtonDown",B=>Je(g,B)&&b(B))),Ot=Be(g=>e.events.on("gamepadButtonRelease",b=>g(b)),(g,b)=>e.events.on("gamepadButtonRelease",B=>Je(g,B)&&b(B)));function es(g,b){return e.events.on("gamepadStick",(B,$)=>B===g&&b($))}o(es,"onGamepadStick");function ts(g){e.events.on("gamepadConnect",g)}o(ts,"onGamepadConnect");function Ve(g){e.events.on("gamepadDisconnect",g)}o(Ve,"onGamepadDisconnect");function dt(g){return e.mergedGamepadState.stickState.get(g)||new I(0)}o(dt,"getGamepadStick");function rt(){return[...e.charInputted]}o(rt,"charInputted");function We(){return[...e.gamepads]}o(We,"getGamepads");let je=Be(g=>e.events.on("buttonPress",b=>g(b)),(g,b)=>e.events.on("buttonPress",B=>Je(g,B)&&b(B))),vt=Be(g=>e.events.on("buttonDown",b=>g(b)),(g,b)=>e.events.on("buttonDown",B=>Je(g,B)&&b(B))),Ut=Be(g=>e.events.on("buttonRelease",b=>g(b)),(g,b)=>e.events.on("buttonRelease",B=>Je(g,B)&&b(B)));function ss(){e.events.trigger("input"),e.keyState.down.forEach(g=>e.events.trigger("keyDown",g)),e.mouseState.down.forEach(g=>e.events.trigger("mouseDown",g)),e.buttonState.down.forEach(g=>e.events.trigger("buttonDown",g)),is()}o(ss,"processInput");function pt(){e.keyState.update(),e.mouseState.update(),e.buttonState.update(),e.mergedGamepadState.buttonState.update(),e.mergedGamepadState.stickState.forEach((g,b)=>{e.mergedGamepadState.stickState.set(b,new I(0))}),e.charInputted=[],e.isMouseMoved=!1,e.gamepadStates.forEach(g=>{g.buttonState.update(),g.stickState.forEach((b,B)=>{g.stickState.set(B,new I(0))})})}o(pt,"resetInput");function Ge(g){let b={index:g.index,isPressed:o(B=>e.gamepadStates.get(g.index).buttonState.pressed.has(B),"isPressed"),isDown:o(B=>e.gamepadStates.get(g.index).buttonState.down.has(B),"isDown"),isReleased:o(B=>e.gamepadStates.get(g.index).buttonState.released.has(B),"isReleased"),getStick:o(B=>e.gamepadStates.get(g.index).stickState.get(B),"getStick")};return e.gamepads.push(b),e.gamepadStates.set(g.index,{buttonState:new ps,stickState:new Map([["left",new I(0)],["right",new I(0)]])}),b}o(Ge,"registerGamepad");function ft(g){e.gamepads=e.gamepads.filter(b=>b.index!==g.index),e.gamepadStates.delete(g.index)}o(ft,"removeGamepad");function is(){for(let g of navigator.getGamepads())g&&!e.gamepadStates.has(g.index)&&Ge(g);for(let g of e.gamepads){let b=navigator.getGamepads()[g.index],B=(t.gamepads??{})[b.id]??er[b.id]??er.default,$=e.gamepadStates.get(g.index);for(let Me=0;Me<b.buttons.length;Me++){let de=B.buttons[Me],He=b.buttons[Me],ot=qe(de);He.pressed?($.buttonState.down.has(de)||(e.mergedGamepadState.buttonState.press(de),$.buttonState.press(de),e.buttonState.press(ot),e.events.trigger("gamepadButtonPress",de),e.events.trigger("buttonPress",ot)),e.events.trigger("gamepadButtonDown",de),e.events.trigger("buttonDown",ot)):$.buttonState.down.has(de)&&(e.mergedGamepadState.buttonState.release(de),$.buttonState.release(de),e.buttonState.release(ot),e.events.trigger("gamepadButtonRelease",de),e.events.trigger("buttonRelease",ot))}for(let Me in B.sticks){let de=B.sticks[Me],He=new I(b.axes[de.x],b.axes[de.y]);$.stickState.set(Me,He),e.mergedGamepadState.stickState.set(Me,He),e.events.trigger("gamepadStick",Me,He)}}}o(is,"processGamepad");let Ue={},bt={},st={},Lt=t.pixelDensity||window.devicePixelRatio||1;Ue.mousemove=g=>{let b=new I(g.offsetX,g.offsetY),B=new I(g.movementX,g.movementY);if(Y()){let $=e.canvas.width/Lt,Me=e.canvas.height/Lt,de=window.innerWidth,He=window.innerHeight,ot=de/He,os=$/Me;if(ot>os){let Ye=He/Me,kt=(de-$*Ye)/2;b.x=ut(g.offsetX-kt,0,$*Ye,0,$),b.y=ut(g.offsetY,0,Me*Ye,0,Me)}else{let Ye=de/$,kt=(He-Me*Ye)/2;b.x=ut(g.offsetX,0,$*Ye,0,$),b.y=ut(g.offsetY-kt,0,Me*Ye,0,Me)}}e.events.onOnce("input",()=>{e.isMouseMoved=!0,e.mousePos=b,e.mouseDeltaPos=B,e.events.trigger("mouseMove")})};let ns=["left","middle","right","back","forward"];Ue.mousedown=g=>{e.events.onOnce("input",()=>{let b=ns[g.button];if(!b)return;let B=J(b);e.mouseState.press(b),e.buttonState.press(B),e.events.trigger("mousePress",b),e.events.trigger("buttonPress",B)})},Ue.mouseup=g=>{e.events.onOnce("input",()=>{let b=ns[g.button];if(!b)return;let B=J(b);e.mouseState.release(b),e.buttonState.release(B),e.events.trigger("mouseRelease",b),e.events.trigger("buttonRelease",B)})};let rs=new Set([" ","ArrowLeft","ArrowRight","ArrowUp","ArrowDown","Tab"]),Pt={ArrowLeft:"left",ArrowRight:"right",ArrowUp:"up",ArrowDown:"down"," ":"space"};Ue.keydown=g=>{rs.has(g.key)&&g.preventDefault(),e.events.onOnce("input",()=>{let b=Pt[g.key]||g.key.toLowerCase();if(b.length===1?(e.events.trigger("charInput",b),e.charInputted.push(b)):b==="space"&&(e.events.trigger("charInput"," "),e.charInputted.push(" ")),g.repeat)e.keyState.pressRepeat(b),e.events.trigger("keyPressRepeat",b);else{let B=be(b);e.keyState.press(b),e.buttonState.press(B),e.events.trigger("keyPressRepeat",b),e.events.trigger("keyPress",b),e.events.trigger("buttonPress",B)}})},Ue.keyup=g=>{e.events.onOnce("input",()=>{let b=Pt[g.key]||g.key.toLowerCase(),B=be(b);e.keyState.release(b),e.buttonState.release(B),e.events.trigger("keyRelease",b),e.events.trigger("buttonRelease",B)})},Ue.touchstart=g=>{g.preventDefault(),e.events.onOnce("input",()=>{let b=[...g.changedTouches],B=e.canvas.getBoundingClientRect();if(t.touchToMouse!==!1){e.mousePos=new I(b[0].clientX-B.x,b[0].clientY-B.y);let $=J("left");e.mouseState.press("left"),e.buttonState.press($),e.events.trigger("mousePress","left"),e.events.trigger("buttonPress",$)}b.forEach($=>{e.events.trigger("touchStart",new I($.clientX-B.x,$.clientY-B.y),$)})})},Ue.touchmove=g=>{g.preventDefault(),e.events.onOnce("input",()=>{let b=[...g.changedTouches],B=e.canvas.getBoundingClientRect();if(t.touchToMouse!==!1){let $=e.mousePos;e.mousePos=new I(b[0].clientX-B.x,b[0].clientY-B.y),e.mouseDeltaPos=e.mousePos.sub($),e.events.trigger("mouseMove")}b.forEach($=>{e.events.trigger("touchMove",new I($.clientX-B.x,$.clientY-B.y),$)})})},Ue.touchend=g=>{e.events.onOnce("input",()=>{let b=[...g.changedTouches],B=e.canvas.getBoundingClientRect();if(t.touchToMouse!==!1){e.mousePos=new I(b[0].clientX-B.x,b[0].clientY-B.y),e.mouseDeltaPos=new I(0,0);let $=J("left");e.buttonState.release($),e.mouseState.release("left"),e.events.trigger("mouseRelease","left"),e.events.trigger("buttonRelease",$)}b.forEach($=>{e.events.trigger("touchEnd",new I($.clientX-B.x,$.clientY-B.y),$)})})},Ue.touchcancel=g=>{e.events.onOnce("input",()=>{let b=[...g.changedTouches],B=e.canvas.getBoundingClientRect();t.touchToMouse!==!1&&(e.mousePos=new I(b[0].clientX-B.x,b[0].clientY-B.y),e.mouseState.release("left"),e.events.trigger("mouseRelease","left")),b.forEach($=>{e.events.trigger("touchEnd",new I($.clientX-B.x,$.clientY-B.y),$)})})},Ue.wheel=g=>{g.preventDefault(),e.events.onOnce("input",()=>{e.events.trigger("scroll",new I(g.deltaX,g.deltaY))})},Ue.contextmenu=g=>g.preventDefault(),bt.visibilitychange=()=>{document.visibilityState==="visible"?(e.skipTime=!0,e.isHidden=!1,e.events.trigger("show")):(e.isHidden=!0,e.events.trigger("hide"))},st.gamepadconnected=g=>{let b=Ge(g.gamepad);e.events.onOnce("input",()=>{e.events.trigger("gamepadConnect",b)})},st.gamepaddisconnected=g=>{let b=We().filter(B=>B.index===g.gamepad.index)[0];ft(g.gamepad),e.events.onOnce("input",()=>{e.events.trigger("gamepadDisconnect",b)})};for(let g in Ue)e.canvas.addEventListener(g,Ue[g]);for(let g in bt)document.addEventListener(g,bt[g]);for(let g in st)window.addEventListener(g,st[g]);let Wt=new ResizeObserver(g=>{for(let b of g)if(b.target===e.canvas){if(e.lastWidth===e.canvas.offsetWidth&&e.lastHeight===e.canvas.offsetHeight)return;e.lastWidth=e.canvas.offsetWidth,e.lastHeight=e.canvas.offsetHeight,e.events.onOnce("input",()=>{e.events.trigger("resize")})}});return Wt.observe(e.canvas),{dt:s,time:r,run:j,canvas:e.canvas,fps:h,numFrames:u,quit:Q,isHidden:n,setFullscreen:W,isFullscreen:Y,setCursor:d,screenshot:p,getGamepads:We,getCursor:c,setCursorLocked:P,isCursorLocked:y,isTouchscreen:Z,mousePos:M,mouseDeltaPos:ne,isKeyDown:ae,isKeyPressed:he,isKeyPressedRepeat:ge,isKeyReleased:ye,isMouseDown:re,isMousePressed:K,isMouseReleased:N,isMouseMoved:G,isGamepadButtonPressed:ce,isGamepadButtonDown:De,isGamepadButtonReleased:ue,getGamepadStick:dt,isButtonPressed:Oe,isButtonDown:le,isButtonReleased:fe,setButton:ve,getButton:Ae,charInputted:rt,onResize:xt,onKeyDown:zt,onKeyPress:Es,onKeyPressRepeat:Xt,onKeyRelease:Ss,onMouseDown:Ms,onMousePress:Jt,onMouseRelease:Rs,onMouseMove:_t,onCharInput:Bt,onTouchStart:Ft,onTouchMove:Zt,onTouchEnd:Rt,onScroll:$t,onHide:tt,onShow:Le,onGamepadButtonDown:Ps,onGamepadButtonPress:Dt,onGamepadButtonRelease:Ot,onGamepadStick:es,onGamepadConnect:ts,onGamepadDisconnect:Ve,onButtonPress:je,onButtonDown:vt,onButtonRelease:Ut,events:e.events}},"default"),Et=class ho{static{o(this,"Texture")}ctx;src=null;glTex;width;height;constructor(e,s,n,r={}){this.ctx=e;let h=e.gl;this.glTex=e.gl.createTexture(),e.onDestroy(()=>this.free()),this.width=s,this.height=n;let u={linear:h.LINEAR,nearest:h.NEAREST}[r.filter??e.opts.texFilter]??h.NEAREST,p={repeat:h.REPEAT,clampToEadge:h.CLAMP_TO_EDGE}[r.wrap]??h.CLAMP_TO_EDGE;this.bind(),s&&n&&h.texImage2D(h.TEXTURE_2D,0,h.RGBA,s,n,0,h.RGBA,h.UNSIGNED_BYTE,null),h.texParameteri(h.TEXTURE_2D,h.TEXTURE_MIN_FILTER,u),h.texParameteri(h.TEXTURE_2D,h.TEXTURE_MAG_FILTER,u),h.texParameteri(h.TEXTURE_2D,h.TEXTURE_WRAP_S,p),h.texParameteri(h.TEXTURE_2D,h.TEXTURE_WRAP_T,p),this.unbind()}static fromImage(e,s,n={}){let r=new ho(e,s.width,s.height,n);return r.update(s),r.src=s,r}update(e,s=0,n=0){let r=this.ctx.gl;this.bind(),r.texSubImage2D(r.TEXTURE_2D,0,s,n,r.RGBA,r.UNSIGNED_BYTE,e),this.unbind()}bind(){this.ctx.pushTexture2D(this.glTex)}unbind(){this.ctx.popTexture2D()}free(){this.ctx.gl.deleteTexture(this.glTex)}},Bs=class{static{o(this,"FrameBuffer")}ctx;tex;glFramebuffer;glRenderbuffer;constructor(t,e,s,n={}){this.ctx=t;let r=t.gl;t.onDestroy(()=>this.free()),this.tex=new Et(t,e,s,n),this.glFramebuffer=r.createFramebuffer(),this.glRenderbuffer=r.createRenderbuffer(),this.bind(),r.renderbufferStorage(r.RENDERBUFFER,r.DEPTH_STENCIL,e,s),r.framebufferTexture2D(r.FRAMEBUFFER,r.COLOR_ATTACHMENT0,r.TEXTURE_2D,this.tex.glTex,0),r.framebufferRenderbuffer(r.FRAMEBUFFER,r.DEPTH_STENCIL_ATTACHMENT,r.RENDERBUFFER,this.glRenderbuffer),this.unbind()}get width(){return this.tex.width}get height(){return this.tex.height}toImageData(){let t=this.ctx.gl,e=new Uint8ClampedArray(this.width*this.height*4);this.bind(),t.readPixels(0,0,this.width,this.height,t.RGBA,t.UNSIGNED_BYTE,e),this.unbind();let s=this.width*4,n=new Uint8Array(s);for(let r=0;r<(this.height/2|0);r++){let h=r*s,u=(this.height-r-1)*s;n.set(e.subarray(h,h+s)),e.copyWithin(h,u,u+s),e.set(n,u)}return new ImageData(e,this.width,this.height)}toDataURL(){let t=document.createElement("canvas"),e=t.getContext("2d");return t.width=this.width,t.height=this.height,e.putImageData(this.toImageData(),0,0),t.toDataURL()}clear(){let t=this.ctx.gl;t.clear(t.COLOR_BUFFER_BIT)}draw(t){this.bind(),t(),this.unbind()}bind(){this.ctx.pushFramebuffer(this.glFramebuffer),this.ctx.pushRenderbuffer(this.glRenderbuffer),this.ctx.pushViewport({x:0,y:0,w:this.width,h:this.height})}unbind(){this.ctx.popFramebuffer(),this.ctx.popRenderbuffer(),this.ctx.popViewport()}free(){let t=this.ctx.gl;t.deleteFramebuffer(this.glFramebuffer),t.deleteRenderbuffer(this.glRenderbuffer),this.tex.free()}},Ea=class{static{o(this,"Shader")}ctx;glProgram;constructor(t,e,s,n){this.ctx=t,t.onDestroy(()=>this.free());let r=t.gl,h=r.createShader(r.VERTEX_SHADER),u=r.createShader(r.FRAGMENT_SHADER);r.shaderSource(h,e),r.shaderSource(u,s),r.compileShader(h),r.compileShader(u);let p=r.createProgram();if(this.glProgram=p,r.attachShader(p,h),r.attachShader(p,u),n.forEach((d,c)=>r.bindAttribLocation(p,c,d)),r.linkProgram(p),!r.getProgramParameter(p,r.LINK_STATUS)){let d=r.getShaderInfoLog(h);if(d)throw new Error("VERTEX SHADER "+d);let c=r.getShaderInfoLog(u);if(c)throw new Error("FRAGMENT SHADER "+c)}r.deleteShader(h),r.deleteShader(u)}bind(){this.ctx.pushProgram(this.glProgram)}unbind(){this.ctx.popProgram()}send(t){let e=this.ctx.gl;for(let s in t){let n=t[s],r=e.getUniformLocation(this.glProgram,s);if(typeof n=="number")e.uniform1f(r,n);else if(n instanceof lt)e.uniformMatrix4fv(r,!1,new Float32Array(n.m));else if(n instanceof pe)e.uniform3f(r,n.r,n.g,n.b);else if(n instanceof I)e.uniform2f(r,n.x,n.y);else if(Array.isArray(n)){let h=n[0];typeof h=="number"?e.uniform1fv(r,n):h instanceof I?e.uniform2fv(r,n.map(u=>[u.x,u.y]).flat()):h instanceof pe&&e.uniform3fv(r,n.map(u=>[u.r,u.g,u.b]).flat())}else throw new Error("Unsupported uniform data type")}}free(){this.ctx.gl.deleteProgram(this.glProgram)}},Sa=class{static{o(this,"BatchRenderer")}ctx;glVBuf;glIBuf;vqueue=[];iqueue=[];stride;maxVertices;maxIndices;vertexFormat;numDraws=0;curPrimitive=null;curTex=null;curShader=null;curUniform={};constructor(t,e,s,n){let r=t.gl;this.vertexFormat=e,this.ctx=t,this.stride=e.reduce((h,u)=>h+u.size,0),this.maxVertices=s,this.maxIndices=n,this.glVBuf=r.createBuffer(),t.pushArrayBuffer(this.glVBuf),r.bufferData(r.ARRAY_BUFFER,s*4,r.DYNAMIC_DRAW),t.popArrayBuffer(),this.glIBuf=r.createBuffer(),t.pushElementArrayBuffer(this.glIBuf),r.bufferData(r.ELEMENT_ARRAY_BUFFER,n*4,r.DYNAMIC_DRAW),t.popElementArrayBuffer()}push(t,e,s,n,r=null,h={}){(t!==this.curPrimitive||r!==this.curTex||n!==this.curShader||!$s(this.curUniform,h)||this.vqueue.length+e.length*this.stride>this.maxVertices||this.iqueue.length+s.length>this.maxIndices)&&this.flush();let u=this.vqueue.length/this.stride;for(let p of e)this.vqueue.push(p);for(let p of s)this.iqueue.push(p+u);this.curPrimitive=t,this.curShader=n,this.curTex=r,this.curUniform=h}flush(){if(!this.curPrimitive||!this.curShader||this.vqueue.length===0||this.iqueue.length===0)return;let t=this.ctx.gl;this.ctx.pushArrayBuffer(this.glVBuf),t.bufferSubData(t.ARRAY_BUFFER,0,new Float32Array(this.vqueue)),this.ctx.pushElementArrayBuffer(this.glIBuf),t.bufferSubData(t.ELEMENT_ARRAY_BUFFER,0,new Uint16Array(this.iqueue)),this.ctx.setVertexFormat(this.vertexFormat),this.curShader.bind(),this.curShader.send(this.curUniform),this.curTex?.bind(),t.drawElements(this.curPrimitive,this.iqueue.length,t.UNSIGNED_SHORT,0),this.curTex?.unbind(),this.curShader.unbind(),this.ctx.popArrayBuffer(),this.ctx.popElementArrayBuffer(),this.vqueue=[],this.iqueue=[],this.numDraws++}free(){let t=this.ctx.gl;t.deleteBuffer(this.glVBuf),t.deleteBuffer(this.glIBuf)}};function Vt(t){let e=[],s=o(h=>{e.push(h),t(h)},"push"),n=o(()=>{e.pop(),t(r()??null)},"pop"),r=o(()=>e[e.length-1],"cur");return[s,n,r]}o(Vt,"genStack");function uo(t,e={}){let s=[];function n(K){s.push(K)}o(n,"onDestroy");function r(){s.forEach(K=>K()),t.getExtension("WEBGL_lose_context").loseContext()}o(r,"destroy");let h=null;function u(K){if($s(K,h))return;h=K;let re=K.reduce((N,G)=>N+G.size,0);K.reduce((N,G,he)=>(t.vertexAttribPointer(he,G.size,t.FLOAT,!1,re*4,N),t.enableVertexAttribArray(he),N+G.size*4),0)}o(u,"setVertexFormat");let[p,d]=Vt(K=>t.bindTexture(t.TEXTURE_2D,K)),[c,P]=Vt(K=>t.bindBuffer(t.ARRAY_BUFFER,K)),[y,C]=Vt(K=>t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,K)),[x,W]=Vt(K=>t.bindFramebuffer(t.FRAMEBUFFER,K)),[Y,Q]=Vt(K=>t.bindRenderbuffer(t.RENDERBUFFER,K)),[j,Z]=Vt(({x:K,y:re,w:N,h:G})=>{t.viewport(K,re,N,G)}),[M,ne]=Vt(K=>t.useProgram(K));return j({x:0,y:0,w:t.drawingBufferWidth,h:t.drawingBufferHeight}),{gl:t,opts:e,onDestroy:n,destroy:r,pushTexture2D:p,popTexture2D:d,pushArrayBuffer:c,popArrayBuffer:P,pushElementArrayBuffer:y,popElementArrayBuffer:C,pushFramebuffer:x,popFramebuffer:W,pushRenderbuffer:Y,popRenderbuffer:Q,pushViewport:j,popViewport:Z,pushProgram:M,popProgram:ne,setVertexFormat:u}}o(uo,"initGfx");var _e=class co{static{o(this,"Asset")}loaded=!1;data=null;error=null;onLoadEvents=new Xe;onErrorEvents=new Xe;onFinishEvents=new Xe;constructor(e){e.then(s=>{this.loaded=!0,this.data=s,this.onLoadEvents.trigger(s)}).catch(s=>{if(this.error=s,this.onErrorEvents.numListeners()>0)this.onErrorEvents.trigger(s);else throw s}).finally(()=>{this.onFinishEvents.trigger(),this.loaded=!0})}static loaded(e){let s=new co(Promise.resolve(e));return s.data=e,s.loaded=!0,s}onLoad(e){return this.loaded&&this.data?e(this.data):this.onLoadEvents.add(e),this}onError(e){return this.loaded&&this.error?e(this.error):this.onErrorEvents.add(e),this}onFinish(e){return this.loaded?e():this.onFinishEvents.add(e),this}then(e){return this.onLoad(e)}catch(e){return this.onError(e)}finally(e){return this.onFinish(e)}},qt=class{static{o(this,"AssetBucket")}assets=new Map;lastUID=0;add(t,e){let s=t??this.lastUID+++"",n=new _e(e);return this.assets.set(s,n),n}addLoaded(t,e){let s=t??this.lastUID+++"",n=_e.loaded(e);return this.assets.set(s,n),n}get(t){return this.assets.get(t)}progress(){if(this.assets.size===0)return 1;let t=0;return this.assets.forEach(e=>{e.loaded&&t++}),t/this.assets.size}};function si(t){return fetch(t).then(e=>{if(!e.ok)throw new Error(`Failed to fetch "${t}"`);return e})}o(si,"fetchURL");function fs(t){return si(t).then(e=>e.json())}o(fs,"fetchJSON");function po(t){return si(t).then(e=>e.text())}o(po,"fetchText");function fo(t){return si(t).then(e=>e.arrayBuffer())}o(fo,"fetchArrayBuffer");function gs(t){let e=new Image;return e.crossOrigin="anonymous",e.src=t,new Promise((s,n)=>{e.onload=()=>s(e),e.onerror=()=>n(new Error(`Failed to load image from "${t}"`))})}o(gs,"loadImg");var tr=" !\"#$%&'()*+,-./0123456789:;<=>?@ABCDEFGHIJKLMNOPQRSTUVWXYZ[\\]^_`abcdefghijklmnopqrstuvwxyz{|}~",Ws="topleft",Ma="monospace",Fs="monospace",Oi="linear",Ui=[{name:"a_pos",size:2},{name:"a_uv",size:2},{name:"a_color",size:4}],Ra=Ui.reduce((t,e)=>t+e.size,0),mo=2048,Pa=mo*4*Ra,ka=mo*6,Ca=`
attribute vec2 a_pos;
attribute vec2 a_uv;
attribute vec4 a_color;

varying vec2 v_pos;
varying vec2 v_uv;
varying vec4 v_color;

vec4 def_vert() {
	return vec4(a_pos, 0.0, 1.0);
}

{{user}}

void main() {
	vec4 pos = vert(a_pos, a_uv, a_color);
	v_pos = a_pos;
	v_uv = a_uv;
	v_color = a_color;
	gl_Position = pos;
}
`,Ta=`
precision mediump float;

varying vec2 v_pos;
varying vec2 v_uv;
varying vec4 v_color;

uniform sampler2D u_tex;

vec4 def_frag() {
	return v_color * texture2D(u_tex, v_uv);
}

{{user}}

void main() {
	gl_FragColor = frag(v_pos, v_uv, v_color, u_tex);
	if (gl_FragColor.a == 0.0) {
		discard;
	}
}
`,Ei=`
vec4 vert(vec2 pos, vec2 uv, vec4 color) {
	return def_vert();
}
`,Si=`
vec4 frag(vec2 pos, vec2 uv, vec4 color, sampler2D tex) {
	return def_frag();
}
`,Ia=new Set(["id","require"]),Ba=new Set(["add","update","draw","destroy","inspect","drawInspect"]),sr=/\[(?<style>\w+)\](?<text>.*?)\[\/\k<style>\]/g,Fa=200,Da=640,Oa=65536;function wo(t,e,s){let n=[],r=e;for(n.push(r);r!==t;){if(r=s.get(r),r==null)return null;n.push(r)}return n.reverse()}o(wo,"buildPath");function yo(t,e,s){let n=new _r((u,p)=>u.cost<p.cost);n.insert({cost:0,node:e});let r=new Map;r.set(e,e);let h=new Map;for(h.set(e,0);n.length!==0;){let u=n.remove()?.node;if(u===s)break;let p=t.getNeighbours(u);for(let d of p){let c=(h.get(u)||0)+t.getCost(u,d)+t.getHeuristic(d,s);(!h.has(d)||c<h.get(d))&&(h.set(d,c),n.insert({cost:c,node:d}),r.set(d,u))}}return wo(e,s,r)}o(yo,"aStarSearch");var Ua=class{static{o(this,"NavEdge")}a;b;polygon;constructor(t,e,s){this.a=t,this.b=e,this.polygon=new WeakRef(s)}isLeft(t,e){return(this.b.x-this.a.x)*(e-this.a.y)-(t-this.a.x)*(this.b.y-this.a.y)}get middle(){return this.a.add(this.b).scale(.5)}},La=class{static{o(this,"NavPolygon")}_edges;_centroid;_id;constructor(t){this._id=t}get id(){return this._id}set edges(t){this._edges=t;let e=0,s=0,n=0;for(let r of this._edges){r.polygon=new WeakRef(this);let h=r.a.x*r.b.y-r.a.y*r.b.x;e+=(r.a.x+r.b.x)*h,s+=(r.a.y+r.b.y)*h,n+=h}n/=2,this._centroid=E(e/(6*n),s/(6*n))}get edges(){return this._edges}get centroid(){return this._centroid}contains(t){let e=!1;for(let s of this.edges)s.b.y>t.y!=s.a.y>t.y&&t.x<(s.a.x-s.b.x)*(t.y-s.b.y)/(s.a.y-s.b.y)+s.b.x&&(e=!e);return e}},Wa=class{static{o(this,"NavMesh")}_polygons;_pointCache;_edgeCache;constructor(){this._polygons=[],this._pointCache={},this._edgeCache={}}_addPoint(t){let e=this._pointCache[`${t.x}_${t.y}`];return e||(e=t.clone(),this._pointCache[`${t.x}_${t.y}`]=e,e)}_addEdge(t){let e=`${t.a.x}_${t.a.y}-${t.b.x}_${t.b.y}`;return this._edgeCache[e]=t,t}_findEdge(t,e){let s=`${t.x}_${t.y}-${e.x}_${e.y}`;return this._edgeCache[s]}_findCommonEdge(t,e){for(let s of t.edges){let n=this._findEdge(s.b,s.a);if(n&&n.polygon.deref().id===e.id)return n}return null}addPolygon(t){let e=new La(this._polygons.length),s=t.map((n,r)=>new Ua(n,t[(r+1)%t.length],e));e.edges=s,this._polygons.push(e);for(let n of e.edges)this._addEdge(n);return e}addRect(t,e){let s=this._addPoint(t),n=this._addPoint(t.add(e.x,0)),r=this._addPoint(t.add(e)),h=this._addPoint(t.add(0,e.y));return this.addPolygon([s,n,r,h])}_getLocation(t){for(let e of this._polygons)if(e.contains(t))return e;return null}getNeighbours(t){let e=[];for(let s of this._polygons[t].edges){let n=this._findEdge(s.b,s.a);if(n){let r=n.polygon.deref();r&&e.push(r.id)}}return e}getCost(t,e){return 1}getHeuristic(t,e){let s=this._polygons[t],n=this._polygons[e],r=s.centroid.x-n.centroid.x,h=s.centroid.y-n.centroid.y;return Math.sqrt(r*r+h*h)}getPath(t,e){return t===void 0||e===void 0?[]:t===e?[t,e]:yo(this,t,e)}getWaypointPath(t,e,s){let n=s?.type||"centroids",r=this._getLocation(t),h=this._getLocation(e);if(r===void 0||h===void 0)return[];let u=this.getPath(r.id,h.id);if(!u)return[];if(n==="edges"){let p=[];for(let d=1;d<u.length;d++){let c=this._polygons[u[d-1]],P=this._polygons[u[d]],y=this._findCommonEdge(c,P);p.push(y.middle.add(P.centroid.sub(y.middle).unit().scale(4)))}return[t,...p,e]}else return[t,...u.slice(1,-1).map(p=>this._polygons[p].centroid),e]}},Ds=2.5949095,ir=1.70158+1,nr=2*Math.PI/3,rr=2*Math.PI/4.5,Ns={linear:o(t=>t,"linear"),easeInSine:o(t=>1-Math.cos(t*Math.PI/2),"easeInSine"),easeOutSine:o(t=>Math.sin(t*Math.PI/2),"easeOutSine"),easeInOutSine:o(t=>-(Math.cos(Math.PI*t)-1)/2,"easeInOutSine"),easeInQuad:o(t=>t*t,"easeInQuad"),easeOutQuad:o(t=>1-(1-t)*(1-t),"easeOutQuad"),easeInOutQuad:o(t=>t<.5?2*t*t:1-Math.pow(-2*t+2,2)/2,"easeInOutQuad"),easeInCubic:o(t=>t*t*t,"easeInCubic"),easeOutCubic:o(t=>1-Math.pow(1-t,3),"easeOutCubic"),easeInOutCubic:o(t=>t<.5?4*t*t*t:1-Math.pow(-2*t+2,3)/2,"easeInOutCubic"),easeInQuart:o(t=>t*t*t*t,"easeInQuart"),easeOutQuart:o(t=>1-Math.pow(1-t,4),"easeOutQuart"),easeInOutQuart:o(t=>t<.5?8*t*t*t*t:1-Math.pow(-2*t+2,4)/2,"easeInOutQuart"),easeInQuint:o(t=>t*t*t*t*t,"easeInQuint"),easeOutQuint:o(t=>1-Math.pow(1-t,5),"easeOutQuint"),easeInOutQuint:o(t=>t<.5?16*t*t*t*t*t:1-Math.pow(-2*t+2,5)/2,"easeInOutQuint"),easeInExpo:o(t=>t===0?0:Math.pow(2,10*t-10),"easeInExpo"),easeOutExpo:o(t=>t===1?1:1-Math.pow(2,-10*t),"easeOutExpo"),easeInOutExpo:o(t=>t===0?0:t===1?1:t<.5?Math.pow(2,20*t-10)/2:(2-Math.pow(2,-20*t+10))/2,"easeInOutExpo"),easeInCirc:o(t=>1-Math.sqrt(1-Math.pow(t,2)),"easeInCirc"),easeOutCirc:o(t=>Math.sqrt(1-Math.pow(t-1,2)),"easeOutCirc"),easeInOutCirc:o(t=>t<.5?(1-Math.sqrt(1-Math.pow(2*t,2)))/2:(Math.sqrt(1-Math.pow(-2*t+2,2))+1)/2,"easeInOutCirc"),easeInBack:o(t=>ir*t*t*t-1.70158*t*t,"easeInBack"),easeOutBack:o(t=>1+ir*Math.pow(t-1,3)+1.70158*Math.pow(t-1,2),"easeOutBack"),easeInOutBack:o(t=>t<.5?Math.pow(2*t,2)*((Ds+1)*2*t-Ds)/2:(Math.pow(2*t-2,2)*((Ds+1)*(t*2-2)+Ds)+2)/2,"easeInOutBack"),easeInElastic:o(t=>t===0?0:t===1?1:-Math.pow(2,10*t-10)*Math.sin((t*10-10.75)*nr),"easeInElastic"),easeOutElastic:o(t=>t===0?0:t===1?1:Math.pow(2,-10*t)*Math.sin((t*10-.75)*nr)+1,"easeOutElastic"),easeInOutElastic:o(t=>t===0?0:t===1?1:t<.5?-(Math.pow(2,20*t-10)*Math.sin((20*t-11.125)*rr))/2:Math.pow(2,-20*t+10)*Math.sin((20*t-11.125)*rr)/2+1,"easeInOutElastic"),easeInBounce:o(t=>1-Ns.easeOutBounce(1-t),"easeInBounce"),easeOutBounce:o(t=>t<1/2.75?7.5625*t*t:t<2/2.75?7.5625*(t-=1.5/2.75)*t+.75:t<2.5/2.75?7.5625*(t-=2.25/2.75)*t+.9375:7.5625*(t-=2.625/2.75)*t+.984375,"easeOutBounce"),easeInOutBounce:o(t=>t<.5?(1-Ns.easeOutBounce(1-2*t))/2:(1+Ns.easeOutBounce(2*t-1))/2,"easeInOutBounce")},nn=Ns,Na=class{static{o(this,"TexPacker")}textures=[];bigTextures=[];canvas;c2d;x=0;y=0;curHeight=0;gfx;constructor(t,e,s){this.gfx=t,this.canvas=document.createElement("canvas"),this.canvas.width=e,this.canvas.height=s,this.textures=[Et.fromImage(t,this.canvas)],this.bigTextures=[],this.c2d=this.canvas.getContext("2d")}add(t){if(t.width>this.canvas.width||t.height>this.canvas.height){let n=Et.fromImage(this.gfx,t);return this.bigTextures.push(n),[n,new Ie(0,0,1,1)]}this.x+t.width>this.canvas.width&&(this.x=0,this.y+=this.curHeight,this.curHeight=0),this.y+t.height>this.canvas.height&&(this.c2d.clearRect(0,0,this.canvas.width,this.canvas.height),this.textures.push(Et.fromImage(this.gfx,this.canvas)),this.x=0,this.y=0,this.curHeight=0);let e=this.textures[this.textures.length-1],s=new I(this.x,this.y);return this.x+=t.width,t.height>this.curHeight&&(this.curHeight=t.height),t instanceof ImageData?this.c2d.putImageData(t,s.x,s.y):this.c2d.drawImage(t,s.x,s.y),e.update(this.canvas),[e,new Ie(s.x/this.canvas.width,s.y/this.canvas.height,t.width/this.canvas.width,t.height/this.canvas.height)]}free(){for(let t of this.textures)t.free();for(let t of this.bigTextures)t.free()}},Os=class{static{o(this,"FontData")}fontface;filter=Oi;outline=null;size=64;constructor(t,e={}){if(this.fontface=t,this.filter=e.filter??Oi,this.size=e.size??64,this.size>256)throw new Error("Max font size: 256");e.outline&&(this.outline={width:1,color:we(0,0,0)},typeof e.outline=="number"?this.outline.width=e.outline:typeof e.outline=="object"&&(e.outline.width&&(this.outline.width=e.outline.width),e.outline.color&&(this.outline.color=e.outline.color)))}};function Ao(t,e={}){let s=Ce(this),{getRenderProps:n}=s._k;return{id:"circle",radius:t,draw(){s.drawCircle(Object.assign(n(this),{radius:this.radius,fill:e.fill}))},renderArea(){return new Fe(new I(this.anchor?0:-this.radius),this.radius*2,this.radius*2)},inspect(){return`radius: ${Math.ceil(this.radius)}`}}}o(Ao,"circle");function Li(...t){return{id:"color",color:we(...t),inspect(){return`color: ${this.color.toString()}`}}}o(Li,"color");function xo(t){return{add(){this.canvas=t}}}o(xo,"drawon");function vo(t=1){let e=Ce(this),s,n=0,r=!1;return{require:["opacity"],add(){s=this.opacity,this.opacity=0},update(){r||(n+=e.dt(),this.opacity=e.map(n,0,t,0,s),n>=t&&(this.opacity=s,r=!0))}}}o(vo,"fadeIn");function bo(t="intersect"){return{id:"mask",mask:t}}o(bo,"mask");function Wi(t){let e=Ce(this),{toFixed:s}=e._k;return{id:"opacity",opacity:t??1,fadeIn(n=1,r=e.easings.linear){return e.tween(0,this.opacity,n,h=>this.opacity=h,r)},fadeOut(n=1,r=e.easings.linear){return e.tween(this.opacity,0,n,h=>this.opacity=h,r)},inspect(){return`opacity: ${s(this.opacity,1)}`}}}o(Wi,"opacity");function Vo(t=1,e=we(0,0,0),s=1,n="miter",r=10,h="butt"){return{id:"outline",outline:{width:t,color:e,opacity:s,join:n,miterLimit:r,cap:h},inspect(){return`outline: ${this.outline.width}px, ${this.outline.color}`}}}o(Vo,"outline");var qa=class{static{o(this,"Particle")}pos;vel;acc;angle;angularVelocity;damping;t;lt;gc;constructor(){this.t=0,this.gc=!0}get progress(){return this.lt?this.t/this.lt:this.t}};function Eo(t,e){let s=Ce(this),n=e.lifetime,r=[],h=t.colors||[s.WHITE],u=t.opacities||[1],p=t.quads||[new Ie(0,0,1,1)],d=t.scales||[1],c=t.lifeTime,P=e.direction,y=e.spread,C=t.speed||[0,0],x=t.angle||[0,0],W=t.angularVelocity||[0,0],Y=t.acceleration||[E(0),E(0)],Q=t.damping||[0,0],j=[],Z=new Array(t.max),M=0,ne=0;for(let N=0;N<t.max;N++){j[N*6+0]=N*4+0,j[N*6+1]=N*4+1,j[N*6+2]=N*4+3,j[N*6+3]=N*4+1,j[N*6+4]=N*4+2,j[N*6+5]=N*4+3;for(let G=0;G<4;G++)Z[N*4+G]={pos:new I(0,0),uv:new I(0,0),color:s.rgb(255,255,255),opacity:1};r[N]=new qa}let K=new Xe;function re(N=0){for(;N<t.max;){if(r[N].gc)return N;N++}return null}return o(re,"nextFree"),{id:"particles",emit(N){let G=0;for(let he=0;he<N;he++){if(G=re(G),G==null)return;let ge=s.rand(P-y,P+y),ae=I.fromAngle(ge).scale(s.rand(C[0],C[1])),ye=s.rand(x[0],x[1]),ce=s.rand(W[0],W[1]),De=E(s.rand(Y[0].x,Y[1].x),s.rand(Y[0].y,Y[1].y)),ue=s.rand(Q[0],Q[1]),Oe=c?s.rand(c[0],c[1]):null,le=e.shape?e.shape.random():E(),fe=r[G];fe.lt=Oe,fe.pos=le,fe.vel=ae,fe.acc=De,fe.angle=ye,fe.angularVelocity=ce,fe.damping=ue,fe.angularVelocity=ce,fe.gc=!1}M+=N},update(){if(e.lifetime<=0)return;let N=s.dt();for(let G of r)if(!G.gc){if(G.t+=N,G.lt&&G.t>=G.lt){G.gc=!0,M--;continue}G.vel=G.vel.add(G.acc.scale(N)).scale(1-G.damping*N),G.pos=G.pos.add(G.vel.scale(N)),G.angle+=G.angularVelocity*N}for(n!==void 0&&(n-=N,n<=0&&K.trigger()),ne+=N;M<t.max&&e.rate&&ne>e.rate;)this.emit(1),M++,ne-=e.rate},draw(){if(!(n<=0)){for(let N=0;N<r.length;N++){let G=r[N];if(G.gc)continue;let he=G.progress,ge=Math.floor(G.progress*h.length),ae=ge<h.length-1?nt(h[ge],h[ge+1],ut(he,ge/h.length,(ge+1)/h.length,0,1)):h[ge],ye=Math.floor(G.progress*u.length),ce=ye<u.length-1?nt(u[ye],u[ye+1],ut(he,ye/u.length,(ye+1)/u.length,0,1)):u[ye],De=Math.floor(G.progress*p.length),ue=p[De],Oe=Math.floor(G.progress*d.length),le=d[Oe],fe=Math.cos(G.angle*Math.PI/180),Ae=Math.sin(G.angle*Math.PI/180),ve=(t.texture?t.texture.width:10)*ue.w/2,be=(t.texture?t.texture.height:10)*ue.h/2,qe=N*4,J=Z[qe];J.pos.x=G.pos.x+-ve*le*fe- -be*le*Ae,J.pos.y=G.pos.y+-ve*le*Ae+-be*le*fe,J.uv.x=ue.x,J.uv.y=ue.y,J.color.r=ae.r,J.color.g=ae.g,J.color.b=ae.b,J.opacity=ce,J=Z[qe+1],J.pos.x=G.pos.x+ve*le*fe- -be*le*Ae,J.pos.y=G.pos.y+ve*le*Ae+-be*le*fe,J.uv.x=ue.x+ue.w,J.uv.y=ue.y,J.color.r=ae.r,J.color.g=ae.g,J.color.b=ae.b,J.opacity=ce,J=Z[qe+2],J.pos.x=G.pos.x+ve*le*fe-be*le*Ae,J.pos.y=G.pos.y+ve*le*Ae+be*le*fe,J.uv.x=ue.x+ue.w,J.uv.y=ue.y+ue.h,J.color.r=ae.r,J.color.g=ae.g,J.color.b=ae.b,J.opacity=ce,J=Z[qe+3],J.pos.x=G.pos.x+-ve*le*fe-be*le*Ae,J.pos.y=G.pos.y+-ve*le*Ae+be*le*fe,J.uv.x=ue.x,J.uv.y=ue.y+ue.h,J.color.r=ae.r,J.color.g=ae.g,J.color.b=ae.b,J.opacity=ce}s._k.drawRaw(Z,j,this.fixed,t.texture,this.shader,this.uniform)}},onEnd(N){return K.add(N)},inspect(){return`count: ${M}/${t.max}`}}}o(Eo,"particles");function So(t,e={}){let s=Ce(this),{getRenderProps:n}=s._k;if(t.length<3)throw new Error(`Polygon's need more than two points, ${t.length} points provided`);return{id:"polygon",pts:t,colors:e.colors,uv:e.uv,tex:e.tex,radius:e.radius,draw(){s.drawPolygon(Object.assign(n(this),{pts:this.pts,colors:this.colors,uv:this.uv,tex:this.tex,radius:this.radius,fill:e.fill,triangulate:e.triangulate}))},renderArea(){return new et(this.pts)},inspect(){return`polygon: ${this.pts.map(r=>`[${r.x},${r.y}]`).join(",")}`}}}o(So,"polygon");function rn(t,e,s){let n=Ce(this),r;return n.get("area").forEach(h=>{if(s&&s.some(p=>h.is(p)))return;let u=h.worldArea().raycast(t,e);u&&(r?u.fraction<r.fraction&&(r=u,r.object=h):(r=u,r.object=h))}),r}o(rn,"raycast");function Ni(t,e,s={}){let n=Ce(this),{getRenderProps:r}=n._k;return{id:"rect",width:t,height:e,radius:s.radius||0,draw(){n.drawRect(Object.assign(r(this),{width:this.width,height:this.height,radius:this.radius,fill:s.fill}))},renderArea(){return new Fe(E(0),this.width,this.height)},inspect(){return`rect: (${Math.ceil(this.width)}w, ${Math.ceil(this.height)}h)`}}}o(Ni,"rect");function Mo(t,e){return{id:"shader",shader:t,...typeof e=="function"?{uniform:e(),update(){this.uniform=e()}}:{uniform:e},inspect(){return`shader: ${t}`}}}o(Mo,"shader");function qs(t,e={}){let s=Ce(this),{drawTexture:n,getRenderProps:r,resolveSprite:h}=s._k,u=null,p=null,d=null,c=new Xe;if(!t)throw new Error("Please pass the resource name or data to sprite()");let P=o((y,C,x,W)=>{let Y=E(1,1);return x&&W?(Y.x=x/(y.width*C.w),Y.y=W/(y.height*C.h)):x?(Y.x=x/(y.width*C.w),Y.y=Y.x):W&&(Y.y=W/(y.height*C.h),Y.x=Y.y),Y},"calcTexScale");return{id:"sprite",width:0,height:0,frame:e.frame||0,quad:e.quad||new Ie(0,0,1,1),animSpeed:e.animSpeed??1,flipX:e.flipX??!1,flipY:e.flipY??!1,get sprite(){return t.toString()},draw(){if(!u)return;let y=u.frames[this.frame??0];if(!y)throw new Error(`Frame not found: ${this.frame??0}`);if(u.slice9){let{left:C,right:x,top:W,bottom:Y}=u.slice9,Q=u.tex.width*y.w,j=u.tex.height*y.h,Z=this.width-C-x,M=this.height-W-Y,ne=C/Q,K=x/Q,re=1-ne-K,N=W/j,G=Y/j,he=1-N-G,ge=[Pe(0,0,ne,N),Pe(ne,0,re,N),Pe(ne+re,0,K,N),Pe(0,N,ne,he),Pe(ne,N,re,he),Pe(ne+re,N,K,he),Pe(0,N+he,ne,G),Pe(ne,N+he,re,G),Pe(ne+re,N+he,K,G),Pe(0,0,C,W),Pe(C,0,Z,W),Pe(C+Z,0,x,W),Pe(0,W,C,M),Pe(C,W,Z,M),Pe(C+Z,W,x,M),Pe(0,W+M,C,Y),Pe(C,W+M,Z,Y),Pe(C+Z,W+M,x,Y)];for(let ae=0;ae<9;ae++){let ye=ge[ae],ce=ge[ae+9];n(Object.assign(r(this),{pos:ce.pos(),tex:u.tex,quad:y.scale(ye),flipX:this.flipX,flipY:this.flipY,tiled:e.tiled,width:ce.w,height:ce.h}))}}else n(Object.assign(r(this),{tex:u.tex,quad:y.scale(this.quad??new Ie(0,0,1,1)),flipX:this.flipX,flipY:this.flipY,tiled:e.tiled,width:this.width,height:this.height}))},add(){let y=o(x=>{let W=x.frames[0].clone();e.quad&&(W=W.scale(e.quad));let Y=P(x.tex,W,e.width,e.height);this.width=x.tex.width*W.w*Y.x,this.height=x.tex.height*W.h*Y.y,e.anim&&this.play(e.anim),u=x,c.trigger(u)},"setSpriteData"),C=h(t);C?C.onLoad(y):s.onLoad(()=>y(h(t).data))},update(){if(!p)return;let y=u.anims[p.name];if(typeof y=="number"){this.frame=y;return}if(y.speed===0)throw new Error("Sprite anim speed cannot be 0");p.timer+=s.dt()*this.animSpeed,p.timer>=1/p.speed&&(p.timer=0,this.frame+=d,(this.frame<Math.min(y.from,y.to)||this.frame>Math.max(y.from,y.to))&&(p.loop?p.pingpong?(this.frame-=d,d*=-1,this.frame+=d):this.frame=y.from:p.pingpong?d===Math.sign(y.to-y.from)?(this.frame=y.to,d*=-1,this.frame+=d):(this.frame=y.from,p.onEnd(),this.stop()):(this.frame=y.to,p.onEnd(),this.stop())))},play(y,C={}){if(!u){c.add(()=>this.play(y,C));return}let x=u.anims[y];if(x===void 0)throw new Error(`Anim not found: ${y}`);p&&this.stop(),p=typeof x=="number"?{name:y,timer:0,loop:!1,pingpong:!1,speed:0,onEnd:o(()=>{},"onEnd")}:{name:y,timer:0,loop:C.loop??x.loop??!1,pingpong:C.pingpong??x.pingpong??!1,speed:C.speed??x.speed??10,onEnd:C.onEnd??(()=>{})},d=typeof x=="number"?null:x.from<x.to?1:-1,this.frame=typeof x=="number"?x:x.from,this.trigger("animStart",y)},stop(){if(!p)return;let y=p.name;p=null,this.trigger("animEnd",y)},numFrames(){return u?.frames.length??0},getCurAnim(){return p},curAnim(){return p?.name},onAnimEnd(y){return this.on("animEnd",y)},onAnimStart(y){return this.on("animStart",y)},renderArea(){return new s.Rect(E(0),this.width,this.height)},inspect(){if(typeof t=="string")return`sprite: "${t}"`}}}o(qs,"sprite");function Ro(t,e={}){let s=Ce(this),{getRenderProps:n}=s._k;function r(u){let p=s.formatText(Object.assign(n(u),{text:u.text+"",size:u.textSize,font:u.font,width:e.width&&u.width,align:u.align,letterSpacing:u.letterSpacing,lineSpacing:u.lineSpacing,transform:u.textTransform,styles:u.textStyles}));return e.width||(u.width=p.width/(u.scale?.x||1)),u.height=p.height/(u.scale?.y||1),p}o(r,"update");let h={id:"text",set text(u){t=u,r(this)},get text(){return t},textSize:e.size??36,font:e.font,width:e.width??0,height:0,align:e.align,lineSpacing:e.lineSpacing,letterSpacing:e.letterSpacing,textTransform:e.transform,textStyles:e.styles,add(){s.onLoad(()=>r(this))},draw(){s.drawFormattedText(r(this))},renderArea(){return new Fe(E(0),this.width,this.height)}};return r(h),h}o(Ro,"text");function Po(t,e){let s=Ce(this),{getRenderProps:n}=s._k;return{id:"rect",width:t,height:e,draw(){s.drawUVQuad(Object.assign(n(this),{width:this.width,height:this.height}))},renderArea(){return new Fe(E(0),this.width,this.height)},inspect(){return`uvquad: (${Math.ceil(this.width)}w, ${Math.ceil(this.height)})h`}}}o(Po,"uvquad");function ko(t={}){let e=null,s=null,n=null,r=null;return{id:"agent",require:["pos","tile"],agentSpeed:t.speed??100,allowDiagonals:t.allowDiagonals??!0,getDistanceToTarget(){return e?this.pos.dist(e):0},getNextLocation(){return s&&n?s[n]:null},getPath(){return s?s.slice():null},getTarget(){return e},isNavigationFinished(){return s?n===null:!0},isTargetReachable(){return s!==null},isTargetReached(){return e?this.pos.eq(e):!0},setTarget(h){e=h,s=this.getLevel().getPath(this.pos,e,{allowDiagonals:this.allowDiagonals}),n=s?0:null,s?(r||(r=this.getLevel().onNavigationMapChanged(()=>{s&&n!==null&&(s=this.getLevel().getPath(this.pos,e,{allowDiagonals:this.allowDiagonals}),n=s?0:null,s?this.trigger("navigation-next",this,s[n]):this.trigger("navigation-ended",this))}),this.onDestroy(()=>r.cancel())),this.trigger("navigation-started",this),this.trigger("navigation-next",this,s[n])):this.trigger("navigation-ended",this)},update(){if(s&&n!==null){if(this.pos.sdist(s[n])<2)if(n===s.length-1){this.pos=e.clone(),n=null,this.trigger("navigation-ended",this),this.trigger("target-reached",this);return}else n++,this.trigger("navigation-next",this,s[n]);this.moveTo(s[n],this.agentSpeed)}},onNavigationStarted(h){return this.on("navigation-started",h)},onNavigationNext(h){return this.on("navigation-next",h)},onNavigationEnded(h){return this.on("navigation-ended",h)},onTargetReached(h){return this.on("target-reached",h)},inspect(){return"agent: "+JSON.stringify({target:JSON.stringify(e),path:JSON.stringify(s)})}}}o(ko,"agent");function Co(t){let e=t.graph;return{id:"navigator",require:["pos"],navigateTo(s){return this.graph?.getWaypointPath(this.pos,s,t.navigationOpt)},get graph(){if(e)return e;let s=this.parent;for(;s;){if(s.is("navigatormap"))return s.graph;s=s.parent}return null},set graph(s){e=s}}}o(Co,"navigation");function To(t={}){let e=t.waypoints,s=t.speed||100,n=t.endBehavior||"stop",r=0,h=e!=null;return{id:"patrol",require:["pos"],get patrolSpeed(){return s},set patrolSpeed(u){s=u},get waypoints(){return e},set waypoints(u){e=u,r=0,h=!1},get nextLocation(){return e?e[r]:null},update(){let u=this.nextLocation;if(!(!e||!u||h)&&(this.moveTo(u,s),this.pos.sdist(u)<9))switch(n){case"loop":r=(r+1)%e.length;break;case"ping-pong":r=r+1,r==e.length&&(e.reverse(),r=0);break;case"stop":r=Math.min(r+1,e.length-1),r==e.length-1&&(h=!0,this.trigger("patrol-finished"));break}},onPatrolFinished(u){return this.on("patrol-finished",u)}}}o(To,"patrol");function Io(t,e={}){let s=Ce(this),n=typeof t=="function"?t:()=>s.query(t),r=e.checkFrequency||1,h=typeof e.direction=="number"?I.fromAngle(e.direction):e.direction,u=0;return{id:"sentry",require:["pos"],direction:typeof e.direction=="number"?I.fromAngle(e.direction):e.direction,spotted:[],set directionAngle(p){this.direction=p!==void 0?I.fromAngle(p):void 0},get directionAngle(){return this.direction?this.direction.angle():void 0},fieldOfView:e.fieldOfView||200,isWithinFieldOfView(p,d,c){let P=(typeof d=="number"?I.fromAngle(d):d)||h,y=c||e.fieldOfView;if(!P||!y||y>=360)return!0;let C=y/2;return p.pos&&P.angleBetween(p.pos.sub(this.pos))<=C},hasLineOfSight(p){let d=rn(this.pos,p.pos.sub(this.pos),e.raycastExclude);return d&&d.object===p},update(){if(u+=s.dt(),u>r){u-=r;let p=n();if(p.length&&h&&this.fieldOfView&&this.fieldOfView<360){let d=this.fieldOfView/2;p=p.filter(c=>c.pos&&h.angleBetween(c.pos.sub(this.pos))<=d)}p.length&&e.lineOfSight&&(p=p.filter(d=>d.pos&&this.hasLineOfSight(d))),p.length>0&&(this.spotted=p,this.trigger("object-spotted",p))}},onObjectsSpotted(p){return this.on("object-spotted",p)}}}o(Io,"sentry");function qi(t={}){let e=E(0),s=t.isObstacle??!1,n=t.cost??0,r=t.edges??[],h=o(()=>{let p={left:1,top:2,right:4,bottom:8};return r.map(d=>p[d]||0).reduce((d,c)=>d|c,0)},"getEdgeMask"),u=h();return{id:"tile",tilePosOffset:t.offset??E(0),set tilePos(p){let d=this.getLevel();e=p.clone(),this.pos=E(this.tilePos.x*d.tileWidth(),this.tilePos.y*d.tileHeight()).add(this.tilePosOffset)},get tilePos(){return e},set isObstacle(p){s!==p&&(s=p,this.getLevel().invalidateNavigationMap())},get isObstacle(){return s},set cost(p){n!==p&&(n=p,this.getLevel().invalidateNavigationMap())},get cost(){return n},set edges(p){r=p,u=h(),this.getLevel().invalidateNavigationMap()},get edges(){return r},get edgeMask(){return u},getLevel(){return this.parent},moveLeft(){this.tilePos=this.tilePos.add(E(-1,0))},moveRight(){this.tilePos=this.tilePos.add(E(1,0))},moveUp(){this.tilePos=this.tilePos.add(E(0,-1))},moveDown(){this.tilePos=this.tilePos.add(E(0,1))}}}o(qi,"tile");function Bo(t,e){if(t==null)throw new Error("health() requires the initial amount of hp");return{id:"health",hurt(s=1){this.setHP(t-s),this.trigger("hurt",s)},heal(s=1){let n=t;this.setHP(t+s),this.trigger("heal",t-n)},hp(){return t},maxHP(){return e??null},setMaxHP(s){e=s},setHP(s){t=e?Math.min(e,s):s,t<=0&&this.trigger("death")},onHurt(s){return this.on("hurt",s)},onHeal(s){return this.on("heal",s)},onDeath(s){return this.on("death",s)},inspect(){return`health: ${t}`}}}o(Bo,"health");function Fo(t,e={}){let s=Ce(this);if(t==null)throw new Error("lifespan() requires time");let n=e.fade??0;return{id:"lifespan",require:["opacity"],async add(){await s.wait(t),this.opacity=this.opacity??1,n>0&&await s.tween(this.opacity,0,n,r=>this.opacity=r,nn.linear),this.destroy()}}}o(Fo,"lifespan");function Do(t){return{name:t}}o(Do,"named");function Oo(t,e,s){if(!t)throw new Error("state() requires an initial state");let n={};function r(d){n[d]||(n[d]={enter:new Xe,end:new Xe,update:new Xe,draw:new Xe})}o(r,"initStateEvents");function h(d,c,P){return r(c),n[c][d].add(P)}o(h,"on");function u(d,c,...P){r(c),n[c][d].trigger(...P)}o(u,"trigger");let p=!1;return{id:"state",state:t,enterState(d,...c){if(p=!0,e&&!e.includes(d))throw new Error(`State not found: ${d}`);let P=this.state;if(s){if(!s?.[P])return;let y=typeof s[P]=="string"?[s[P]]:s[P];if(!y.includes(d))throw new Error(`Cannot transition state from "${P}" to "${d}". Available transitions: ${y.map(C=>`"${C}"`).join(", ")}`)}u("end",P,...c),this.state=d,u("enter",d,...c),u("enter",`${P} -> ${d}`,...c)},onStateTransition(d,c,P){return h("enter",`${d} -> ${c}`,P)},onStateEnter(d,c){return h("enter",d,c)},onStateUpdate(d,c){return h("update",d,c)},onStateDraw(d,c){return h("draw",d,c)},onStateEnd(d,c){return h("end",d,c)},update(){p||(u("enter",t),p=!0),u("update",this.state)},draw(){u("draw",this.state)},inspect(){return`state: ${this.state}`}}}o(Oo,"state");function ji(t){return{id:"stay",stay:!0,scenesToStay:t}}o(ji,"stay");function js(){return{id:"timer",wait(t,e){let s=Ce(this),n=[];e&&n.push(e);let r=0,h=this.onUpdate(()=>{r+=s.dt(),r>=t&&(n.forEach(u=>u()),h.cancel())});return{get paused(){return h.paused},set paused(u){h.paused=u},cancel:h.cancel,onEnd(u){n.push(u)},then(u){return this.onEnd(u),this}}},loop(t,e){let s=null,n=o(()=>{s=this.wait(t,n),e()},"newAction");return s=this.wait(0,n),{get paused(){return s.paused},set paused(r){s.paused=r},cancel:o(()=>s.cancel(),"cancel")}},tween(t,e,s,n,r=nn.linear){let h=Ce(this),u=0,p=[],d=this.onUpdate(()=>{u+=h.dt();let c=Math.min(u/s,1);n(nt(t,e,r(c))),c===1&&(d.cancel(),n(e),p.forEach(P=>P()))});return{get paused(){return d.paused},set paused(c){d.paused=c},onEnd(c){p.push(c)},then(c){return this.onEnd(c),this},cancel(){d.cancel()},finish(){d.cancel(),n(e),p.forEach(c=>c())}}}}}o(js,"timer");function Uo(t={}){let e=Ce(this),{app:s,isFixed:n,getViewportScale:r,game:h}=e._k,u={},p=new Set;return{id:"area",collisionIgnore:t.collisionIgnore??[],add(){this.area.cursor&&this.onHover(()=>s.setCursor(this.area.cursor)),this.onCollideUpdate((d,c)=>{u[d.id]||this.trigger("collide",d,c),u[d.id]=c,p.add(d.id)})},update(){for(let d in u)p.has(Number(d))||(this.trigger("collideEnd",u[d].target),delete u[d]);p.clear()},drawInspect(){let d=this.localArea();e.pushTransform(),e.pushScale(this.area.scale),e.pushTranslate(this.area.offset);let c={outline:{width:4/r(),color:we(0,0,255)},anchor:this.anchor,fill:!1,fixed:n(this)};d instanceof e.Rect?e.drawRect({...c,pos:d.pos,width:d.width,height:d.height}):d instanceof e.Polygon?e.drawPolygon({...c,pts:d.pts}):d instanceof e.Circle&&e.drawCircle({...c,pos:d.center,radius:d.radius}),e.popTransform()},area:{shape:t.shape??null,scale:t.scale?E(t.scale):E(1),offset:t.offset??E(0),cursor:t.cursor??null},isClicked(){return s.isMousePressed()&&this.isHovering()},isHovering(){let d=n(this)?e.mousePos():e.toWorld(e.mousePos());return this.hasPoint(d)},checkCollision(d){return u[d.id]??null},getCollisions(){return Object.values(u)},isColliding(d){return!!u[d.id]},isOverlapping(d){let c=u[d.id];return c&&c.hasOverlap()},onClick(d,c="left"){let P=s.onMousePress(c,()=>{this.isHovering()&&d()});return this.onDestroy(()=>P.cancel()),P},onHover(d){let c=!1;return this.onUpdate(()=>{c?c=this.isHovering():this.isHovering()&&(c=!0,d())})},onHoverUpdate(d){return this.onUpdate(()=>{this.isHovering()&&d()})},onHoverEnd(d){let c=!1;return this.onUpdate(()=>{c?this.isHovering()||(c=!1,d()):c=this.isHovering()})},onCollide(d,c){if(typeof d=="function"&&c===void 0)return this.on("collide",d);if(typeof d=="string")return this.onCollide((P,y)=>{P.is(d)&&c(P,y)})},onCollideUpdate(d,c){if(typeof d=="function"&&c===void 0)return this.on("collideUpdate",d);if(typeof d=="string")return this.on("collideUpdate",(P,y)=>P.is(d)&&c(P,y))},onCollideEnd(d,c){if(typeof d=="function"&&c===void 0)return this.on("collideEnd",d);if(typeof d=="string")return this.on("collideEnd",P=>P.is(d)&&c(P))},hasPoint(d){return yt(this.worldArea(),d)},resolveCollision(d){let c=this.checkCollision(d);c&&!c.resolved&&(this.pos=this.pos.add(c.displacement),c.resolved=!0)},localArea(){return this.area.shape?this.area.shape:this.renderArea()},worldArea(){let d=this.localArea();if(!(d instanceof e.Polygon||d instanceof e.Rect))throw new Error("Only support polygon and rect shapes for now");let c=this.transform.clone().scale(E(this.area.scale??1)).translate(this.area.offset);if(d instanceof e.Rect){let P=It(this.anchor||Ws).add(1,1).scale(-.5).scale(d.width,d.height);c.translate(P)}return d.transform(c)},screenArea(){let d=this.worldArea();return n(this)?d:d.transform(h.cam.transform)},inspect(){return this.area.scale.x==this.area.scale.y?`area: ${this.area.scale.x.toFixed(1)}x`:`area: (${this.area.scale.x.toFixed(1)}x, ${this.area.scale.y.toFixed(1)}y)`}}}o(Uo,"area");function Lo(t={}){let e=Ce(this),{calcTransform:s,game:n}=e._k,r=null,h=null,u=!1;return{id:"body",require:["pos"],vel:E(0),drag:t.drag??0,jumpForce:t.jumpForce??Da,gravityScale:t.gravityScale??1,isStatic:t.isStatic??!1,mass:t.mass??1,add(){if(this.mass===0)throw new Error("Can't set body mass to 0");this.is("area")&&(this.onCollideUpdate((p,d)=>{if(!p.is("body")||d.resolved)return;this.trigger("beforePhysicsResolve",d);let c=d.reverse();if(p.trigger("beforePhysicsResolve",c),!(d.resolved||c.resolved)&&!(this.isStatic&&p.isStatic)){if(!this.isStatic&&!p.isStatic){let P=this.mass+p.mass;this.pos=this.pos.add(d.displacement.scale(p.mass/P)),p.pos=p.pos.add(d.displacement.scale(-this.mass/P)),this.transform=s(this),p.transform=s(p)}else{let P=!this.isStatic&&p.isStatic?d:d.reverse();P.source.pos=P.source.pos.add(P.displacement),P.source.transform=s(P.source)}d.resolved=!0,this.trigger("physicsResolve",d),p.trigger("physicsResolve",d.reverse())}}),this.onPhysicsResolve(p=>{n.gravity&&(p.isBottom()&&this.isFalling()?(this.vel=this.vel.reject(n.gravity.unit()),r=p.target,h=p.target.pos,u?u=!1:this.trigger("ground",r)):p.isTop()&&this.isJumping()&&(this.vel=this.vel.reject(n.gravity.unit()),this.trigger("headbutt",p.target)))}))},update(){if(n.gravity&&!this.isStatic){u&&(r=null,h=null,this.trigger("fallOff"),u=!1);let p=!0;if(r&&(!this.isColliding(r)||!r.exists()||!r.is("body")?u=!0:(!r.pos.eq(h)&&t.stickToPlatform!==!1&&this.moveBy(r.pos.sub(h)),h=r.pos,p=!1)),p){let d=this.vel.clone();this.vel=this.vel.add(n.gravity.scale(this.gravityScale*e.dt()));let c=t.maxVelocity??Oa;this.vel.slen()>c*c&&(this.vel=this.vel.unit().scale(c)),d.dot(n.gravity)<0&&this.vel.dot(n.gravity)>=0&&this.trigger("fall")}}this.vel.x*=1-this.drag,this.vel.y*=1-this.drag,this.move(this.vel)},onPhysicsResolve(p){return this.on("physicsResolve",p)},onBeforePhysicsResolve(p){return this.on("beforePhysicsResolve",p)},curPlatform(){return r},isGrounded(){return r!==null},isFalling(){return this.vel.dot(e.getGravityDirection())>0},isJumping(){return this.vel.dot(e.getGravityDirection())<0},jump(p){r=null,h=null,this.vel=e.getGravityDirection().scale(-p||-this.jumpForce)},onGround(p){return this.on("ground",p)},onFall(p){return this.on("fall",p)},onFallOff(p){return this.on("fallOff",p)},onHeadbutt(p){return this.on("headbutt",p)},inspect(){return`gravityScale: ${this.gravityScale}x`}}}o(Lo,"body");function Wo(t=2){let e=t;return{id:"doubleJump",require:["body"],numJumps:t,add(){this.onGround(()=>{e=this.numJumps})},doubleJump(s){e<=0||(e<this.numJumps&&this.trigger("doubleJump"),e--,this.jump(s))},onDoubleJump(s){return this.on("doubleJump",s)},inspect(){return`jumpsLeft: ${e}`}}}o(Wo,"doubleJump");function Gs(t){if(!t)throw new Error("Please define an anchor");return{id:"anchor",anchor:t,inspect(){return typeof this.anchor=="string"?"anchor: "+this.anchor:"anchor: "+this.anchor.toString()}}}o(Gs,"anchor");function Gi(){return{id:"fixed",fixed:!0}}o(Gi,"fixed");function No(t,e){return{id:"follow",require:["pos"],follow:{obj:t,offset:e??E(0)},add(){t.exists()&&(this.pos=this.follow.obj.pos.add(this.follow.offset))},update(){t.exists()&&(this.pos=this.follow.obj.pos.add(this.follow.offset))}}}o(No,"follow");function qo(t){let e=Ce(this),{game:s}=e._k,n=s.layers.indexOf(t);return{id:"layer",get layerIndex(){return n},get layer(){return s.layers[n]},set layer(r){if(n=s.layers.indexOf(r),n==-1)throw Error("Invalid layer name")},inspect(){return`layer: ${this.layer}`}}}o(qo,"layer");function jo(t,e){let s=typeof t=="number"?I.fromAngle(t):t.unit();return{id:"move",require:["pos"],update(){this.move(s.scale(e))}}}o(jo,"move");function Go(t={}){let e=Ce(this),s=t.distance??Fa,n=!1;return{id:"offscreen",require:["pos"],isOffScreen(){let r=this.screenPos(),h=new Fe(E(0),e.width(),e.height());return!e.testRectPoint(h,r)&&h.sdistToPoint(r)>s*s},onExitScreen(r){return this.on("exitView",r)},onEnterScreen(r){return this.on("enterView",r)},update(){this.isOffScreen()?(n||(this.trigger("exitView"),n=!0),t.hide&&(this.hidden=!0),t.pause&&(this.paused=!0),t.destroy&&this.destroy()):(n&&(this.trigger("enterView"),n=!1),t.hide&&(this.hidden=!1),t.pause&&(this.paused=!1))}}}o(Go,"offscreen");function ws(t){return t.fixed?!0:t.parent?ws(t.parent):!1}o(ws,"isFixed");function ms(...t){let e=Ce(this),{getViewportScale:s}=e._k;return{id:"pos",pos:E(...t),moveBy(...n){this.pos=this.pos.add(E(...n))},move(...n){this.moveBy(E(...n).scale(e.dt()))},moveTo(...n){if(typeof n[0]=="number"&&typeof n[1]=="number")return this.moveTo(E(n[0],n[1]),n[2]);let r=n[0],h=n[1];if(h===void 0){this.pos=E(r);return}let u=r.sub(this.pos);if(u.len()<=h*e.dt()){this.pos=E(r);return}this.move(u.unit().scale(h))},worldPos(n=null){if(n)this.pos=this.pos.add(this.fromWorld(n));else return this.parent?this.parent.transform.multVec2(this.pos):this.pos},toWorld(n){return this.parent?this.parent.transform.multVec2(this.pos.add(n)):this.pos.add(n)},fromWorld(n){return this.parent?this.parent.transform.invert().multVec2(n).sub(this.pos):n.sub(this.pos)},screenPos(n=null){if(n)this.pos=this.pos.add(this.fromScreen(n));else{let r=this.worldPos();return ws(this)?r:e.toScreen(r)}},toScreen(n){let r=this.toWorld(n);return ws(this)?r:e.toScreen(r)},fromScreen(n){return ws(this)?this.fromWorld(n):this.fromWorld(e.toWorld(n))},toOther(n,r){return n.fromWorld(this.toWorld(r))},fromOther(n,r){return n.toOther(this,r)},inspect(){return`pos: (${Math.round(this.pos.x)}x, ${Math.round(this.pos.y)}y)`},drawInspect(){e.drawCircle({color:e.rgb(255,0,0),radius:4/s()})}}}o(ms,"pos");function Ho(t){return{id:"rotate",angle:t??0,rotateBy(e){this.angle+=e},rotateTo(e){this.angle=e},inspect(){return`angle: ${Math.round(this.angle)}`}}}o(Ho,"rotate");function ys(...t){let e=Ce(this),{toFixed:s}=e._k;return t.length===0?ys(1):{id:"scale",scale:E(...t),scaleTo(...n){this.scale=E(...n)},scaleBy(...n){this.scale.scale(E(...n))},inspect(){return this.scale.x==this.scale.y?`scale: ${this.scale.x.toFixed(1)}x`:`scale: (${this.scale.x.toFixed(1)}x, ${this.scale.y.toFixed(1)}y)`}}}o(ys,"scale");function Yo(t){return{id:"z",z:t,inspect(){return`z: ${this.z}`}}}o(Yo,"z");var ja="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAD0AAAA1CAYAAADyMeOEAAAAAXNSR0IArs4c6QAAAoVJREFUaIHdm7txwkAQhheGAqACiCHzOKQDQrqgILpwSAeEDBnEUAF0gCMxZ7G72qce/mec2Lpf9+3unaS78wgSNZ8uX5729+d1FNWXUuGmXlBOUUEIMckEpeQJgBu6C+BSFngztBR2vd+ovY+7g+p6LbgaWgJrAeUkDYIUXgXdBBwNi6kpABJwMTQH3AZsXRR8GHTfgEth8E3gjdAUcNewpbTgY85sCMCUuOokozE0YM0YRzM9NGAAXd8+omAF5h4lnmBRvpSnZHyLoLEbaN+aKB9KWv/KWw0tAbbANnlG+UvB2dm77NxxdwgBpjrF/d7rW9cbmpvio2A5z8iAYpVU8pGZlo6/2+MSco2lHfd3rv9jAP038e1xef9o2mjvYb2OqpqKE81028/jeietlSEVO5FRWsxWsJit1G3aFpW8iWe5RwpiCZAk25QvV6nz6fIlynRGuTd5WqpJ4guAlDfVKBK87hXljflgv1ON6fV+4+5gVlA17SfeG0heKqQd4l4jI/wrmaA9N9R4ar+wpHJDZyrrfcH0nB66PqAzPi76pn+faSyJk/vzOorYhGurQrzj/P68jtBMawHaHBIR9xoD5O34dy0qQOSYHvqExq2TpT2nf76+w7y251OYF0CRaU+J920TwLUa6inx6OxE6g80lu2ux7Y2eJLF/rCXE6zEPdnenk9o+4ih9AEdnW2q81HXl5LuU6OTl2fXUhqganbXAGq3g6jJOWV/OnoesO6YqqEB/GdNsjf7uHtwj2DzmRNpp7iOZfm6D9oAxB6Yi1gC4oIYeo4MIPdopEQRB+cAko5J1tW386HpB2Kz1eop4Epdwls/kgZ1sh8gZsEjdcWkr//D8Qu3Z3l5Nl1NtAAAAABJRU5ErkJggg==",Ga="data:image/png;base64,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",Ha=da("SUQzBAAAAAAAI1RTU0UAAAAPAAADTGF2ZjU4Ljc2LjEwMAAAAAAAAAAAAAAA//tQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAASW5mbwAAAA8AAAASAAAeMwAUFBQUFCIiIiIiIjAwMDAwPj4+Pj4+TExMTExZWVlZWVlnZ2dnZ3V1dXV1dYODg4ODkZGRkZGRn5+fn5+frKysrKy6urq6urrIyMjIyNbW1tbW1uTk5OTk8vLy8vLy//////8AAAAATGF2YzU4LjEzAAAAAAAAAAAAAAAAJAQKAAAAAAAAHjOZTf9/AAAAAAAAAAAAAAAAAAAAAP/7kGQAAANUMEoFPeACNQV40KEYABEY41g5vAAA9RjpZxRwAImU+W8eshaFpAQgALAAYALATx/nYDYCMJ0HITQYYA7AH4c7MoGsnCMU5pnW+OQnBcDrQ9Xx7w37/D+PimYavV8elKUpT5fqx5VjV6vZ38eJR48eRKa9KUp7v396UgPHkQwMAAAAAA//8MAOp39CECAAhlIEEIIECBAgTT1oj///tEQYT0wgEIYxgDC09aIiE7u7u7uIiIz+LtoIQGE/+XAGYLjpTAIOGYYy0ZACgDgSNFxC7YYiINocwERjAEDhIy0mRoGwAE7lOTBsGhj1qrXNCU9GrgwSPr80jj0dIpT9DRUNHKJbRxiWSiifVHuD2b0EbjLkOUzSXztP3uE1JpHzV6NPq+f3P5T0/f/lNH7lWTavQ5Xz1yLVe653///qf93B7f/vMdaKJAAJAMAIwIMAHMpzDkoYwD8CR717zVb8/p54P3MikXGCEWhQOEAOAdP6v8b8oNL/EzdnROC8Zo+z+71O8VVAGIKFEglKbidkoLam0mAFiwo0ZoVExf/7kmQLgAQyZFxvPWAENcVKXeK0ABAk2WFMaSNIzBMptBYfArbkZgpWjEQpcmjxQoG2qREWQcvpzuuIm29THt3ElhDNlrXV///XTGbm7Kbx0ymcRX///x7GVvquf5vk/dPs0Wi5Td1vggDxqbNII4bAPTU3Ix5h9FJTe7zv1LHG/uPsPrvth0ejchVzVT3giirs6sQAACgQAAIAdaXbRAYra/2t0//3HwqLKIlBOJhOg4BzAOkt+MOL6H8nlNvKyi3rOnqP//zf6AATwBAKIcHKixxwjl1TjDVIrvTqdmKQOFQBUBDwZ1EhHlDEGEVyGQWBAHrcJgRSXYbkvHK/8/6rbYjs4Qj0C8mRy2hwRv/82opGT55fROgRoBTjanaiQiMRHUu1/P3V9yGFffaVv78U1/6l/kpo0cz73vuSv/9GeaqDVRA5bWdHRKQKIEAAAAoIktKeEmdQFKN5sguv/ZSC0oxCAR7CzcJgEsd8cA0M/x0tzv15E7//5L5KCqoIAAmBFIKM1UxYtMMFjLKESTE8lhaelUyCBYeA2IN4rK1iDt//+5JkEgAkZzlVq29D8DJDWo0YLLARwPFZrL0PyLsUazTAlpI+hKSx01VSOfbjXg0iW9/jVPDleLJ15QQA4Okdc5ByMDFIeuCCE5CvevwBGH8YibiX9FtaIIgUikF42wrZw6ZJ6WlHrA+Ki5++NNMeYH1lEkwwJAIJB4ugVFguXFc20Vd/FLlvq1GSiSwAFABABABA47k6BFeNvxEQZO9v3L1IE4iEVElfrXmEmlyWIyGslFA55gH/sW7////o9AAFIBIIAAIUMzYTTNkgsAmYObfwQyzplrOmYvq0BKCKNN+nUTbvD7cJzvHxrEWG5QqvP8U1vFx6CwE8NoRc2ADBeEb/HoXh60N7ST8nw9QiiGoYvf/r6GtC9+vLwXHjaSkIp3iupC5+Nii81Zhu85pNYbFvrf+UFThDOYYY26off+W6b//73GTiN9xDfl0AAwBAiMBO8qsDBPOZtuT/dTbjVVbY/KSGH6ppHwKv/6X+s8gUCN/lODzv////GQAGAMQAADlXAUCBJiY0wFQZusYQOaQzaTwDBTcx0IvVp8m7uxKp//uSZBMCBHRI1eNPLHAyxNqWGeoYUIEnWYyxD8DUFSn0l6iojcd+oEOkzV6uWqyHNzjqmv+7V5xGUfY9yEmbziTzjRscm9OqFQp1PKFrqu3PX/7YuGtDU6bt0OUTpv38rdc+37dVDQLKUchaJ853E9edNDGqWwsYz1VoiSStEJtZvw6+sNqFWqaIXJjQCGAAGWAYVwmag/x3BRJw1wYF7IzVqDcNzn85d//FzK7IgwbQwccLoB4AsF8Nj/1ESRUAAVJwAFh0YOFEhmSJEHKQRDyhszgLUpHIgFrb5cySFg5jv10ImlYuvaaGBItfXqnNPmic+XNkmb5fW49vdhq97nQMQyGIlM2v8oQSrxKSxE4F1WqrduqvuJCRof1R7Gsre9KszUVF1/t3PzH2tnp+iSUG3rDwGNcDzxCGA8atuQF0paZAAkAhAQAEAC240yJV+nJgUrqq8axAYtVpYjZyFGb13/17jwiClQDaCdytZpyHHf1R/EG/+lUAgAAAChhmJvioVGGBCFgqdpsGAkUUrbTstwTCJgLQpFIsELW7t/68Iv/7kmQUgAQ9NFO9aeAAPAU6RKwUABClY2e5hoARGpDvPydCAsY8WO10fSvUOnfT98+n/l/6/+hxslhQ1DEOaevNKGocvIYba8WJpaP/15pX0NQ1DUNn/////k6lPp/N61rBi8RJFfERV3IgrqDsJA64sjCoKxDDQ9xEcWDpMBDwVFDIAEIAAzryxsjGi4q/oWpixKjhklAF4pUrDPjFhFVupDFZ/t/t0YPAygUBhADPR/KLCKJ8h2Oxhpxz/zNRAAFl0MAZLAYEAiVbEiz36LSgZ5QoQVat69KNy8FyM5Z80ACHAzgnISEkxUSJIDyBSwi5KF4mjBl4xJdbrG9ComLrL8YATiodhQKCkj6ROdyg1y5XmZlvMVmpJzYppJDwLi/Lp9vT3TfmimOGpuezi2U/9FNav0zX9Oja2r//8+hvuihuQAAMAVmqFgAgCcuboAEAAAUcqy8ca0BHBmwbFkED0CNA1YYDPkhcQrRJxcY3BzfxxltAz9vX62Xl3plAzWmRO+FkZyH///1qAAEjQBAACUpgU5o2AIBmFBGMamrGg0b/+5JkC4ADxyLWb2ngAEEkGofsoACP7U1JLaxTkOqFaKhspGgnW3SGC56ZgUJGCRnLOmIJAkuNBgvwU4Ocf8CJK9UsafH9/Frj///365XSoME+DZMw5UNjrMbVoeIj9EL91IuQ5KHyl5V2LCpdIdESgafOHxVGkAlkHuakmix/gN8+BP/sKguLAAoAtUjtvaoeEADwr3OK11E4KBlojgeQNQBJ4MvCAd/4t/xMMzeLhQGQ1//6tQu5BaBOGCT6U4aafvXZ//4iAPAAAAbLkgIlQmMSLA2H1CVNAlWwyVvKIQIxOSK1NWxs4MBUATlKrAkIMPAjCAdS6MVFzuURWa/+/qQWEGsA6EEpiBEJb9Q21lAHoBoD0B6aAPhyt+bG3muoXIN3RLadXxUfr/ohjGFF/p97eqNI5noKAqYLNPpUTDSI9/TmA6B+YAAADgA0Y4lxTW1SQfOQuDDDI0KTTuIrF5qoJrUFhUFAsg+AT2hbkaRZYGIjBKVDIa5VgNN/9P/rCDsBJbYJRKpCA1ArAkigIeYY61AjE+jubyiZFZ3+L789//uSZBCABHVj2entNmw1JXokLycYEFTFVa0wz4DYjKs08J2Q+r4n3lgbWaaMwMLEjFW88F39brqPF83cv1mCSJeY3Q2uiQxhBJxCBeR1D2LQRsYQcZUTzdNll8+OwZBsIwSgl45ymaHX603Mz7JmZuvt71GDTN66zev/+cLn/b5imV8pAHkg61FIJchBSG+zycgAZgADD6F1iQQRXRWmWS6bDIIgyBCZEcdl/KgXGmVKFv/vl8ry/5bLypf//U5jhYDhL9X/pAA0AKBIAAKgGtGXGGWJgEoF2JNsHlKfSKLRhGBAgIuWZKIJCFpF1VBhkB+EfzEyMUJdWuMrEZoPZ5BfF3/Nu62riIdjoO4AAKD2sTrDmpZZaYysf/810TitAVvn9xtFucieiaEy54YqiIO6RqkGAm5wVO0bFB0sDTdNxYGekKktR4KAAfAwUIgI8Ci6aXgtwbhPWAC+CKExAFydNtYGXNZoQjUsXv/9vKjgmdwieb+h7kHvPoc//0FaCACAATKFC4Y9ammklidbaiJNPBhGWTNhFSgdtalK12lpl//7kmQRAFN2NFI7TBvwNKNaTRsFGBWdfV2tPNcYvBHpgPKJsc8IUcTCxY3HSvUVNTWe/Z3YWlrJ0yrNRUiT19aprA7E+mPP+ZmC3/CsheOJXhc/9VJb3UZnphUBcqZUZQth1i3XqtPYu2Sy1s8DV9ZYACAAASAAHgFkQcOqgB5utFHFh3kSi4USs0yk4iOClREmjvdG+upaiLcRA6/9QGbOfxF/8sEAQAVG0G07YFMihKR4EXJCkRdX9isueLqUMRAQdhDZmv3KeR0nPqRVrZmSIXDt+BBSR7qqbKQcB98W9qiMb55preHIStxFWPE4lAyI+BKz2iSxonpvMR5DgKxTH6vGGXAbYCaAnJUW4W07EesQqbfqdbo4qNnPxSpn1H8eahszc/y9//dn1V7D/OYpn1szQKAPXTMlO/rO//u7JriJXbld7aP33v6RXYg/COIDzTWkTspg6Ay1YaDSwKxrP/LfIikHjmO871POf/kEAseAgoPEi9/0ZziNwfxVKy9qAEGEEAAq1EcOamDEGHAA0iao8k31rz2MiLNEik6VQ37/+5JkEAgEYU5WU0M3MDjDe0o9IjiOzSVM7aCzEM2GqXD8pFB0zxMcHCQNHtZD+R+pMWZxOJ/otEZTvVN/MeU12xTVcL+f2YaiNJTVoPd6SvzEnKel5GXOzEaazgdChnP2jOAwpfyRpVlQwoJBwpN1L1DL////6TVWcoepf7CVWrpEWiym5lR5U0BSMlxQC4qByOyQIAEuJfIriWixDqRgMfVZWuvRowjR9BzP5lZlT/+YG50CsSBG////////liXDQVMxEaBkbzKAAACnDIAstY7iK7gGSF7SIDexaTtPOHABk9YcmJEACmo50pgWal22etroBpYoVqtU6OPqvlf0c4QCAfLk9P/FJs4KCQMf6ECZyA6BwqqyJ0rMYj56k1/UlTIx1V3Rt5NF71D4qlptDC8VMgQVHFDlQnDFi06qQgKQAAIK4TxxJGFGYJuZNGXRdpq7IW/DYpPIQRFJLAc+qn1E0XYdOkQVJT+z8Lvff//8vbKAWTIBBUUdM6cOhlDry7x4dAkJXIBhbO3HSMMMGBQ9K9/JNfu09PjTO64wYEcR//uSZBeABP5g11NPRVwzQ4r8PMJVj7j9UU2wUwDPjeq0Z5w675D9+uDdL2QsuIry2lZtwn/pJYyRRjANEOQxNWw8mU7Tq+vueV7JrX/Pg7VIkEuZT5dwd85MVoq5lpStNICkBAcFR88//58KO8Zjt2PIGxWl1cVfXeNGH18SReNT//hYliWtQuNluxyxONbm4U+lpkAgpyE7yAIYUjIaqHmARJ0GQTtmH60xdwFp/u253XBCxD0f/lBcguCALn//Y5nqEv//1h4BAAwgAA5gcHmpIplgeW9fAOM6RFZUywrsGAiRmKkanQnCFBjYoPDS7bjwtPTkVI8D/P8VVLcTUz65n7PW2s3tNYHgEul4tBaIz0A9RgJAyAMI4/i0fpQKjhX9S+qIa0vmc4CZit/0/3UTDGeKNpkk0nu2rUE2ag8WErhE/kgAiQCJKQEYBA5Wn6CxHoIUh6dQ46nLIuwFk4S/LaDQxXu7Yf/pf//lwJB0S/Ff/4C///EiBEiAAAIAMnpngiIABAdMpKigkXaUwhLEGvpiofmXW57h2XAZO3CMRv/7kmQUAEOHQlHraRTQMkQp6GWFZBTVU1lNPTPYyIyocYeUoNgLBWAs1jPkTv/tXBaeZ/tbD/nAGP8/xT0SNEi5zof0KIVEzVe9r5lZOol7kyaXMYS4J/ZS3djp//UaeVyR0mUMlTgfz8XqMzIEgAQQ6UNQ1DSE0/C16OvyaocF4ijAGFci0FSYqCUSaWs6t9F6/699DKvMgMoK1//kSbvxtyBN27I7mdXgNMAW75sRU1UwUHYG5axI2tFIFpkgx7nnK+1JmRKjqeAd5Ph0QAL4QAnirmiPlg0yBDlrb/d3ngtA65rb999+8vdDCfnJuJAYIl285zklpVbrKpk1PEzrOY9NZUgyz6OiOsKt5qG/g2ibxSZ+/eTI/NB8n4ev//n2nIw85GAdwuJL7kYnnAbpcf1RBKH6b2U4RWP8dmWH5snsAFYwADBgAopKdzFJq4Jlmotloh/m4QpTSvJRE3nYZHephoqBhVf+P7vQ9BPlwZCP+3//+hdy5uUwS3LDEgQx4cdIgvDEBR1YqymCsSbKzRy2aQmSv+AAcAgAkvzPfuX/+5JkFQAj6VFX00Zr5DllOhhgpn4MmSs+zSRRiO8U5tWklYgSLKfs+Xheb/+6WaAQCKTztNeJ382MUltZNnjSJoFrCqB6C4mFcwJpJD4Oc8dLDXMTh9k1/rmTopfzqv9AvHWfOuZJlEvHSVMjyjpkVucKSzxJVQBgAAIo8DGqRdYCXPckFYg+dH9A/qUyljrtpxH9RJX/Z3Vv6uFkPg4M2jf3CL09QrwOrMt69n//8UFEAAMHWdhg1CcjyVBwiArOYlDL5NPY6x8ZLFBCGi6SVTKX5nqdSEFjebnv2zHdt0dj6xvORsSFzwqRNTJSZIrrlpXcURNL9WW7krBgr5jPMaGcvJ5v0N1s19CV7+7fvQfjySX2QECWUgKgeJCIif4WRBZ/6archpDkzE7oWctK3zEHP9Smeai8oeHkM6AK7pGjtOgeFv40ugqNd+Iv///uAZAMgAAAUeSWhLPpdwk3iXpBw43hOVIp1gliUOSaeZcZeZhLAH9TtD56wUpBduzLF5v5qViTH6o+I0+8Z1asaLgKVAohlpB72DgAQBQxEd3g//uSZCiAA6k0UdMPQfA+xcnBYON8E3WDVU0w1ZjPDSmo8IniHAFDNnkXF3B94gicH5d8MFw+IHZwufxOf/8gsHw+XrD4Jn8T4RAyQiABNBQg/3giEWuZ42mVFB3kkXNjhqBg1CghEUbN3/7/KBhyqNueef/MIDBClP3YRnKLiIlEFzf//0g+4zKpRIKTpqQgUtnHGFw6RSLN421iGcYapqFxny/capK9r9v+2BSy/RU1yZxa2eGaWK07ijfcxeiO3iuHJvjbXzts+Ny+XyFnsne1h0qG4mAaN6xRGaLVxKPlrri0Bg9oXGyxcw8JRBPkUzC8v451vVd9liSX85JMrmkVNwxOCwUg298////7ks//L409/hwMRIozKiIckXtjzDaAMTBcAACAwLGargPSEgEJZN/EFjfF/VKgaMYKMbwtf/T0UCGGfjfOAZ2frCigYdwh/+sGlQBxhCAAAUHkDPqOdmmUdAVYl3IhrEfR8qZFjLYEPOyzVGvm6lNUJCk2PNazwFxaijk+ZEaiTehoJGuDh6zN/EVP8BCLD/88BoY7Xv/7kmQlgBNmMtNTL0FwOGZJ/WHiKAyhJU+soE3A3JnmAa2oaCIru/+RrEHMTphxQ0X/LzoVy4gKhYl6ZUlklW7CLRVoYmgABwCRMAAMA/poCiEEYLsBVodWcVZ18+CcAfH165U4Xgh7/X1/BAQF6GN/BwQ/+D9S9P6wII//CoANYFYCBAKlGQDKhVjjylKARw2mPAtp8JjcQHggQswVsOEKsF6AIBWvmpIFdSZvRVv/LHWEy0+txMxu+VK9gEqG5pWf6GNGU4UBVkfd+bsj/6lZE0fkOpAqAOvyUO9oo+IiEtcLKOGzhhSGa4MYINHWoQsFr8zzmow0tRILkqz5/+vFxl/oZX/+qGW//xiLjR3xcGn//0QLkTQJh1UA8MAQAEXC/YxODKTDUEhrASs1512GRp+dRFFdTWIRaOXrve1eNjTNpreqQYrC9NBlQc1f8YO2po8bnH6qffuRvU7taiNF3baokE0YpmjRCHRclWBb9NCHKHpERwHRG3pqgXklq4sBpLjGvmekg8Y7SjM1FZopIM8IhB6dtMr8aKsdovh4FW//+5JkQ4CjTDdSU0gtIDiE+YBrKgwNbSVJTCBPwN8N5ZW8NKDnhRB8AXCm//KAsBUCwKU//oJQnET+UP3/zpYRocAAABJkVzzIuoLGEaDoxfsNva12EUdxhJMGFQioSg8GxKsLm8kWEmExJuNidarkk+OTXc0i2OZEq2v+tZr/MDZRS0I7LfRpHdlsiF6m/mEjk+XlK10UqtKYUwNgMx24hUtCJLfpM3ExUeKDYjClgZAzAjQ0qlNQBTsGpk9zSRkCiKkRGp572VXsPYChGvxhAuYkDYZK//jSRgto2mTf6+PJqgAAgIAAAACYZE6aZOHhYkYlcbpeYQq1RgLO4U8TIlL1sGw+iKZi5Kzc/bKT0yXrIUMES89RCWy8oWlxqIQlKANLFpT/KjUrK+UCYbZqGnjVj29aO5dzofWAskRX5eJWPi4kf/aRVjy3Wlyg2AnMYIDSTLwZUTASIzflPWUwwlUnIFMnGiyABeaXJcN91PmQJCLzmvUJkFOHCrX/+6O///IHnT4tT9YYBoNMQ09GfKIErwdwChNz1Qy5+5S/wWeY//uSZF+C03UyT2tMO0A3RRkhY20KzQjDMszhA8DjlGOBp5y4ZCS3ica52GIGiryv7FAaSDVZSXKFTiir+GvGiuK4rjgwPVTddso+W/42a4ueJJHDYtfj6YoKknnjzRgKA0fBIRZOSsprJqnoNN73ps/Z9DVgbKNbMGmRzrYBMAZCPUANkAZQ0syAC2ubK1NF90+WoesBpnhY8qwVDkNb/5Uof6//418TgElCSgAIgyAAQBHEmiaQFPIRmfAMELffpo0IflyEuAAQnSnKvwTlVlnIgOAAGS3P3IydjXPSh/CaVRqpSNCjQqDvPM+fLcuN+WgqNix6CoHomUWTT86JjziRSZ3yjnq+dIldKPU11KUuf6wAASMAAJxE+MlyktgE9UGSxjEx6RR0v1s9bWZ+EJSrGtjqUIhklG3J8eLRn/2U/nv7f///+7/6gBQgEAMUijVMwweWWMyYM/PLXuc7DptIQmBARMRCxXjEIcTNDQgSSeHpUNXO7dRSOllJPvnY7yzaO1hmUjsKvHe99fOxrabMX7mGTi5tsNkZVZLndzxse//7kmR7ABM2O0pbKTvQN4NI+WGFPA2ZESs1pYAAvA0jVrJwAHfbr/c6//vW790dzX36QNBRlDv/6QQAU3V64yUgBEAYc/lI8e5bm+Z9+j+4aaj4tFrb//iker/4a12b/V//q//9v+7vAEAAAAMqZTGd5gL4f54o6ZebKNrR/zWVYUEVYVVv8BuAV2OUT+DUQgkJ8J1Ey4ZbFCiAwgwzMSdHV4jQR+OoPWEASaPkyYq+PsQFFJCsEEJtOiUjI/+GRhtC2DnizTMXATJig9Ey/kAJMrkHGYJ8gpLjmJOYoskpav+ShRJInyGGZVJMihDi6pIxRZJJel/8iZPkYiREnyKE0akTL5QNSqT5iiySS9Ja2SV//5ME0ak//+4KgAAABgQBAADAMDgYCAEgCteQ0fZH6+ICXA357+MPfhR/+ywRf/U///LVTEFNRTMuMTAwVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVX/+5JknQAFoWhGLm5gBClBmT3GiAAAAAGkHAAAIAAANIOAAARVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVV"),Ya="data:image/png;base64,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",Ka="3001.0.0";function It(t){switch(t){case"topleft":return new I(-1,-1);case"top":return new I(0,-1);case"topright":return new I(1,-1);case"left":return new I(-1,0);case"center":return new I(0,0);case"right":return new I(1,0);case"botleft":return new I(-1,1);case"bot":return new I(0,1);case"botright":return new I(1,1);default:return t}}o(It,"anchorPt");function Ko(t){switch(t){case"left":return 0;case"center":return .5;case"right":return 1;default:return 0}}o(Ko,"alignPt");function Qo(t){return t.createBuffer(1,1,44100)}o(Qo,"createEmptyAudioBuffer");var it,Qa=o(t=>t&&t.loadAseprite,"isKaboomCtx"),Ce=o(t=>{if(!it)throw new Error("You are trying to access to Kaboom Context before their initialization.");return Qa(t)?t:it},"getKaboomContext"),za=o((t={})=>{let e=t.root??document.body;e===document.body&&(document.body.style.width="100%",document.body.style.height="100%",document.body.style.margin="0px",document.documentElement.style.width="100%",document.documentElement.style.height="100%");let s=t.canvas??e.appendChild(document.createElement("canvas")),n=t.scale??1,r=t.width&&t.height&&!t.stretch&&!t.letterbox;r?(s.width=t.width*n,s.height=t.height*n):(s.width=s.parentElement.offsetWidth,s.height=s.parentElement.offsetHeight);let h=["outline: none","cursor: default"];if(r){let i=s.width,a=s.height;h.push(`width: ${i}px`),h.push(`height: ${a}px`)}else h.push("width: 100%"),h.push("height: 100%");t.crisp&&(h.push("image-rendering: pixelated"),h.push("image-rendering: crisp-edges")),s.style.cssText=h.join(";");let u=t.pixelDensity||window.devicePixelRatio;s.width*=u,s.height*=u,s.tabIndex=0;let p=document.createElement("canvas");p.width=256,p.height=256;let d=p.getContext("2d",{willReadFrequently:!0}),c=Va({canvas:s,touchToMouse:t.touchToMouse,gamepads:t.gamepads,pixelDensity:t.pixelDensity,maxFPS:t.maxFPS,buttons:t.buttons}),P=[],y=c.canvas.getContext("webgl",{antialias:!0,depth:!0,stencil:!0,alpha:!0,preserveDrawingBuffer:!0}),C=uo(y,{texFilter:t.texFilter}),x=(()=>{let i=Rt(Ei,Si),a=Et.fromImage(C,new ImageData(new Uint8ClampedArray([255,255,255,255]),1,1)),l=t.width&&t.height?new Bs(C,t.width*u*n,t.height*u*n):new Bs(C,y.drawingBufferWidth,y.drawingBufferHeight),f=null,m=1;t.background&&(f=we(t.background),m=Array.isArray(t.background)?t.background[3]:1,y.clearColor(f.r/255,f.g/255,f.b/255,m??1)),y.enable(y.BLEND),y.blendFuncSeparate(y.SRC_ALPHA,y.ONE_MINUS_SRC_ALPHA,y.ONE,y.ONE_MINUS_SRC_ALPHA);let v=new Sa(C,Ui,Pa,ka),A=Et.fromImage(C,new ImageData(new Uint8ClampedArray([128,128,128,255,190,190,190,255,190,190,190,255,128,128,128,255]),2,2),{wrap:"repeat",filter:"nearest"});return{lastDrawCalls:0,defShader:i,defTex:a,frameBuffer:l,postShader:null,postShaderUniform:null,renderer:v,transform:new lt,transformStack:[],bgTex:A,bgColor:f,bgAlpha:m,width:t.width??y.drawingBufferWidth/u/n,height:t.height??y.drawingBufferHeight/u/n,viewport:{x:0,y:0,width:y.drawingBufferWidth,height:y.drawingBufferHeight},fixed:!1}})();class W{static{o(this,"SpriteData")}tex;frames=[new Ie(0,0,1,1)];anims={};slice9=null;constructor(a,l,f={},m=null){this.tex=a,l&&(this.frames=l),this.anims=f,this.slice9=m}get width(){return this.tex.width*this.frames[0].w}get height(){return this.tex.height*this.frames[0].h}static from(a,l={}){return typeof a=="string"?W.fromURL(a,l):Promise.resolve(W.fromImage(a,l))}static fromImage(a,l={}){let[f,m]=j.packer.add(a),v=l.frames?l.frames.map(A=>new Ie(m.x+A.x*m.w,m.y+A.y*m.h,A.w*m.w,A.h*m.h)):ge(l.sliceX||1,l.sliceY||1,m.x,m.y,m.w,m.h);return new W(f,v,l.anims,l.slice9)}static fromURL(a,l={}){return gs(a).then(f=>W.fromImage(f,l))}}class Y{static{o(this,"SoundData")}buf;constructor(a){this.buf=a}static fromArrayBuffer(a){return new Promise((l,f)=>Q.ctx.decodeAudioData(a,l,f)).then(l=>new Y(l))}static fromURL(a){return $n(a)?Y.fromArrayBuffer(Xr(a)):fo(a).then(l=>Y.fromArrayBuffer(l))}}let Q=(()=>{let i=new(window.AudioContext||window.webkitAudioContext),a=i.createGain();a.connect(i.destination);let l=new Y(Qo(i));return i.decodeAudioData(Ha.buffer.slice(0)).then(f=>{l.buf=f}).catch(f=>{console.error("Failed to load burp: ",f)}),{ctx:i,masterNode:a,burpSnd:l}})(),j={urlPrefix:"",sprites:new qt,fonts:new qt,bitmapFonts:new qt,sounds:new qt,shaders:new qt,custom:new qt,music:{},packer:new Na(C,2048,2048),loaded:!1};function Z(i){return typeof i!="string"||$n(i)?i:j.urlPrefix+i}o(Z,"fixURL");let M={events:new ds,objEvents:new ds,root:Cs([]),gravity:null,scenes:{},currentScene:null,layers:null,defaultLayerIndex:0,logs:[],cam:{pos:null,scale:new I(1),angle:0,shake:0,transform:new lt}};M.root.use(js());function ne(i){return j.custom.add(null,i)}o(ne,"load");function K(){let i=[j.sprites,j.sounds,j.shaders,j.fonts,j.bitmapFonts,j.custom];return i.reduce((a,l)=>a+l.progress(),0)/i.length}o(K,"loadProgress");function re(i){return i!==void 0&&(j.urlPrefix=i),j.urlPrefix}o(re,"loadRoot");function N(i,a){return j.custom.add(i,fs(a))}o(N,"loadJSON");function G(i,a,l={}){let f=new FontFace(i,typeof a=="string"?`url(${a})`:a);return document.fonts.add(f),j.fonts.add(i,f.load().catch(m=>{throw new Error(`Failed to load font from "${a}": ${m}`)}).then(m=>new Os(m,l)))}o(G,"loadFont");function he(i,a,l,f,m={}){return j.bitmapFonts.add(i,gs(a).then(v=>$t(Et.fromImage(C,v,m),l,f,m.chars??tr)))}o(he,"loadBitmapFont");function ge(i=1,a=1,l=0,f=0,m=1,v=1){let A=[],L=m/i,R=v/a;for(let w=0;w<a;w++)for(let V=0;V<i;V++)A.push(new Ie(l+V*L,f+w*R,L,R));return A}o(ge,"slice");function ae(i,a){return i=Z(i),ne(typeof a=="string"?new Promise((l,f)=>{fs(a).then(m=>{ae(i,m).then(l).catch(f)})}):W.from(i).then(l=>{let f={};for(let m in a){let v=a[m],A=l.frames[0],L=2048*A.w,R=2048*A.h,w=v.frames?v.frames.map(U=>new Ie(A.x+(v.x+U.x)/L*A.w,A.y+(v.y+U.y)/R*A.h,U.w/L*A.w,U.h/R*A.h)):ge(v.sliceX||1,v.sliceY||1,A.x+v.x/L*A.w,A.y+v.y/R*A.h,v.width/L*A.w,v.height/R*A.h),V=new W(l.tex,w,v.anims);j.sprites.addLoaded(m,V),f[m]=V}return f}))}o(ae,"loadSpriteAtlas");function ye(i,a={}){let l=document.createElement("canvas"),f=i[0].width,m=i[0].height;l.width=f*i.length,l.height=m;let v=l.getContext("2d");i.forEach((L,R)=>{L instanceof ImageData?v.putImageData(L,R*f,0):v.drawImage(L,R*f,0)});let A=v.getImageData(0,0,i.length*f,m);return W.fromImage(A,{...a,sliceX:i.length,sliceY:1})}o(ye,"createSpriteSheet");function ce(i,a,l={sliceX:1,sliceY:1,anims:{}}){return a=Z(a),Array.isArray(a)?a.some(f=>typeof f=="string")?j.sprites.add(i,Promise.all(a.map(f=>typeof f=="string"?gs(f):Promise.resolve(f))).then(f=>ye(f,l))):j.sprites.addLoaded(i,ye(a,l)):typeof a=="string"?j.sprites.add(i,W.from(a,l)):j.sprites.addLoaded(i,W.fromImage(a,l))}o(ce,"loadSprite");function De(i,a){return a=Z(a),j.sprites.add(i,new Promise(async l=>{let f=typeof a=="string"?await fs(a):a,m=await Promise.all(f.frames.map(gs)),v=document.createElement("canvas");v.width=f.width,v.height=f.height*f.frames.length;let A=v.getContext("2d");m.forEach((R,w)=>{A.drawImage(R,0,w*f.height)});let L=await ce(null,v,{sliceY:f.frames.length,anims:f.anims});l(L)}))}o(De,"loadPedit");function ue(i,a,l){a=Z(a),l=Z(l),typeof a=="string"&&!l&&(l=wa(a)+".json");let f=typeof l=="string"?fs(l):Promise.resolve(l);return j.sprites.add(i,f.then(m=>{let v=m.meta.size,A=m.frames.map(R=>new Ie(R.frame.x/v.w,R.frame.y/v.h,R.frame.w/v.w,R.frame.h/v.h)),L={};for(let R of m.meta.frameTags)R.from===R.to?L[R.name]=R.from:L[R.name]={from:R.from,to:R.to,speed:10,loop:!0,pingpong:R.direction==="pingpong"};return W.from(a,{frames:A,anims:L})}))}o(ue,"loadAseprite");function Oe(i,a,l){return j.shaders.addLoaded(i,Rt(a,l))}o(Oe,"loadShader");function le(i,a,l){a=Z(a),l=Z(l);let f=o(v=>v?po(v):Promise.resolve(null),"resolveUrl"),m=Promise.all([f(a),f(l)]).then(([v,A])=>Rt(v,A));return j.shaders.add(i,m)}o(le,"loadShaderURL");function fe(i,a){return a=Z(a),j.sounds.add(i,typeof a=="string"?Y.fromURL(a):Y.fromArrayBuffer(a))}o(fe,"loadSound");function Ae(i,a){let l=new Audio(a);return l.preload="auto",j.music[i]=Z(a)}o(Ae,"loadMusic");function ve(i="bean"){return ce(i,ja)}o(ve,"loadBean");function be(i){return j.sprites.get(i)}o(be,"getSprite");function qe(i){return j.sounds.get(i)}o(qe,"getSound");function J(i){return j.fonts.get(i)}o(J,"getFont");function xt(i){return j.bitmapFonts.get(i)}o(xt,"getBitmapFont");function zt(i){return j.shaders.get(i)}o(zt,"getShader");function Es(i){return j.custom.get(i)}o(Es,"getAsset");function Xt(i){if(typeof i=="string"){let a=be(i);if(a)return a;if(K()<1)return null;throw new Error(`Sprite not found: ${i}`)}else{if(i instanceof W)return _e.loaded(i);if(i instanceof _e)return i;throw new Error(`Invalid sprite: ${i}`)}}o(Xt,"resolveSprite");function Ss(i){if(typeof i=="string"){let a=qe(i);if(a)return a;if(K()<1)return null;throw new Error(`Sound not found: ${i}`)}else{if(i instanceof Y)return _e.loaded(i);if(i instanceof _e)return i;throw new Error(`Invalid sound: ${i}`)}}o(Ss,"resolveSound");function Ms(i){if(!i)return x.defShader;if(typeof i=="string"){let a=zt(i);if(a)return a.data??a;if(K()<1)return null;throw new Error(`Shader not found: ${i}`)}else if(i instanceof _e)return i.data?i.data:i;return i}o(Ms,"resolveShader");function Jt(i){if(!i)return Jt(t.font??Ma);if(typeof i=="string"){let a=xt(i),l=J(i);if(a)return a.data??a;if(l)return l.data??l;if(document.fonts.check(`64px ${i}`))return i;if(K()<1)return null;throw new Error(`Font not found: ${i}`)}else if(i instanceof _e)return i.data?i.data:i;return i}o(Jt,"resolveFont");function Rs(i){return i!==void 0&&(Q.masterNode.gain.value=i),Q.masterNode.gain.value}o(Rs,"volume");function _t(i,a={}){let l=new Xe,f=new Audio(i);Q.ctx.createMediaElementSource(f).connect(Q.masterNode);function m(){Ee.paused||c.isHidden()&&!t.backgroundAudio||Q.ctx.resume()}o(m,"resumeAudioCtx");function v(){m(),f.play()}return o(v,"play"),a.paused||v(),f.onended=()=>l.trigger(),{play(){v()},seek(A){f.currentTime=A},stop(){f.pause(),this.seek(0)},set loop(A){f.loop=A},get loop(){return f.loop},set paused(A){A?f.pause():v()},get paused(){return f.paused},time(){return f.currentTime},duration(){return f.duration},set volume(A){f.volume=ht(A,0,1)},get volume(){return f.volume},set speed(A){f.playbackRate=Math.max(A,0)},get speed(){return f.playbackRate},set detune(A){},get detune(){return 0},onEnd(A){return l.add(A)},then(A){return this.onEnd(A)}}}o(_t,"playMusic");function Bt(i,a={}){if(typeof i=="string"&&j.music[i])return _t(j.music[i],a);let l=Q.ctx,f=a.paused??!1,m=l.createBufferSource(),v=new Xe,A=l.createGain(),L=a.seek??0,R=0,w=0,V=!1;m.loop=!!a.loop,m.detune.value=a.detune??0,m.playbackRate.value=a.speed??1,m.connect(A),m.onended=()=>{D()>=(m.buffer?.duration??Number.POSITIVE_INFINITY)&&v.trigger()},A.connect(Q.masterNode),A.gain.value=a.volume??1;let U=o(F=>{m.buffer=F.buf,f||(R=l.currentTime,m.start(0,L),V=!0)},"start"),k=Ss(i);k instanceof _e&&k.onLoad(U);let D=o(()=>{if(!m.buffer)return 0;let F=f?w-R:l.currentTime-R,O=m.buffer.duration;return m.loop?F%O:Math.min(F,O)},"getTime"),S=o(F=>{let O=l.createBufferSource();return O.buffer=F.buffer,O.loop=F.loop,O.playbackRate.value=F.playbackRate.value,O.detune.value=F.detune.value,O.onended=F.onended,O.connect(A),O},"cloneNode");return{stop(){this.paused=!0,this.seek(0)},set paused(F){if(f!==F)if(f=F,F)V&&(m.stop(),V=!1),w=l.currentTime;else{m=S(m);let O=w-R;m.start(0,O),V=!0,R=l.currentTime-O,w=0}},get paused(){return f},play(F=0){this.seek(F),this.paused=!1},seek(F){m.buffer?.duration&&(F>m.buffer.duration||(f?(m=S(m),R=w-F):(m.stop(),m=S(m),R=l.currentTime-F,m.start(0,F),V=!0,w=0)))},set speed(F){m.playbackRate.value=F},get speed(){return m.playbackRate.value},set detune(F){m.detune.value=F},get detune(){return m.detune.value},set volume(F){A.gain.value=Math.max(F,0)},get volume(){return A.gain.value},set loop(F){m.loop=F},get loop(){return m.loop},duration(){return m.buffer?.duration??0},time(){return D()%this.duration()},onEnd(F){return v.add(F)},then(F){return this.onEnd(F)}}}o(Bt,"play");function Ft(i){return Bt(Q.burpSnd,i)}o(Ft,"burp");function Zt(i,a){let l=new Bs(C,i,a);return{clear:o(()=>l.clear(),"clear"),free:o(()=>l.free(),"free"),toDataURL:o(()=>l.toDataURL(),"toDataURL"),toImageData:o(()=>l.toImageData(),"toImageData"),width:l.width,height:l.height,draw:o(f=>{Le(),l.bind(),f(),Le(),l.unbind()},"draw")}}o(Zt,"makeCanvas");function Rt(i=Ei,a=Si){let l=Ca.replace("{{user}}",i??Ei),f=Ta.replace("{{user}}",a??Si);try{return new Ea(C,l,f,Ui.map(m=>m.name))}catch(m){let v=/(?<type>^\w+) SHADER ERROR: 0:(?<line>\d+): (?<msg>.+)/,A=Aa(m).match(v),L=Number(A.groups.line)-14,R=A.groups.msg.trim(),w=A.groups.type.toLowerCase();throw new Error(`${w} shader line ${L}: ${R}`)}}o(Rt,"makeShader");function $t(i,a,l,f){let m=i.width/a,v={},A=f.split("").entries();for(let[L,R]of A)v[R]=new Ie(L%m*a,Math.floor(L/m)*l,a,l);return{tex:i,map:v,size:l}}o($t,"makeFont");function tt(i,a,l,f=x.defTex,m=x.defShader,v={}){let A=Ms(m);if(!A||A instanceof _e)return;let L=x.fixed||l?x.transform:M.cam.transform.mult(x.transform),R=[];for(let w of i){let V=es(L.multVec2(w.pos));R.push(V.x,V.y,w.uv.x,w.uv.y,w.color.r/255,w.color.g/255,w.color.b/255,w.opacity)}x.renderer.push(y.TRIANGLES,R,a,A,f,v)}o(tt,"drawRaw");function Le(){x.renderer.flush()}o(Le,"flush");function Dt(){y.clear(y.COLOR_BUFFER_BIT),x.frameBuffer.bind(),y.clear(y.COLOR_BUFFER_BIT),x.bgColor||de(()=>{vt({width:Ne(),height:Ke(),quad:new Ie(0,0,Ne()/64,Ke()/64),tex:x.bgTex,fixed:!0})}),x.renderer.numDraws=0,x.fixed=!1,x.transformStack.length=0,x.transform=new lt}o(Dt,"frameStart");function Ps(i,a){x.postShader=i,x.postShaderUniform=a??null}o(Ps,"usePostEffect");function Ot(){Le(),x.lastDrawCalls=x.renderer.numDraws,x.frameBuffer.unbind(),y.viewport(0,0,y.drawingBufferWidth,y.drawingBufferHeight);let i=x.width,a=x.height;x.width=y.drawingBufferWidth/u,x.height=y.drawingBufferHeight/u,Ut({flipY:!0,tex:x.frameBuffer.tex,pos:new I(x.viewport.x,x.viewport.y),width:x.viewport.width,height:x.viewport.height,shader:x.postShader,uniform:typeof x.postShaderUniform=="function"?x.postShaderUniform():x.postShaderUniform,fixed:!0}),Le(),x.width=i,x.height=a}o(Ot,"frameEnd");function es(i){return new I(i.x/Ne()*2-1,-i.y/Ke()*2+1)}o(es,"screen2ndc");function ts(i){x.transform=i.clone()}o(ts,"pushMatrix");function Ve(...i){if(i[0]===void 0)return;let a=E(...i);a.x===0&&a.y===0||x.transform.translate(a)}o(Ve,"pushTranslate");function dt(...i){if(i[0]===void 0)return;let a=E(...i);a.x===1&&a.y===1||x.transform.scale(a)}o(dt,"pushScale");function rt(i){i&&x.transform.rotate(i)}o(rt,"pushRotate");function We(){x.transformStack.push(x.transform.clone())}o(We,"pushTransform");function je(){x.transformStack.length>0&&(x.transform=x.transformStack.pop())}o(je,"popTransform");function vt(i){if(i.width===void 0||i.height===void 0)throw new Error('drawUVQuad() requires property "width" and "height".');if(i.width<=0||i.height<=0)return;let a=i.width,l=i.height,f=It(i.anchor||Ws).scale(new I(a,l).scale(-.5)),m=i.quad||new Ie(0,0,1,1),v=i.color||we(255,255,255),A=i.opacity??1,L=i.tex?.1/i.tex.width:0,R=i.tex?.1/i.tex.height:0,w=m.x+L,V=m.y+R,U=m.w-L*2,k=m.h-R*2;We(),Ve(i.pos),rt(i.angle),dt(i.scale),Ve(f),tt([{pos:new I(-a/2,l/2),uv:new I(i.flipX?w+U:w,i.flipY?V:V+k),color:v,opacity:A},{pos:new I(-a/2,-l/2),uv:new I(i.flipX?w+U:w,i.flipY?V+k:V),color:v,opacity:A},{pos:new I(a/2,-l/2),uv:new I(i.flipX?w:w+U,i.flipY?V+k:V),color:v,opacity:A},{pos:new I(a/2,l/2),uv:new I(i.flipX?w:w+U,i.flipY?V:V+k),color:v,opacity:A}],[0,1,3,1,2,3],i.fixed,i.tex,i.shader,i.uniform),je()}o(vt,"drawUVQuad");function Ut(i){if(!i.tex)throw new Error('drawTexture() requires property "tex".');let a=i.quad??new Ie(0,0,1,1),l=i.tex.width*a.w,f=i.tex.height*a.h,m=new I(1);if(i.tiled){let v=Math.ceil((i.width||l)/l),A=Math.ceil((i.height||f)/f),L=It(i.anchor||Ws).add(new I(1,1)).scale(.5).scale(v*l,A*f);for(let R=0;R<v;R++)for(let w=0;w<A;w++)vt(Object.assign({},i,{pos:(i.pos||new I(0)).add(new I(l*R,f*w)).sub(L),scale:m.scale(i.scale||new I(1)),tex:i.tex,quad:a,width:l,height:f,anchor:"topleft"}))}else i.width&&i.height?(m.x=i.width/l,m.y=i.height/f):i.width?(m.x=i.width/l,m.y=m.x):i.height&&(m.y=i.height/f,m.x=m.y),vt(Object.assign({},i,{scale:m.scale(i.scale||new I(1)),tex:i.tex,quad:a,width:l,height:f}))}o(Ut,"drawTexture");function ss(i){if(!i.sprite)throw new Error('drawSprite() requires property "sprite"');let a=Xt(i.sprite);if(!a||!a.data)return;let l=a.data.frames[i.frame??0];if(!l)throw new Error(`Frame not found: ${i.frame??0}`);Ut(Object.assign({},i,{tex:a.data.tex,quad:l.scale(i.quad??new Ie(0,0,1,1))}))}o(ss,"drawSprite");function pt(i,a,l,f,m,v=1){f=ke(f%360),m=ke(m%360),m<=f&&(m+=Math.PI*2);let A=[],L=Math.ceil((m-f)/ke(8)*v),R=(m-f)/L,w=E(Math.cos(f),Math.sin(f)),V=E(Math.cos(R),Math.sin(R));for(let U=0;U<=L;U++)A.push(i.add(a*w.x,l*w.y)),w=E(w.x*V.x-w.y*V.y,w.x*V.y+w.y*V.x);return A}o(pt,"getArcPts");function Ge(i){if(i.width===void 0||i.height===void 0)throw new Error('drawRect() requires property "width" and "height".');if(i.width<=0||i.height<=0)return;let a=i.width,l=i.height,f=It(i.anchor||Ws).add(1,1).scale(new I(a,l).scale(-.5)),m=[new I(0,0),new I(a,0),new I(a,l),new I(0,l)];if(i.radius){let v=Math.min(a,l)/2,A=Array.isArray(i.radius)?i.radius.map(L=>Math.min(v,L)):new Array(4).fill(Math.min(v,i.radius));m=[new I(A[0],0),...A[1]?pt(new I(a-A[1],A[1]),A[1],A[1],270,360):[E(a,0)],...A[2]?pt(new I(a-A[2],l-A[2]),A[2],A[2],0,90):[E(a,l)],...A[3]?pt(new I(A[3],l-A[3]),A[3],A[3],90,180):[E(0,l)],...A[0]?pt(new I(A[0],A[0]),A[0],A[0],180,270):[]]}g(Object.assign({},i,{offset:f,pts:m,...i.gradient?{colors:i.horizontal?[i.gradient[0],i.gradient[1],i.gradient[1],i.gradient[0]]:[i.gradient[0],i.gradient[0],i.gradient[1],i.gradient[1]]}:{}}))}o(Ge,"drawRect");function ft(i){let{p1:a,p2:l}=i;if(!a||!l)throw new Error('drawLine() requires properties "p1" and "p2".');let f=i.width||1,m=l.sub(a).unit().normal().scale(f*.5),v=[a.sub(m),a.add(m),l.add(m),l.sub(m)].map(A=>({pos:new I(A.x,A.y),uv:new I(0),color:i.color??pe.WHITE,opacity:i.opacity??1}));tt(v,[0,1,3,1,2,3],i.fixed,x.defTex,i.shader,i.uniform)}o(ft,"drawLine");function is(i){let a=i.pts,l=[],f=(i.width||1)*.5,m=a[0]===a[a.length-1]||a[0].eq(a[a.length-1]),v=i.pos||E(0,0),A;m?A=a[0].sub(a[a.length-2]):A=a[1].sub(a[0]);let L=A.len(),R=A.normal().scale(-f/L),w,V=a[0];if(!m)switch(i.cap){case"square":{let S=A.scale(-f/L);l.push(V.add(S).add(R)),l.push(V.add(S).sub(R));break}case"round":{let S=Math.max(f,10),F=Math.PI/S,O=R.scale(-1),te=Math.cos(F),z=Math.sin(F);for(let ee=0;ee<S;ee++)l.push(V),l.push(V.sub(O)),O=E(O.x*te-O.y*z,O.x*z+O.y*te)}}for(let S=1;S<a.length;S++){if(V===a[S]||V.eq(a[S]))continue;w=V,V=a[S];let F=V.sub(w),O=F.len(),te=F.normal().scale(-f/O),z=A.cross(F);if(Math.abs(z)/(L*O)<.05){l.push(w.add(R)),l.push(w.sub(R)),A.dot(F)<0&&(l.push(w.sub(R)),l.push(w.add(R))),A=F,L=O,R=te;continue}let ee=te.sub(R).cross(F)/z,_=R.add(A.scale(ee));z>0?(l.push(w.add(_)),l.push(w.sub(R)),l.push(w.add(_)),l.push(w.sub(te))):(l.push(w.add(R)),l.push(w.sub(_)),l.push(w.add(te)),l.push(w.sub(_))),A=F,L=O,R=te}if(!m)switch(l.push(V.add(R)),l.push(V.sub(R)),i.cap){case"square":{let S=A.scale(f/L);l.push(V.add(S).add(R)),l.push(V.add(S).sub(R));break}case"round":{let S=Math.max(f,10),F=Math.PI/S,O=R.scale(1),te=Math.cos(F),z=Math.sin(F);for(let ee=0;ee<S;ee++)O=E(O.x*te-O.y*z,O.x*z+O.y*te),l.push(V),l.push(V.sub(O))}}if(l.length<4)return;let U=l.map(S=>({pos:v.add(S),uv:E(),color:i.color||pe.WHITE,opacity:i.opacity??1})),k=[],D=0;for(let S=0;S<l.length-2;S+=2)k[D++]=S+1,k[D++]=S,k[D++]=S+2,k[D++]=S+2,k[D++]=S+3,k[D++]=S+1;m&&(k[D++]=l.length-1,k[D++]=l.length-2,k[D++]=0,k[D++]=0,k[D++]=1,k[D++]=l.length-1),tt(U,k,i.fixed,x.defTex,i.shader,i.uniform)}o(is,"_drawLinesBevel");function Ue(i){let a=i.pts,l=[],f=(i.width||1)*.5,m=a[0]===a[a.length-1]||a[0].eq(a[a.length-1]),v=i.pos||E(0,0),A;m?A=a[0].sub(a[a.length-2]):A=a[1].sub(a[0]);let L=A.len(),R=A.normal().scale(-f/L),w,V=a[0];if(!m)switch(i.cap){case"square":{let S=A.scale(-f/L);l.push(V.add(S).add(R)),l.push(V.add(S).sub(R));break}case"round":{let S=Math.max(f,10),F=Math.PI/S,O=R.scale(-1),te=Math.cos(F),z=Math.sin(F);for(let ee=0;ee<S;ee++)l.push(V),l.push(V.sub(O)),O=E(O.x*te-O.y*z,O.x*z+O.y*te)}}for(let S=1;S<a.length;S++){if(V===a[S]||V.eq(a[S]))continue;w=V,V=a[S];let F=V.sub(w),O=F.len(),te=F.normal().scale(-f/O),z=A.cross(F);if(Math.abs(z)/(L*O)<.05){l.push(w.add(R)),l.push(w.sub(R)),A.dot(F)<0&&(l.push(w.sub(R)),l.push(w.add(R))),A=F,L=O,R=te;continue}let ee=te.sub(R).cross(F)/z,_=R.add(A.scale(ee));if(z>0){let Qe=w.add(_),T=Math.max(f,10),H=ke(R.angleBetween(te)/T),q=R,X=Math.cos(H),se=Math.sin(H);for(let ie=0;ie<T;ie++)l.push(Qe),l.push(w.sub(q)),q=E(q.x*X-q.y*se,q.x*se+q.y*X)}else{let Qe=w.sub(_),T=Math.max(f,10),H=ke(R.angleBetween(te)/T),q=R,X=Math.cos(H),se=Math.sin(H);for(let ie=0;ie<T;ie++)l.push(w.add(q)),l.push(Qe),q=E(q.x*X-q.y*se,q.x*se+q.y*X)}A=F,L=O,R=te}if(!m)switch(l.push(V.add(R)),l.push(V.sub(R)),i.cap){case"square":{let S=A.scale(f/L);l.push(V.add(S).add(R)),l.push(V.add(S).sub(R));break}case"round":{let S=Math.max(f,10),F=Math.PI/S,O=R.scale(1),te=Math.cos(F),z=Math.sin(F);for(let ee=0;ee<S;ee++)O=E(O.x*te-O.y*z,O.x*z+O.y*te),l.push(V),l.push(V.sub(O))}}if(l.length<4)return;let U=l.map(S=>({pos:v.add(S),uv:E(),color:i.color||pe.WHITE,opacity:i.opacity??1})),k=[],D=0;for(let S=0;S<l.length-2;S+=2)k[D++]=S+1,k[D++]=S,k[D++]=S+2,k[D++]=S+2,k[D++]=S+3,k[D++]=S+1;m&&(k[D++]=l.length-1,k[D++]=l.length-2,k[D++]=0,k[D++]=0,k[D++]=1,k[D++]=l.length-1),tt(U,k,i.fixed,x.defTex,i.shader,i.uniform)}o(Ue,"_drawLinesRound");function bt(i){let a=i.pts,l=[],f=(i.width||1)*.5,m=a[0]===a[a.length-1]||a[0].eq(a[a.length-1]),v=i.pos||E(0,0),A;m?A=a[0].sub(a[a.length-2]):A=a[1].sub(a[0]);let L=A.len(),R=A.normal().scale(-f/L),w,V=a[0];if(!m)switch(i.cap){case"square":{let S=A.scale(-f/L);l.push(V.add(S).add(R)),l.push(V.add(S).sub(R));break}case"round":{let S=Math.max(f,10),F=Math.PI/S,O=R.scale(-1),te=Math.cos(F),z=Math.sin(F);for(let ee=0;ee<S;ee++)l.push(V),l.push(V.sub(O)),O=E(O.x*te-O.y*z,O.x*z+O.y*te)}}for(let S=1;S<a.length;S++){if(V===a[S]||V.eq(a[S]))continue;w=V,V=a[S];let F=V.sub(w),O=F.len(),te=F.normal().scale(-f/O),z=A.cross(F);if(Math.abs(z)/(L*O)<.05){l.push(w.add(R)),l.push(w.sub(R)),A.dot(F)<0&&(l.push(w.sub(R)),l.push(w.add(R))),A=F,L=O,R=te;continue}let ee=te.sub(R).cross(F)/z,_=R.add(A.scale(ee));l.push(w.add(_)),l.push(w.sub(_)),A=F,L=O,R=te}if(!m)switch(l.push(V.add(R)),l.push(V.sub(R)),i.cap){case"square":{let S=A.scale(f/L);l.push(V.add(S).add(R)),l.push(V.add(S).sub(R));break}case"round":{let S=Math.max(f,10),F=Math.PI/S,O=R.scale(1),te=Math.cos(F),z=Math.sin(F);for(let ee=0;ee<S;ee++)O=E(O.x*te-O.y*z,O.x*z+O.y*te),l.push(V),l.push(V.sub(O))}}if(l.length<4)return;let U=l.map(S=>({pos:v.add(S),uv:E(),color:i.color||pe.WHITE,opacity:i.opacity??1})),k=[],D=0;for(let S=0;S<l.length-2;S+=2)k[D++]=S+1,k[D++]=S,k[D++]=S+2,k[D++]=S+2,k[D++]=S+3,k[D++]=S+1;m&&(k[D++]=l.length-1,k[D++]=l.length-2,k[D++]=0,k[D++]=0,k[D++]=1,k[D++]=l.length-1),tt(U,k,i.fixed,x.defTex,i.shader,i.uniform)}o(bt,"_drawLinesMiter");function st(i){let a=i.pts;if(!a)throw new Error('drawLines() requires property "pts".');if(!(a.length<2)){if(a.length>2)switch(i.join){case"bevel":return is(i);case"round":return Ue(i);case"miter":return bt(i)}if(i.radius&&a.length>=3){ft(Object.assign({},i,{p1:a[0],p2:a[1]}));for(let l=1;l<a.length-2;l++){let f=a[l],m=a[l+1];ft(Object.assign({},i,{p1:f,p2:m}))}ft(Object.assign({},i,{p1:a[a.length-2],p2:a[a.length-1]}))}else for(let l=0;l<a.length-1;l++)ft(Object.assign({},i,{p1:a[l],p2:a[l+1]})),i.join!=="none"&&Pt(Object.assign({},i,{pos:a[l],radius:i.width/2}))}}o(st,"drawLines");function Lt(i,a){let l=a.segments??16,f=[];for(let m=0;m<=l;m++)f.push(i(m/l));st({pts:f,width:a.width||1,pos:a.pos,color:a.color,opacity:a.opacity})}o(Lt,"drawCurve");function ns(i){Lt(a=>Ys(i.pt1,i.pt2,i.pt3,i.pt4,a),i)}o(ns,"drawBezier");function rs(i){if(!i.p1||!i.p2||!i.p3)throw new Error('drawTriangle() requires properties "p1", "p2" and "p3".');return g(Object.assign({},i,{pts:[i.p1,i.p2,i.p3]}))}o(rs,"drawTriangle");function Pt(i){if(typeof i.radius!="number")throw new Error('drawCircle() requires property "radius".');i.radius!==0&&Wt(Object.assign({},i,{radiusX:i.radius,radiusY:i.radius,angle:0}))}o(Pt,"drawCircle");function Wt(i){if(i.radiusX===void 0||i.radiusY===void 0)throw new Error('drawEllipse() requires properties "radiusX" and "radiusY".');if(i.radiusX===0||i.radiusY===0)return;let a=i.start??0,l=i.end??360,f=It(i.anchor??"center").scale(new I(-i.radiusX,-i.radiusY)),m=pt(f,i.radiusX,i.radiusY,a,l,i.resolution);m.unshift(f);let v=Object.assign({},i,{pts:m,radius:0,...i.gradient?{colors:[i.gradient[0],...Array(m.length-1).fill(i.gradient[1])]}:{}});if(l-a>=360&&i.outline){i.fill!==!1&&g(Object.assign({},v,{outline:null})),g(Object.assign({},v,{pts:m.slice(1),fill:!1}));return}g(v)}o(Wt,"drawEllipse");function g(i){if(!i.pts)throw new Error('drawPolygon() requires property "pts".');let a=i.pts.length;if(!(a<3)){if(We(),Ve(i.pos),dt(i.scale),rt(i.angle),Ve(i.offset),i.fill!==!1){let l=i.color??pe.WHITE,f=i.pts.map((v,A)=>({pos:new I(v.x,v.y),uv:i.uv?i.uv[A]:new I(0,0),color:i.colors&&i.colors[A]?i.colors[A].mult(l):l,opacity:i.opacity??1})),m;i.triangulate?m=Bi(i.pts).map(v=>v.map(A=>i.pts.indexOf(A))).flat():m=[...Array(a-2).keys()].map(v=>[0,v+1,v+2]).flat(),tt(f,i.indices??m,i.fixed,i.uv?i.tex:x.defTex,i.shader,i.uniform)}i.outline&&st({pts:[...i.pts,i.pts[0]],radius:i.radius,width:i.outline.width,color:i.outline.color,join:i.outline.join,uniform:i.uniform,fixed:i.fixed,opacity:i.opacity??i.outline.opacity}),je()}}o(g,"drawPolygon");function b(i,a,l){Le(),y.clear(y.STENCIL_BUFFER_BIT),y.enable(y.STENCIL_TEST),y.stencilFunc(y.NEVER,1,255),y.stencilOp(y.REPLACE,y.REPLACE,y.REPLACE),a(),Le(),y.stencilFunc(l,1,255),y.stencilOp(y.KEEP,y.KEEP,y.KEEP),i(),Le(),y.disable(y.STENCIL_TEST)}o(b,"drawStenciled");function B(i,a){b(i,a,y.EQUAL)}o(B,"drawMasked");function $(i,a){b(i,a,y.NOTEQUAL)}o($,"drawSubtracted");function Me(){return(x.viewport.width+x.viewport.height)/(x.width+x.height)}o(Me,"getViewportScale");function de(i){Le();let a=x.width,l=x.height;x.width=x.viewport.width,x.height=x.viewport.height,i(),Le(),x.width=a,x.height=l}o(de,"drawUnscaled");function He(i,a){a.pos&&(i.pos=i.pos.add(a.pos)),a.scale&&(i.scale=i.scale.scale(E(a.scale))),a.angle&&(i.angle+=a.angle),a.color&&i.ch.length===1&&(i.color=i.color.mult(a.color)),a.opacity&&(i.opacity*=a.opacity)}o(He,"applyCharTransform");function ot(i){let a={},l=i.replace(sr,"$2"),f=0;for(let m of i.matchAll(sr)){let v=m.index-f;for(let A=0;A<m.groups.text.length;A++)a[A+v]=[m.groups.style];f+=m[0].length-m.groups.text.length}return{charStyleMap:a,text:l}}o(ot,"compileStyledText");let os={};function Ye(i){if(i.text===void 0)throw new Error('formatText() requires property "text".');let a=Jt(i.font);if(i.text===""||a instanceof _e||!a)return{width:0,height:0,chars:[],opt:i};let{charStyleMap:l,text:f}=ot(i.text+""),m=Zr(f);if(a instanceof Os||typeof a=="string"){let z=a instanceof Os?a.fontface.family:a,ee=a instanceof Os?{outline:a.outline,filter:a.filter}:{outline:null,filter:Oi},_=os[z]??{font:{tex:new Et(C,2048,2048,{filter:ee.filter}),map:{},size:64},cursor:new I(0),outline:ee.outline};os[z]||(os[z]=_),a=_.font;for(let Qe of m)if(!_.font.map[Qe]){let T=d;T.clearRect(0,0,p.width,p.height),T.font=`${a.size}px ${z}`,T.textBaseline="top",T.textAlign="left",T.fillStyle="#ffffff";let H=T.measureText(Qe),q=Math.ceil(H.width);if(!q)continue;let X=a.size;_.outline&&(T.lineJoin="round",T.lineWidth=_.outline.width*2,T.strokeStyle=_.outline.color.toHex(),T.strokeText(Qe,_.outline.width,_.outline.width),q+=_.outline.width*2,X+=_.outline.width*3),T.fillText(Qe,_.outline?.width??0,_.outline?.width??0);let se=T.getImageData(0,0,q,X);if(_.cursor.x+q>2048&&(_.cursor.x=0,_.cursor.y+=X,_.cursor.y>2048))throw new Error("Font atlas exceeds character limit");a.tex.update(se,_.cursor.x,_.cursor.y),a.map[Qe]=new Ie(_.cursor.x,_.cursor.y,q,X),_.cursor.x+=q}}let v=i.size||a.size,A=E(i.scale??1).scale(v/a.size),L=i.lineSpacing??0,R=i.letterSpacing??0,w=0,V=0,U=0,k=[],D=[],S=0,F=null,O=null;for(;S<m.length;){let z=m[S];if(z===`
`)U+=v+L,k.push({width:w-R,chars:D}),F=null,O=null,w=0,D=[];else{let ee=a.map[z];if(ee){let _=ee.w*A.x;i.width&&w+_>i.width&&(U+=v+L,F!=null&&(S-=D.length-F,z=m[S],ee=a.map[z],_=ee.w*A.x,D=D.slice(0,F-1),w=O),F=null,O=null,k.push({width:w-R,chars:D}),w=0,D=[]),D.push({tex:a.tex,width:ee.w,height:ee.h,quad:new Ie(ee.x/a.tex.width,ee.y/a.tex.height,ee.w/a.tex.width,ee.h/a.tex.height),ch:z,pos:new I(w,U),opacity:i.opacity??1,color:i.color??pe.WHITE,scale:E(A),angle:0}),z===" "&&(F=D.length,O=w),w+=_,V=Math.max(V,w),w+=R}}S++}k.push({width:w-R,chars:D}),U+=v,i.width&&(V=i.width);let te=[];for(let z=0;z<k.length;z++){let ee=(V-k[z].width)*Ko(i.align??"left");for(let _ of k[z].chars){let Qe=a.map[_.ch],T=te.length+z;if(_.pos=_.pos.add(ee,0).add(Qe.w*A.x*.5,Qe.h*A.y*.5),i.transform){let H=typeof i.transform=="function"?i.transform(T,_.ch):i.transform;H&&He(_,H)}if(l[T]){let H=l[T];for(let q of H){let X=i.styles[q],se=typeof X=="function"?X(T,_.ch):X;se&&He(_,se)}}te.push(_)}}return{width:V,height:U,chars:te,opt:i}}o(Ye,"formatText");function kt(i){Ct(Ye(i))}o(kt,"drawText");function Ct(i){We(),Ve(i.opt.pos),rt(i.opt.angle),Ve(It(i.opt.anchor??"topleft").add(1,1).scale(i.width,i.height).scale(-.5)),i.chars.forEach(a=>{vt({tex:a.tex,width:a.width,height:a.height,pos:a.pos,scale:a.scale,angle:a.angle,color:a.color,opacity:a.opacity,quad:a.quad,anchor:"center",uniform:i.opt.uniform,shader:i.opt.shader,fixed:i.opt.fixed})}),je()}o(Ct,"drawFormattedText");function Ne(){return x.width}o(Ne,"width");function Ke(){return x.height}o(Ke,"height");function on(){return M.root}o(on,"getTreeRoot");function an(i){return new I((i.x-x.viewport.x)*Ne()/x.viewport.width,(i.y-x.viewport.y)*Ke()/x.viewport.height)}o(an,"windowToContent");function ln(i){return new I(i.x*x.viewport.width/x.width,i.y*x.viewport.height/x.height)}o(ln,"contentToView");function ai(){return an(c.mousePos())}o(ai,"mousePos");let hn=!1,Ee={inspect:!1,timeScale:1,showLog:!0,fps:o(()=>c.fps(),"fps"),numFrames:o(()=>c.numFrames(),"numFrames"),stepFrame:mi,drawCalls:o(()=>x.lastDrawCalls,"drawCalls"),clearLog:o(()=>M.logs=[],"clearLog"),log:o(i=>{let a=t.logMax??8;M.logs.unshift({msg:i,time:c.time()}),M.logs.length>a&&(M.logs=M.logs.slice(0,a))},"log"),error:o(i=>Ee.log(new Error(i.toString?i.toString():i)),"error"),curRecording:null,numObjects:o(()=>fi("*",{recursive:!0}).length,"numObjects"),get paused(){return hn},set paused(i){hn=i,i?Q.ctx.suspend():Q.ctx.resume()}};function ks(){return c.dt()*Ee.timeScale}o(ks,"dt");function un(...i){return i.length>0&&(M.cam.pos=E(...i)),M.cam.pos?M.cam.pos.clone():ls()}o(un,"camPos");function cn(...i){return i.length>0&&(M.cam.scale=E(...i)),M.cam.scale.clone()}o(cn,"camScale");function dn(i){return i!==void 0&&(M.cam.angle=i),M.cam.angle}o(dn,"camRot");function pn(i=we(255,255,255),a=1){let l=Nt([Ni(Ne(),Ke()),Li(i),Wi(1),Gi()]),f=l.fadeOut(a);return f.onEnd(()=>pi(l)),f}o(pn,"camFlash");function fn(){return M.cam.transform.clone()}o(fn,"camTransform");function gn(i=12){M.cam.shake+=i}o(gn,"shake");function mn(i){return M.cam.transform.multVec2(i)}o(mn,"toScreen");function wn(i){return M.cam.transform.invert().multVec2(i)}o(wn,"toWorld");function li(i){let a=new lt;return i.pos&&a.translate(i.pos),i.scale&&a.scale(i.scale),i.angle&&a.rotate(i.angle),i.parent?a.mult(i.parent.transform):a}o(li,"calcTransform");function Cs(i=[]){let a=new Map,l={},f=new ds,m=[],v=null,A=!1,L={id:ya(),hidden:!1,transform:new lt,children:[],parent:null,set paused(w){if(w!==A){A=w;for(let V of m)V.paused=w}},get paused(){return A},get tags(){let w=[];for(let[V,U]of a.entries())Object.keys(U).length==1&&w.push(V);return w},add(w=[]){let V=Array.isArray(w)?Cs(w):w;if(V.parent)throw new Error("Cannot add a game obj that already has a parent.");return V.parent=this,V.transform=li(V),this.children.push(V),V.trigger("add",V),M.events.trigger("add",V),V},readd(w){let V=this.children.indexOf(w);return V!==-1&&(this.children.splice(V,1),this.children.push(w)),w},remove(w){let V=this.children.indexOf(w);if(V!==-1){w.parent=null,this.children.splice(V,1);let U=o(k=>{k.trigger("destroy"),M.events.trigger("destroy",k),k.children.forEach(D=>U(D))},"trigger");U(w)}},removeAll(w){if(w)this.get(w).forEach(V=>this.remove(V));else for(let V of[...this.children])this.remove(V)},update(){this.paused||(this.children.forEach(w=>w.update()),this.trigger("update"))},draw(){if(this.hidden)return;this.canvas&&(Le(),this.canvas.bind());let w=x.fixed;this.fixed&&(x.fixed=!0),We(),Ve(this.pos),dt(this.scale),rt(this.angle);let V=this.children.sort((U,k)=>{let D=U.layerIndex??M.defaultLayerIndex,S=k.layerIndex??M.defaultLayerIndex;return D-S||(U.z??0)-(k.z??0)});if(this.mask){let U={intersect:B,subtract:$}[this.mask];if(!U)throw new Error(`Invalid mask func: "${this.mask}"`);U(()=>{V.forEach(k=>k.draw())},()=>{this.trigger("draw")})}else this.trigger("draw"),V.forEach(U=>U.draw());je(),x.fixed=w,this.canvas&&(Le(),this.canvas.unbind())},drawInspect(){this.hidden||(We(),Ve(this.pos),dt(this.scale),rt(this.angle),this.children.forEach(w=>w.drawInspect()),this.trigger("drawInspect"),je())},use(w){if(!w)return;if(lo(w)&&(w=new w(this)),typeof w=="function")return this.use(w(this));if(typeof w=="string")return this.use({id:w});let V=[];w.id&&(this.unuse(w.id),l[w.id]=[],V=l[w.id],a.set(w.id,w));for(let k in w){if(Ia.has(k))continue;let D=Object.getOwnPropertyDescriptor(w,k);if(typeof D.value=="function"&&(w[k]=w[k].bind(this)),D.set&&Object.defineProperty(w,k,{set:D.set.bind(this)}),D.get&&Object.defineProperty(w,k,{get:D.get.bind(this)}),Ba.has(k)){let S=k==="add"?()=>{v=o(F=>V.push(F),"onCurCompCleanup"),w[k](),v=null}:w[k];V.push(this.on(k,S).cancel)}else if(this[k]===void 0)Object.defineProperty(this,k,{get:o(()=>w[k],"get"),set:o(S=>w[k]=S,"set"),configurable:!0,enumerable:!0}),V.push(()=>delete this[k]);else throw new Error(`Duplicate component property: "${k}"`)}let U=o(()=>{if(w.require){for(let k of w.require)if(!this.c(k))throw new Error(`Component "${w.id}" requires component "${k}"`)}},"checkDeps");w.destroy&&V.push(w.destroy.bind(this)),this.exists()?(U(),w.add&&(v=o(k=>V.push(k),"onCurCompCleanup"),w.add.call(this),v=null)):w.require&&V.push(this.on("add",U).cancel)},unuse(w){l[w]&&(l[w].forEach(V=>V()),delete l[w]),a.has(w)&&a.delete(w)},c(w){return a.get(w)},get(w,V={}){let U=V.recursive?this.children.flatMap(o(function k(D){return[D,...D.children.flatMap(k)]},"recurse")):this.children;if(U=U.filter(k=>w?k.is(w):!0),V.liveUpdate){let k=o(S=>V.recursive?this.isAncestorOf(S):S.parent===this,"isChild"),D=[];D.push(hi(S=>{k(S)&&S.is(w)&&U.push(S)})),D.push(yn(S=>{if(k(S)&&S.is(w)){let F=U.findIndex(O=>O.id===S.id);F!==-1&&U.splice(F,1)}})),this.onDestroy(()=>{for(let S of D)S.cancel()})}return U},query(w){let V=w.hierarchy||"children",U=[];switch(V){case"children":U=this.children;break;case"siblings":U=this.parent?this.parent.children.filter(D=>D!==this):[];break;case"ancestors":let k=this.parent;for(;k;)U.push(k),k=k.parent;break;case"descendants":U=this.children.flatMap(o(function D(S){return[S,...S.children.flatMap(D)]},"recurse"));break}if(w.include&&((w.includeOp||"and")==="and"||!Array.isArray(w.include)?U=U.filter(k=>k.is(w.include)):U=U.filter(k=>w.include.some(D=>k.is(D)))),w.exclude&&((w.includeOp||"and")==="and"||!Array.isArray(w.include)?U=U.filter(k=>!k.is(w.exclude)):U=U.filter(k=>!w.exclude.some(D=>k.is(D)))),w.visible===!0&&(U=U.filter(k=>k.visible)),w.distance){if(!this.pos)throw Error("Can't do a distance query from an object without pos");let k=w.distanceOp||"near",D=w.distance*w.distance;k==="near"?U=U.filter(S=>S.pos&&this.pos.sdist(S.pos)<=D):U=U.filter(S=>S.pos&&this.pos.sdist(S.pos)>D)}return w.name&&(U=U.filter(k=>k.name===w.name)),U},isAncestorOf(w){return w.parent?w.parent===this||this.isAncestorOf(w.parent):!1},exists(){return M.root.isAncestorOf(this)},is(w){if(w==="*")return!0;if(Array.isArray(w)){for(let V of w)if(!this.c(V))return!1;return!0}else return this.c(w)!=null},on(w,V){let U=f.on(w,V.bind(this));return v&&v(()=>U.cancel()),U},trigger(w,...V){f.trigger(w,...V),M.objEvents.trigger(w,this,...V)},destroy(){this.parent&&this.parent.remove(this)},inspect(){let w={};for(let[V,U]of a)w[V]=U.inspect?U.inspect():null;return w},onAdd(w){return this.on("add",w)},onUpdate(w){return this.on("update",w)},onDraw(w){return this.on("draw",w)},onDestroy(w){return this.on("destroy",w)},clearEvents(){f.clear()}},R=["onKeyPress","onKeyPressRepeat","onKeyDown","onKeyRelease","onMousePress","onMouseDown","onMouseRelease","onMouseMove","onCharInput","onMouseMove","onTouchStart","onTouchMove","onTouchEnd","onScroll","onGamepadButtonPress","onGamepadButtonDown","onGamepadButtonRelease","onGamepadStick","onButtonPress","onButtonDown","onButtonRelease"];for(let w of R)L[w]=(...V)=>{let U=c[w]?.(...V);return m.push(U),L.onDestroy(()=>U.cancel()),U};for(let w of i)L.use(w);return L}o(Cs,"make");function gt(i,a,l){return M.objEvents[i]||(M.objEvents[i]=new Kr),M.objEvents.on(i,(f,...m)=>{f.is(a)&&l(f,...m)})}o(gt,"on");let _o=Be(i=>{let a=Nt([{update:i}]);return{get paused(){return a.paused},set paused(l){a.paused=l},cancel:o(()=>a.destroy(),"cancel")}},(i,a)=>gt("update",i,a)),Zo=Be(i=>{let a=Nt([{draw:i}]);return{get paused(){return a.hidden},set paused(l){a.hidden=l},cancel:o(()=>a.destroy(),"cancel")}},(i,a)=>gt("draw",i,a)),hi=Be(i=>M.events.on("add",i),(i,a)=>gt("add",i,a)),yn=Be(i=>M.events.on("destroy",i),(i,a)=>gt("destroy",i,a));function An(i,a,l){return gt("collide",i,(f,m,v)=>m.is(a)&&l(f,m,v))}o(An,"onCollide");function xn(i,a,l){return gt("collideUpdate",i,(f,m,v)=>m.is(a)&&l(f,m,v))}o(xn,"onCollideUpdate");function vn(i,a,l){return gt("collideEnd",i,(f,m,v)=>m.is(a)&&l(f,m,v))}o(vn,"onCollideEnd");function as(i,a){fi(i,{recursive:!0}).forEach(a),hi(i,a)}o(as,"forAllCurrentAndFuture");let $o=Be(i=>c.onMousePress(i),(i,a)=>{let l=[];return as(i,f=>{if(!f.area)throw new Error("onClick() requires the object to have area() component");l.push(f.onClick(()=>a(f)))}),Kt.join(l)});function bn(i,a){let l=[];return as(i,f=>{if(!f.area)throw new Error("onHover() requires the object to have area() component");l.push(f.onHover(()=>a(f)))}),Kt.join(l)}o(bn,"onHover");function Vn(i,a){let l=[];return as(i,f=>{if(!f.area)throw new Error("onHoverUpdate() requires the object to have area() component");l.push(f.onHoverUpdate(()=>a(f)))}),Kt.join(l)}o(Vn,"onHoverUpdate");function En(i,a){let l=[];return as(i,f=>{if(!f.area)throw new Error("onHoverEnd() requires the object to have area() component");l.push(f.onHoverEnd(()=>a(f)))}),Kt.join(l)}o(En,"onHoverEnd");function Sn(i){M.gravity=i?(M.gravity||E(0,1)).unit().scale(i):null}o(Sn,"setGravity");function Mn(){return M.gravity?M.gravity.len():0}o(Mn,"getGravity");function Rn(i){M.gravity=i.unit().scale(M.gravity?M.gravity.len():1)}o(Rn,"setGravityDirection");function Pn(){return M.gravity?M.gravity.unit():E(0,1)}o(Pn,"getGravityDirection");function kn(...i){i.length===1||i.length===2?(x.bgColor=we(i[0]),i[1]&&(x.bgAlpha=i[1])):(i.length===3||i.length===4)&&(x.bgColor=we(i[0],i[1],i[2]),i[3]&&(x.bgAlpha=i[3])),y.clearColor(x.bgColor.r/255,x.bgColor.g/255,x.bgColor.b/255,x.bgAlpha)}o(kn,"setBackground");function Cn(){return x.bgColor.clone()}o(Cn,"getBackground");function Ts(i,a){return Number(i.toFixed(a))}o(Ts,"toFixed");function ui(i){return i.fixed?!0:i.parent?ui(i.parent):!1}o(ui,"isFixed");function Tn(i){return{color:i.color,opacity:i.opacity,anchor:i.anchor,outline:i.outline,shader:i.shader,uniform:i.uniform}}o(Tn,"getRenderProps");function In(i){j.loaded?i():M.events.on("load",i)}o(In,"onLoad");function Bn(i,a){M.scenes[i]=a}o(Bn,"scene");function Fn(i,...a){if(!M.scenes[i])throw new Error(`Scene not found: ${i}`);M.events.onOnce("frameEnd",()=>{M.events.trigger("sceneLeave",i),c.events.clear(),M.events.clear(),M.objEvents.clear(),[...M.root.children].forEach(l=>{(!l.stay||l.scenesToStay&&!l.scenesToStay.includes(i))&&M.root.remove(l)}),M.root.clearEvents(),xi(),M.cam={pos:null,scale:E(1),angle:0,shake:0,transform:new lt},M.scenes[i](...a)}),M.currentScene=i}o(Fn,"go");function Dn(i){return M.events.on("sceneLeave",i)}o(Dn,"onSceneLeave");function On(){return M.currentScene}o(On,"getSceneName");function Un(i,a){try{return JSON.parse(window.localStorage[i])}catch{return a?(ci(i,a),a):null}}o(Un,"getData");function ci(i,a){window.localStorage[i]=JSON.stringify(a)}o(ci,"setData");function di(i,...a){let l=i(it),f;typeof l=="function"?f=l(...a)(it):f=l;for(let m in f)it[m]=f[m],t.global!==!1&&(window[m]=f[m]);return it}o(di,"plug");function ls(){return E(Ne()/2,Ke()/2)}o(ls,"center");let ea;(i=>(i[i.None=0]="None",i[i.Left=1]="Left",i[i.Top=2]="Top",i[i.LeftTop=3]="LeftTop",i[i.Right=4]="Right",i[i.Horizontal=5]="Horizontal",i[i.RightTop=6]="RightTop",i[i.HorizontalTop=7]="HorizontalTop",i[i.Bottom=8]="Bottom",i[i.LeftBottom=9]="LeftBottom",i[i.Vertical=10]="Vertical",i[i.LeftVertical=11]="LeftVertical",i[i.RightBottom=12]="RightBottom",i[i.HorizontalBottom=13]="HorizontalBottom",i[i.RightVertical=14]="RightVertical",i[i.All=15]="All"))(ea||={});function Ln(i,a){if(!a.tileWidth||!a.tileHeight)throw new Error("Must provide tileWidth and tileHeight.");let l=Nt([ms(a.pos??E(0))]),f=i.length,m=0,v=null,A=null,L=null,R=null,w=o(T=>T.x+T.y*m,"tile2Hash"),V=o(T=>E(Math.floor(T%m),Math.floor(T/m)),"hash2Tile"),U=o(()=>{v=[];for(let T of l.children)k(T)},"createSpatialMap"),k=o(T=>{let H=w(T.tilePos);v[H]?v[H].push(T):v[H]=[T]},"insertIntoSpatialMap"),D=o(T=>{let H=w(T.tilePos);if(v[H]){let q=v[H].indexOf(T);q>=0&&v[H].splice(q,1)}},"removeFromSpatialMap"),S=o(()=>{let T=!1;for(let H of l.children){let q=l.pos2Tile(H.pos);(H.tilePos.x!=q.x||H.tilePos.y!=q.y)&&(T=!0,D(H),H.tilePos.x=q.x,H.tilePos.y=q.y,k(H))}T&&l.trigger("spatial_map_changed")},"updateSpatialMap"),F=o(()=>{let T=l.getSpatialMap(),H=l.numRows()*l.numColumns();A?A.length=H:A=new Array(H),A.fill(1,0,H);for(let q=0;q<T.length;q++){let X=T[q];if(X){let se=0;for(let ie of X)if(ie.isObstacle){se=1/0;break}else se+=ie.cost;A[q]=se||1}}},"createCostMap"),O=o(()=>{let T=l.getSpatialMap(),H=l.numRows()*l.numColumns();L?L.length=H:L=new Array(H),L.fill(15,0,H);for(let q=0;q<T.length;q++){let X=T[q];if(X){let se=X.length,ie=15;for(let me=0;me<se;me++)ie|=X[me].edgeMask;L[q]=ie}}},"createEdgeMap"),te=o(()=>{let T=l.numRows()*l.numColumns(),H=o((X,se)=>{let ie=[];for(ie.push(X);ie.length>0;){let me=ie.pop();_(me).forEach(Re=>{R[Re]<0&&(R[Re]=se,ie.push(Re))})}},"traverse");R?R.length=T:R=new Array(T),R.fill(-1,0,T);let q=0;for(let X=0;X<A.length;X++){if(R[X]>=0){q++;continue}H(X,q),q++}},"createConnectivityMap"),z=o((T,H)=>A[H],"getCost"),ee=o((T,H)=>{let q=V(T),X=V(H);return q.dist(X)},"getHeuristic"),_=o((T,H)=>{let q=[],X=Math.floor(T%m),se=X>0&&L[T]&1&&A[T-1]!==1/0,ie=T>=m&&L[T]&2&&A[T-m]!==1/0,me=X<m-1&&L[T]&4&&A[T+1]!==1/0,Re=T<m*f-m-1&&L[T]&8&&A[T+m]!==1/0;return H?(se&&(ie&&q.push(T-m-1),q.push(T-1),Re&&q.push(T+m-1)),ie&&q.push(T-m),me&&(ie&&q.push(T-m+1),q.push(T+1),Re&&q.push(T+m+1)),Re&&q.push(T+m)):(se&&q.push(T-1),ie&&q.push(T-m),me&&q.push(T+1),Re&&q.push(T+m)),q},"getNeighbours"),Qe={id:"level",tileWidth(){return a.tileWidth},tileHeight(){return a.tileHeight},spawn(T,...H){let q=E(...H),X=(()=>{if(typeof T=="string"){if(a.tiles[T]){if(typeof a.tiles[T]!="function")throw new Error("Level symbol def must be a function returning a component list");return a.tiles[T](q)}else if(a.wildcardTile)return a.wildcardTile(T,q)}else{if(Array.isArray(T))return T;throw new Error("Expected a symbol or a component list")}})();if(!X)return null;let se=!1,ie=!1;for(let Re of X)Re.id==="tile"&&(ie=!0),Re.id==="pos"&&(se=!0);se||X.push(ms()),ie||X.push(qi());let me=l.add(X);return se&&(me.tilePosOffset=me.pos.clone()),me.tilePos=q,v&&(k(me),this.trigger("spatial_map_changed"),this.trigger("navigation_map_invalid")),me},numColumns(){return m},numRows(){return f},levelWidth(){return m*this.tileWidth()},levelHeight(){return f*this.tileHeight()},tile2Pos(...T){return E(...T).scale(this.tileWidth(),this.tileHeight())},pos2Tile(...T){let H=E(...T);return E(Math.floor(H.x/this.tileWidth()),Math.floor(H.y/this.tileHeight()))},getSpatialMap(){return v||U(),v},onSpatialMapChanged(T){return this.on("spatial_map_changed",T)},onNavigationMapInvalid(T){return this.on("navigation_map_invalid",T)},getAt(T){v||U();let H=w(T);return v[H]||[]},raycast(T,H){T=T.scale(1/this.tileWidth(),1/this.tileHeight());let q=Sr(T,H,X=>{let se=this.getAt(X);if(se.some(me=>me.isObstacle))return!0;let ie;for(let me of se)if(me.is("area")){let Re=me.worldArea().raycast(T,H);ie?Re.fraction<ie.fraction&&(ie=Re,ie.object=me):(ie=Re,ie.object=me)}return ie||!1},64);return q&&(q.point=q.point.scale(this.tileWidth(),this.tileHeight())),q},update(){v&&S()},invalidateNavigationMap(){A=null,L=null,R=null},onNavigationMapChanged(T){return this.on("navigation_map_changed",T)},getTilePath(T,H,q={}){if(A||F(),L||O(),R||te(),T.x<0||T.x>=m||T.y<0||T.y>=f||H.x<0||H.x>=m||H.y<0||H.y>=f)return null;let X=w(T),se=w(H);if(A[se]===1/0)return null;if(X===se)return[];if(R[X]!=-1&&R[X]!==R[se])return null;let ie=new _r((mt,bi)=>mt.cost<bi.cost);ie.insert({cost:0,node:X});let me=new Map;me.set(X,X);let Re=new Map;for(Re.set(X,0);ie.length!==0;){let mt=ie.remove()?.node;if(mt===se)break;let bi=_(mt,q.allowDiagonals);for(let Tt of bi){let Vi=(Re.get(mt)||0)+z(mt,Tt)+ee(Tt,se);(!Re.has(Tt)||Vi<Re.get(Tt))&&(Re.set(Tt,Vi),ie.insert({cost:Vi,node:Tt}),me.set(Tt,mt))}}let vi=[],hs=se,ua=V(hs);for(vi.push(ua);hs!==X;){hs=me.get(hs);let mt=V(hs);vi.push(mt)}return vi.reverse()},getPath(T,H,q={}){let X=this.tileWidth(),se=this.tileHeight(),ie=this.getTilePath(this.pos2Tile(T),this.pos2Tile(H),q);return ie?[T,...ie.slice(1,-1).map(me=>me.scale(X,se).add(X/2,se/2)),H]:null}};return l.use(Qe),l.onNavigationMapInvalid(()=>{l.invalidateNavigationMap(),l.trigger("navigation_map_changed")}),i.forEach((T,H)=>{let q=T.split("");m=Math.max(q.length,m),q.forEach((X,se)=>{l.spawn(X,E(se,H))})}),l}o(Ln,"addLevel");function Wn(i){let a=c.canvas.captureStream(i),l=Q.ctx.createMediaStreamDestination();Q.masterNode.connect(l);let f=new MediaRecorder(a),m=[];return f.ondataavailable=v=>{v.data.size>0&&m.push(v.data)},f.onerror=()=>{Q.masterNode.disconnect(l),a.getTracks().forEach(v=>v.stop())},f.start(),{resume(){f.resume()},pause(){f.pause()},stop(){return f.stop(),Q.masterNode.disconnect(l),a.getTracks().forEach(v=>v.stop()),new Promise(v=>{f.onstop=()=>{v(new Blob(m,{type:"video/mp4"}))}})},download(v="kaboom.mp4"){this.stop().then(A=>Fi(v,A))}}}o(Wn,"record");function Nn(){return document.activeElement===c.canvas}o(Nn,"isFocused");function pi(i){i.destroy()}o(pi,"destroy");let Nt=M.root.add.bind(M.root),ta=M.root.readd.bind(M.root),sa=M.root.removeAll.bind(M.root),fi=M.root.get.bind(M.root),ia=M.root.wait.bind(M.root),na=M.root.loop.bind(M.root),ra=M.root.query.bind(M.root),oa=M.root.tween.bind(M.root),aa=o(function(i,a){if(M.layers)throw Error("Layers can only be assigned once.");let l=i.indexOf(a);if(l==-1)throw Error("The default layer name should be present in the layers list.");M.layers=i,M.defaultLayerIndex=l},"layers");function gi(i=2,a=1){let l=0;return{require:["scale"],update(){let f=Math.sin(l*i)*a;f<0&&this.destroy(),this.scale=E(f),l+=ks()}}}o(gi,"boom");let la=ce(null,Ya),ha=ce(null,Ga);function qn(i,a={}){let l=Nt([ms(i),ji()]),f=(a.speed||1)*5,m=a.scale||1;l.add([qs(ha),ys(0),Gs("center"),gi(f,m),...a.comps??[]]);let v=l.add([qs(la),ys(0),Gs("center"),js(),...a.comps??[]]);return v.wait(.4/f,()=>v.use(gi(f,m))),v.onDestroy(()=>l.destroy()),l}o(qn,"addKaboom");function mi(){M.root.update()}o(mi,"updateFrame");class wi{static{o(this,"Collision")}source;target;displacement;resolved=!1;constructor(a,l,f,m=!1){this.source=a,this.target=l,this.displacement=f,this.resolved=m}reverse(){return new wi(this.target,this.source,this.displacement.scale(-1),this.resolved)}hasOverlap(){return!this.displacement.isZero()}isLeft(){return this.displacement.cross(M.gravity||E(0,1))>0}isRight(){return this.displacement.cross(M.gravity||E(0,1))<0}isTop(){return this.displacement.dot(M.gravity||E(0,1))>0}isBottom(){return this.displacement.dot(M.gravity||E(0,1))<0}preventResolution(){this.resolved=!0}}function jn(){let i={},a=t.hashGridSize||64,l=new lt,f=[];function m(v){if(f.push(l.clone()),v.pos&&l.translate(v.pos),v.scale&&l.scale(v.scale),v.angle&&l.rotate(v.angle),v.transform=l.clone(),v.c("area")&&!v.paused){let A=v,L=A.worldArea().bbox(),R=Math.floor(L.pos.x/a),w=Math.floor(L.pos.y/a),V=Math.ceil((L.pos.x+L.width)/a),U=Math.ceil((L.pos.y+L.height)/a),k=new Set;for(let D=R;D<=V;D++)for(let S=w;S<=U;S++)if(!i[D])i[D]={},i[D][S]=[A];else if(!i[D][S])i[D][S]=[A];else{let F=i[D][S];e:for(let O of F){if(O.paused||!O.exists()||k.has(O.id))continue;for(let z of A.collisionIgnore)if(O.is(z))continue e;for(let z of O.collisionIgnore)if(A.is(z))continue e;let te=Nr(A.worldArea(),O.worldArea());if(te){let z=new wi(A,O,te);A.trigger("collideUpdate",O,z);let ee=z.reverse();ee.resolved=z.resolved,O.trigger("collideUpdate",A,ee)}k.add(O.id)}F.push(A)}}v.children.forEach(m),l=f.pop()}o(m,"checkObj"),m(M.root)}o(jn,"checkFrame");function Gn(){let i=M.cam,a=I.fromAngle(ct(0,360)).scale(i.shake);i.shake=nt(i.shake,0,5*ks()),i.transform=new lt().translate(ls()).scale(i.scale).rotate(i.angle).translate((i.pos??ls()).scale(-1).add(a)),M.root.draw(),Le()}o(Gn,"drawFrame");function Hn(){let i=K();M.events.numListeners("loading")>0?M.events.trigger("loading",i):de(()=>{let a=Ne()/2,l=24,f=E(Ne()/2,Ke()/2).sub(E(a/2,l/2));Ge({pos:E(0),width:Ne(),height:Ke(),color:we(0,0,0)}),Ge({pos:f,width:a,height:l,fill:!1,outline:{width:4}}),Ge({pos:f,width:a*i,height:l})})}o(Hn,"drawLoadScreen");function yi(i,a){de(()=>{let l=E(8);We(),Ve(i);let f=Ye({text:a,font:Fs,size:16,pos:l,color:we(255,255,255),fixed:!0}),m=f.width+l.x*2,v=f.height+l.x*2;i.x+m>=Ne()&&Ve(E(-m,0)),i.y+v>=Ke()&&Ve(E(0,-v)),Ge({width:m,height:v,color:we(0,0,0),radius:4,opacity:.8,fixed:!0}),Ct(f),je()})}o(yi,"drawInspectText");function Yn(){if(Ee.inspect){let i=null;for(let a of M.root.get("*",{recursive:!0}))if(a.c("area")&&a.isHovering()){i=a;break}if(M.root.drawInspect(),i){let a=[],l=i.inspect();for(let f in l)l[f]?a.push(`${l[f]}`):a.push(`${f}`);yi(ln(ai()),a.join(`
`))}yi(E(8),`FPS: ${Ee.fps()}`)}Ee.paused&&de(()=>{We(),Ve(Ne(),0),Ve(-8,8);let i=32;Ge({width:i,height:i,anchor:"topright",color:we(0,0,0),opacity:.8,radius:4,fixed:!0});for(let a=1;a<=2;a++)Ge({width:4,height:i*.6,anchor:"center",pos:E(-i/3*a,i*.5),color:we(255,255,255),radius:2,fixed:!0});je()}),Ee.timeScale!==1&&de(()=>{We(),Ve(Ne(),Ke()),Ve(-8,-8);let i=8,a=Ye({text:Ee.timeScale.toFixed(1),font:Fs,size:16,color:we(255,255,255),pos:E(-i),anchor:"botright",fixed:!0});Ge({width:a.width+i*2+i*4,height:a.height+i*2,anchor:"botright",color:we(0,0,0),opacity:.8,radius:4,fixed:!0});for(let l=0;l<2;l++){let f=Ee.timeScale<1;rs({p1:E(-a.width-i*(f?2:3.5),-i),p2:E(-a.width-i*(f?2:3.5),-i-a.height),p3:E(-a.width-i*(f?3.5:2),-i-a.height/2),pos:E(-l*i*1+(f?-i*.5:0),0),color:we(255,255,255),fixed:!0})}Ct(a),je()}),Ee.curRecording&&de(()=>{We(),Ve(0,Ke()),Ve(24,-24),Pt({radius:12,color:we(255,0,0),opacity:Ri(0,1,c.time()*4),fixed:!0}),je()}),Ee.showLog&&M.logs.length>0&&de(()=>{We(),Ve(0,Ke()),Ve(8,-8);let i=8,a=[];for(let f of M.logs){let m="",v=f.msg instanceof Error?"error":"info";m+=`[time]${f.time.toFixed(2)}[/time]`,m+=" ",m+=`[${v}]${f.msg?.toString?f.msg.toString():f.msg}[/${v}]`,a.push(m)}M.logs=M.logs.filter(f=>c.time()-f.time<(t.logTime||4));let l=Ye({text:a.join(`
`),font:Fs,pos:E(i,-i),anchor:"botleft",size:16,width:Ne()*.6,lineSpacing:i/2,fixed:!0,styles:{time:{color:we(127,127,127)},info:{color:we(255,255,255)},error:{color:we(255,0,127)}}});Ge({width:l.width+i*2,height:l.height+i*2,anchor:"botleft",color:we(0,0,0),radius:4,opacity:.8,fixed:!0}),Ct(l),je()})}o(Yn,"drawDebug");function Kn(i){M.events.on("loading",i)}o(Kn,"onLoading");function Qn(i){c.onResize(i)}o(Qn,"onResize");function zn(i){M.events.on("error",i)}o(zn,"onError");function Xn(i){console.error(i),Q.ctx.suspend(),c.run(()=>{Dt(),de(()=>{let a=Ne(),l=Ke(),f={size:36,width:a-32*2,letterSpacing:4,lineSpacing:4,font:Fs,fixed:!0};Ge({width:a,height:l,color:we(0,0,255),fixed:!0});let m=Ye({...f,text:"Error",pos:E(32),color:we(255,128,0),fixed:!0});Ct(m),kt({...f,text:i.message,pos:E(32,32+m.height+16),fixed:!0}),je(),M.events.trigger("error",i)}),Ot()})}o(Xn,"handleErr");function Jn(i){P.push(i)}o(Jn,"onCleanup");function _n(){M.events.onOnce("frameEnd",()=>{c.quit(),y.clear(y.COLOR_BUFFER_BIT|y.DEPTH_BUFFER_BIT|y.STENCIL_BUFFER_BIT);let i=y.getParameter(y.MAX_TEXTURE_IMAGE_UNITS);for(let a=0;a<i;a++)y.activeTexture(y.TEXTURE0+a),y.bindTexture(y.TEXTURE_2D,null),y.bindTexture(y.TEXTURE_CUBE_MAP,null);y.bindBuffer(y.ARRAY_BUFFER,null),y.bindBuffer(y.ELEMENT_ARRAY_BUFFER,null),y.bindRenderbuffer(y.RENDERBUFFER,null),y.bindFramebuffer(y.FRAMEBUFFER,null),C.destroy(),P.forEach(a=>a())})}o(_n,"quit");let Is=!0;c.run(()=>{try{j.loaded||K()===1&&!Is&&(j.loaded=!0,M.events.trigger("load")),!j.loaded&&t.loadingScreen!==!1||Is?(Dt(),Hn(),Ot()):(Ee.paused||mi(),jn(),Dt(),Gn(),t.debug!==!1&&Yn(),Ot()),Is&&(Is=!1),M.events.trigger("frameEnd")}catch(i){Xn(i)}});function Ai(){let i=u,a=y.drawingBufferWidth/i,l=y.drawingBufferHeight/i;if(t.letterbox){if(!t.width||!t.height)throw new Error("Letterboxing requires width and height defined.");let f=a/l,m=t.width/t.height;if(f>m){let v=l*m,A=(a-v)/2;x.viewport={x:A,y:0,width:v,height:l}}else{let v=a/m,A=(l-v)/2;x.viewport={x:0,y:A,width:a,height:v}}return}if(t.stretch&&(!t.width||!t.height))throw new Error("Stretching requires width and height defined.");x.viewport={x:0,y:0,width:a,height:l}}o(Ai,"updateViewport");function xi(){c.onHide(()=>{t.backgroundAudio||Q.ctx.suspend()}),c.onShow(()=>{!t.backgroundAudio&&!Ee.paused&&Q.ctx.resume()}),c.onResize(()=>{if(c.isFullscreen())return;let i=t.width&&t.height;i&&!t.stretch&&!t.letterbox||(s.width=s.offsetWidth*u,s.height=s.offsetHeight*u,Ai(),i||(x.frameBuffer.free(),x.frameBuffer=new Bs(C,y.drawingBufferWidth,y.drawingBufferHeight),x.width=y.drawingBufferWidth/u/n,x.height=y.drawingBufferHeight/u/n))}),t.debug!==!1&&(c.onKeyPress(t.debugKey??"f1",()=>Ee.inspect=!Ee.inspect),c.onKeyPress("f2",()=>Ee.clearLog()),c.onKeyPress("f8",()=>Ee.paused=!Ee.paused),c.onKeyPress("f7",()=>{Ee.timeScale=Ts(ht(Ee.timeScale-.2,0,2),1)}),c.onKeyPress("f9",()=>{Ee.timeScale=Ts(ht(Ee.timeScale+.2,0,2),1)}),c.onKeyPress("f10",()=>Ee.stepFrame())),t.burp&&c.onKeyPress("b",()=>Ft())}if(o(xi,"initEvents"),Ai(),xi(),it={_k:{kaboomCtx:it,app:c,game:M,isFixed:ui,toFixed:Ts,getViewportScale:Me,getRenderProps:Tn,resolveSprite:Xt,drawTexture:Ut,drawRaw:tt,calcTransform:li},VERSION:Ka,loadRoot:re,loadProgress:K,loadSprite:ce,loadSpriteAtlas:ae,loadSound:fe,loadMusic:Ae,loadBitmapFont:he,loadFont:G,loadShader:Oe,loadShaderURL:le,loadAseprite:ue,loadPedit:De,loadBean:ve,loadJSON:N,load:ne,getSprite:be,getSound:qe,getFont:J,getBitmapFont:xt,getShader:zt,getAsset:Es,Asset:_e,SpriteData:W,SoundData:Y,width:Ne,height:Ke,center:ls,dt:ks,time:c.time,screenshot:c.screenshot,record:Wn,isFocused:Nn,setCursor:c.setCursor,getCursor:c.getCursor,setCursorLocked:c.setCursorLocked,isCursorLocked:c.isCursorLocked,setFullscreen:c.setFullscreen,isFullscreen:c.isFullscreen,isTouchscreen:c.isTouchscreen,onLoad:In,onLoading:Kn,onResize:Qn,onGamepadConnect:c.onGamepadConnect,onGamepadDisconnect:c.onGamepadDisconnect,onError:zn,onCleanup:Jn,camPos:un,camScale:cn,camFlash:pn,camRot:dn,camTransform:fn,shake:gn,toScreen:mn,toWorld:wn,setGravity:Sn,getGravity:Mn,setGravityDirection:Rn,getGravityDirection:Pn,setBackground:kn,getBackground:Cn,getGamepads:c.getGamepads,getTreeRoot:on,add:Nt,make:Cs,destroy:pi,destroyAll:sa,get:fi,query:ra,readd:ta,pos:ms,scale:ys,rotate:Ho,color:Li,opacity:Wi,anchor:Gs,area:Uo,sprite:qs,text:Ro,polygon:So,rect:Ni,circle:Ao,uvquad:Po,outline:Vo,particles:Eo,body:Lo,doubleJump:Wo,shader:Mo,timer:js,fixed:Gi,stay:ji,health:Bo,lifespan:Fo,named:Do,state:Oo,z:Yo,layer:qo,move:jo,offscreen:Go,follow:No,fadeIn:vo,mask:bo,drawon:xo,raycast:rn,tile:qi,agent:ko,sentry:Io,patrol:To,navigation:Co,on:gt,onUpdate:_o,onDraw:Zo,onAdd:hi,onDestroy:yn,onClick:$o,onCollide:An,onCollideUpdate:xn,onCollideEnd:vn,onHover:bn,onHoverUpdate:Vn,onHoverEnd:En,onKeyDown:c.onKeyDown,onKeyPress:c.onKeyPress,onKeyPressRepeat:c.onKeyPressRepeat,onKeyRelease:c.onKeyRelease,onMouseDown:c.onMouseDown,onMousePress:c.onMousePress,onMouseRelease:c.onMouseRelease,onMouseMove:c.onMouseMove,onCharInput:c.onCharInput,onTouchStart:c.onTouchStart,onTouchMove:c.onTouchMove,onTouchEnd:c.onTouchEnd,onScroll:c.onScroll,onHide:c.onHide,onShow:c.onShow,onGamepadButtonDown:c.onGamepadButtonDown,onGamepadButtonPress:c.onGamepadButtonPress,onGamepadButtonRelease:c.onGamepadButtonRelease,onGamepadStick:c.onGamepadStick,onButtonPress:c.onButtonPress,onButtonDown:c.onButtonDown,onButtonRelease:c.onButtonRelease,mousePos:ai,mouseDeltaPos:c.mouseDeltaPos,isKeyDown:c.isKeyDown,isKeyPressed:c.isKeyPressed,isKeyPressedRepeat:c.isKeyPressedRepeat,isKeyReleased:c.isKeyReleased,isMouseDown:c.isMouseDown,isMousePressed:c.isMousePressed,isMouseReleased:c.isMouseReleased,isMouseMoved:c.isMouseMoved,isGamepadButtonPressed:c.isGamepadButtonPressed,isGamepadButtonDown:c.isGamepadButtonDown,isGamepadButtonReleased:c.isGamepadButtonReleased,getGamepadStick:c.getGamepadStick,isButtonPressed:c.isButtonPressed,isButtonDown:c.isButtonDown,isButtonReleased:c.isButtonReleased,setButton:c.setButton,getButton:c.getButton,charInputted:c.charInputted,loop:na,wait:ia,play:Bt,volume:Rs,burp:Ft,audioCtx:Q.ctx,Line:$e,Rect:Fe,Circle:Ze,Ellipse:At,Point:ma,Polygon:et,Vec2:I,Color:pe,Mat4:lt,Quad:Ie,RNG:ar,rand:ct,randi:Hi,randSeed:lr,vec2:E,rgb:we,hsl2rgb:pa,quad:Pe,choose:cr,chooseMultiple:ur,shuffle:Yi,chance:hr,lerp:nt,tween:oa,easings:nn,map:ut,mapc:or,wave:Ri,deg2rad:ke,rad2deg:St,clamp:ht,evaluateQuadratic:Rr,evaluateQuadraticFirstDerivative:Pr,evaluateQuadraticSecondDerivative:kr,evaluateBezier:Ys,evaluateBezierFirstDerivative:Cr,evaluateBezierSecondDerivative:Tr,evaluateCatmullRom:Ir,evaluateCatmullRomFirstDerivative:Br,curveLengthApproximation:en,normalizedCurve:Fr,easingSteps:Wr,easingLinear:Ur,easingCubicBezier:Lr,testLineLine:Ks,testRectRect:Ki,testRectLine:Qs,testRectPoint:zs,testCirclePolygon:vs,testLinePoint:Xs,testLineCircle:Qt,isConvex:Yr,triangulate:Bi,NavMesh:Wa,drawSprite:ss,drawText:kt,formatText:Ye,drawRect:Ge,drawLine:ft,drawLines:st,drawTriangle:rs,drawCircle:Pt,drawEllipse:Wt,drawUVQuad:vt,drawPolygon:g,drawCurve:Lt,drawBezier:ns,drawFormattedText:Ct,drawMasked:B,drawSubtracted:$,pushTransform:We,popTransform:je,pushTranslate:Ve,pushScale:dt,pushRotate:rt,pushMatrix:ts,usePostEffect:Ps,makeCanvas:Zt,debug:Ee,scene:Bn,getSceneName:On,go:Fn,onSceneLeave:Dn,layers:aa,addLevel:Ln,getData:Un,setData:ci,download:ei,downloadJSON:Jr,downloadText:sn,downloadBlob:Fi,plug:di,ASCII_CHARS:tr,canvas:c.canvas,addKaboom:qn,LEFT:I.LEFT,RIGHT:I.RIGHT,UP:I.UP,DOWN:I.DOWN,RED:pe.RED,GREEN:pe.GREEN,BLUE:pe.BLUE,YELLOW:pe.YELLOW,MAGENTA:pe.MAGENTA,CYAN:pe.CYAN,WHITE:pe.WHITE,BLACK:pe.BLACK,quit:_n,KEvent:Xe,KEventHandler:ds,KEventController:Kt},t.plugins&&t.plugins.forEach(di),t.global!==!1)for(let i in it)window[i]=it[i];return t.focus!==!1&&c.canvas.focus(),it},"kaplay"),zo=za;var bs=class{x;y;body;context;range;controller;name;constructor(e){this.x=e.x,this.y=e.y,this.body=e.body,this.context=e.context,this.range=e.range,this.controller=e.controller}},ii=class extends bs{light;default_light;charged;constructor(e){super(e),this.default_light=1,this.light=this.default_light,this.name="Player"}movement(e){let s=this.body,n=[this.x,this.y],r=[0,0];switch(e){case"up":{r[1]--;break}case"left":{r[0]--;break}case"down":{r[1]++;break}case"right":{r[0]++;break}case"pathfind":break;default:throw new Error(`unknown direction ${e}.`)}n[0]+=r[0],n[1]+=r[1];let h=this.controller.checkMove([n[0],n[1]],[r[0],r[1]]);switch(h){case 0:{this.context.play("step"),s.moveBy(this.range*r[0],this.range*r[1]),this.x+=r[0],this.y+=r[1];break}case 1:{this.context.play("bump"),debug.log("bumped into an obstacle");break}case 2:{this.context.play("campfire"),this.light=11,this.charged=11,debug.log("bumped into campfire. Refreshed player light for 10 moves");break}case 3:return this.context.play("step"),s.moveBy(this.range*r[0],this.range*r[1]),this.x+=r[0],this.y+=r[1],debug.log("reached exit"),!0;case 4:{this.context.play("bump"),debug.log("bumped into a door switch");break}case 5:{this.context.play("bonus"),s.moveBy(this.range*r[0],this.range*r[1]),this.x+=r[0],this.y+=r[1],this.default_light++,debug.log("stepped on the bonus. +1 maximum light recharge when standing in lit areas. Max campfire light unaffected.");break}default:{debug.log(`unimplemented checkMove result ${h}`);break}}return!1}mouseMovement(e){}};var Vs=class extends bs{closed;constructor(e){super(e),this.closed=e.closed,this.name="Door"}updateClose(){this.closed=!this.closed,this.body.use(sprite("door",{frame:this.closed?0:1}))}};var ni=class extends bs{constructor(e){super(e),this.name="Bonus"}};var ri=class{h;w;context;object_map;floor_map;obstacle_map;darkness_map;layers={floor:new Set,obstacle:new Set(["W","D","d"]),object:new Set(["P","C","B","E","L","T"])};door_switch;objects;constructor(e,s){this.context=s,this.h=e.length,this.w=e[0].length,this.door_switch=!1,this.floor_map=new Array(e.length).fill([]),this.obstacle_map=new Array(e.length).fill([]),this.object_map=new Array(e.length).fill([]);for(let n=0;n<e.length;n++){this.object_map[n]=new Array(e[0].length).fill(" "),this.floor_map[n]=new Array(e[0].length).fill(" "),this.obstacle_map[n]=new Array(e[0].length).fill(" ");for(let r=0;r<e[0].length;r++)this.layers.floor.has(e[n][r])?this.floor_map[n][r]=e[n][r]:this.layers.obstacle.has(e[n][r])?this.obstacle_map[n][r]=e[n][r]:this.layers.object.has(e[n][r])&&(this.object_map[n][r]=e[n][r])}console.log(this.object_map,this.obstacle_map,this.floor_map),this.darkness_map=new Array(this.h).fill(void 0).map(()=>new Array(this.w).fill("0")),this.generateDarknessMap()}get_objects(e){this.objects=e}updateMap(e,s){this.object_map[e[1]][e[0]]="P",this.object_map[e[1]-s[1]][e[0]-s[0]]=" ",console.log(this.object_map)}generateDarknessMap(e={}){for(let s=0;s<this.w;s++)for(let n=0;n<this.h;n++)this.darkness_map[n][s]="0";for(let s=0;s<this.w;s++)for(let n=0;n<this.h;n++)switch(this.object_map[n][s]){case"L":{for(let r=Math.max(0,s-3);r<Math.min(this.w,s+4);r++)for(let h=Math.max(0,n-3);h<Math.min(this.h,n+4);h++)this.darkness_map[h][r]="1";break}case"C":{for(let r=Math.max(0,s-1);r<Math.min(this.w,s+2);r++)for(let h=Math.max(0,n-1);h<Math.min(this.h,n+2);h++)this.darkness_map[h][r]="1";break}case"P":{if("player"in e&&e.player)for(let r=Math.max(0,s-1);r<Math.min(this.w,s+2);r++)for(let h=Math.max(0,n-1);h<Math.min(this.h,n+2);h++)this.darkness_map[h][r]="1";break}case"E":this.darkness_map[n][s]="1";default:break}}stringDarknessMap(){let e=new Array(this.h);for(let s=0;s<this.h;s++)e[s]=this.darkness_map[s].join("");return e}checkMove(e,s){if(e[0]<0||e[1]<0||e[0]>=this.w||e[1]>=this.h)return 1;switch(this.floor_map[e[1]][e[0]]){default:break}switch(this.obstacle_map[e[1]][e[0]]){case"D":return 1;case"W":return 1;default:break}switch(this.object_map[e[1]][e[0]]){case"P":return debug.log("player moved into itself according to the map - this should not happen"),0;case"L":return 1;case"C":return 2;case"E":return 3;case"T":return this.door_switch=!0,4;case"B":return this.object_map[e[1]][e[0]]=" ",this.objects.forEach((n,r)=>{n.x==e[0]&&n.y==e[1]&&(n.body.destroy(),this.objects.splice(r,1))}),this.updateMap(e,s),5;default:break}return this.updateMap(e,s),0}postMove(){for(let e of this.objects)switch(e.name){case"Player":{if(e.charged>0&&e.charged--,e.light>e.default_light||e.charged>0)e.light--;else if(this.darkness_map[e.y][e.x]=="0")if(e.light>0)e.light--,e.light==0&&(this.context.play("scare",{volume:.1}),debug.log("you will be defeated if you don't step out of darkness!"));else return-1;else e.light<e.default_light&&e.light++;break}case"Door":{this.door_switch&&(e.updateClose(),e.closed?this.obstacle_map[e.y][e.x]="D":this.obstacle_map[e.y][e.x]="d");break}case"Bonus":break;default:{debug.log(`unimplemented entity postMove : ${e.constructor.name}`);break}}return this.door_switch=!1,0}};var xe=zo({background:[77,12,77]});xe.loadSprite("player_body","assets/horrorgame/sprites/player_placeholder.png");xe.loadSprite("wall","assets/horrorgame/sprites/wall_placeholder.png");xe.loadSprite("campfire","assets/horrorgame/sprites/campfire_placeholder.png");xe.loadSprite("lightpost","assets/horrorgame/sprites/light_placeholder.png");xe.loadSprite("exit","assets/horrorgame/sprites/exit_placeholder.png");xe.loadSprite("floor","assets/horrorgame/sprites/Empty_background.png");xe.loadSprite("campfire_light","assets/horrorgame/sprites/firelight_placeholder.png");xe.loadSprite("lightpost_light","assets/horrorgame/sprites/lamplight_placeholder.png");xe.loadSprite("darkness","assets/horrorgame/sprites/mini_darkness_placeholder2.png");xe.loadSprite("lightmeter","assets/horrorgame/sprites/lightmeter.png",{sliceX:11});xe.loadSprite("door","assets/horrorgame/sprites/door_placeholder.png",{sliceX:2});xe.loadSprite("switch","assets/horrorgame/sprites/switch_placeholder.png");xe.loadSprite("bonus","assets/horrorgame/sprites/bonus_placeholder.png");xe.loadSound("click","assets/horrorgame/sounds/click.mp3");xe.loadSound("step","assets/horrorgame/sounds/step.mp3");xe.loadSound("bonus","assets/horrorgame/sounds/bonus_pickup.mp3");xe.loadSound("bump","assets/horrorgame/sounds/wall_bump.mp3");xe.loadSound("defeat","assets/horrorgame/sounds/defeat.mp3");xe.loadSound("win","assets/horrorgame/sounds/win.mp3");xe.loadSound("campfire","assets/horrorgame/sounds/fireplace.mp3");xe.loadSound("scare","assets/horrorgame/sounds/dark_scared.mp3");var Xo=[["        W  C      WE","     WW WWW     W W ","     W       W  W   ","  WW W     WWW  WWWW","  W                 ","  W                 ","W         W         ","W       WWW         ","WW    C W           ","        W           ","      WWW         L            ","      W             ","      W     C  W    ","               W    ","           WWWWW    ","                    ","W WW                ","   W               W"," C W         L     W","P  W              WW"],["B   L      WL      P","          W   WWD   "," W       W  W  W    "," WW WW W  W W  W    ","             W LWWW "," E W   W W   W    WT","   W WW  W   WWW  WW","   W W  W       W  L","   W W L  W      W  ","   W W  W        W  ","   W WW  W      DW  ","L  W   W W          ","   W                ","  WW            C   "," W W    WW          ","     WW  W W        ","W Wd W  W  WWW      "," WW  WW     W       ","      d W  L        ","   L    W   W       "]],Se=70,oe=.5;layers(["floor","obstacles","objects","above","ui","popup"],"objects");var oi=vec2(Se*oe*9,Se*oe);scene("playfield",t=>{let e=t.levelId,s=addLevel(Xo[e],{background:[77,77,12],tileWidth:Se*oe,tileHeight:Se*oe,pos:oi,tiles:{W:()=>[sprite("wall"),scale(oe),area(),tile({isObstacle:!0}),layer("obstacles"),"wall"],P:()=>[sprite("player_body"),scale(oe),area(),layer("objects"),"player","postMove"],C:()=>[sprite("campfire"),scale(oe),area(),tile({isObstacle:!0}),layer("objects"),"campfire"],L:()=>[sprite("lightpost"),scale(oe),area(),tile({isObstacle:!0}),layer("objects"),"lightpost"],E:()=>[sprite("exit"),scale(oe),area(),layer("objects"),"exit"],B:()=>[sprite("bonus"),scale(oe),area(),layer("objects"),"bonus"],T:()=>[sprite("switch"),scale(oe),area(),layer("objects"),"switch"],D:()=>[sprite("door",{frame:0}),scale(oe),area(),layer("obstacles"),"door_closed","postMove"],d:()=>[sprite("door",{frame:1}),scale(oe),area(),layer("obstacles"),"door_opened","postMove"]}}),n=new ri(Xo[e],xe),r=[],h=new ii({x:s.get("player")[0].pos.x/oe/Se,y:s.get("player")[0].pos.y/oe/Se,body:s.get("player")[0],context:xe,range:Se*oe,controller:n});r.push(h);for(let P of s.get("door_closed"))r.push(new Vs({x:P.pos.x/oe/Se,y:P.pos.y/oe/Se,body:P,context:xe,range:Se*oe,controller:n,closed:!0}));for(let P of s.get("door_opened"))r.push(new Vs({x:P.pos.x/oe/Se,y:P.pos.y/oe/Se,body:P,context:xe,range:Se*oe,controller:n,closed:!1}));for(let P of s.get("bonus"))r.push(new ni({x:P.pos.x/oe/Se,y:P.pos.y/oe/Se,body:P,context:xe,range:Se*oe,controller:n}));n.get_objects(r);let u=add([sprite("lightmeter",{frame:h.light}),scale(oe),pos(oi.x-4*Se*oe,oi.y+Se*oe)]),p=n.stringDarknessMap(),d=addLevel(p,{tileWidth:Se*oe,tileHeight:Se*oe,pos:vec2(Se*oe*9,Se*oe),tiles:{0:()=>[sprite("darkness"),layer("above"),scale(oe),opacity(.8),"dark"]}}),c=add([layer("floor"),sprite("floor"),scale(oe),pos(oi)]);for(let P of["up","left","down","right"])onKeyPress(P,()=>{if(h.movement(P)){play("win"),debug.log("win"),go("menu",{selected_level:e==0?e+1:e});return}n.generateDarknessMap({player:h.charged>1}),p=n.stringDarknessMap(),d.get("dark").forEach(x=>{p[x.pos.y/oe/Se][x.pos.x/oe/Se]=="1"?x.opacity=0:x.opacity=.8});let C=n.postMove([h]);switch(u.use(sprite("lightmeter",{frame:h.light})),C){case 1:break;case-1:{play("defeat"),debug.log("defeat"),go("menu",{selected_level:e});break}default:break}})});scene("menu",t=>{let e="selected_level"in t?t.selected_level:0,s=200,n={start:null,select:null,settings:null};for(let r in n)n[r]=add([rect(240,80,{radius:10}),pos(300,s),area(),scale(1),anchor("center"),outline(4),layer("ui")]),n[r].add([text(r),anchor("center"),color(0,0,0)]),n[r].onHover(()=>{n[r].scale=vec2(1.2),n[r].color=rgb(255,255,0)}),n[r].onHoverEnd(()=>{n[r].scale=vec2(1),n[r].color=rgb()}),s+=100;n.start.onClick(()=>{play("click"),Jo("playfield",e)}),n.select.onClick(()=>{play("click"),go("levelselect",{selected_level:e})}),n.settings.onClick(()=>{play("click"),debug.log("not implemeted for now.")})});scene("levelselect",t=>{let e=t.selected_level,s=add([rect(600,400,{radius:20}),pos(350,350),area(),body(),scale(1),anchor("center"),outline(4),layer("ui")]),n=s.add([rect(240,80,{radius:10}),pos(0,150),area(),scale(1),anchor("center"),outline(4),layer("ui")]),r=s.add([text("1"),area(),anchor("center"),color(0,0,0),scale(2),pos(-150,30)]),h=s.add([text("2"),area(),anchor("center"),color(0,0,0),scale(2),pos(150,30)]);e==0?r.use(color(0,170,0)):h.use(color(0,170,0)),r.onClick(()=>{play("click"),e=0,r.use(color(0,170,0)),h.use(color(0,0,0))}),h.onClick(()=>{play("click"),e=1,r.use(color(0,0,0)),h.use(color(0,170,0))}),n.add([text("OK"),anchor("center"),color(0,0,0)]),n.onHover(()=>{n.scale=vec2(1.2),n.color=rgb(255,255,0)}),n.onHoverEnd(()=>{n.scale=vec2(1),n.color=rgb()}),n.onClick(()=>{play("click"),go("menu",{selected_level:e})})});function Jo(t,e=-1){go(t,{levelId:e})}Jo("menu");})();
